{"version":3,"file":"rpg-dialogue-main.min.js","mappings":"UAAIA,E,6BCWJC,EAAQ,OAAS,EACjB,IAAIC,EAAQ,EAAQ,KAChBC,EAAmB,EAAQ,KAC3BC,EAAoB,EAAQ,KAC5BC,EAAqB,EAAQ,KAC7BC,EAAkB,EAAQ,KAC1BC,EAAmB,EAAQ,KAC3BC,EAAiB,EAAQ,KACzBC,EAAa,EAAQ,KACrBC,EAAU,EAAQ,IAClBC,EAAwB,WACxB,SAASA,EAAOC,EAAwBC,GACpCC,KAAKC,oBAAsB,KAC3BD,KAAKE,oBAAsB,KAC3B,IAAIC,EAAQH,KACZI,QAAQC,IAAI,8BAEZ,IAAIC,GAAM,EAAIlB,EAAMmB,OAChBC,GAAa,EAAInB,EAAiBoB,gBAAgBH,GAEtDN,KAAKU,GAAK,IAAIpB,EAAkBqB,gBAAgBrB,EAAkBqB,gBAAgBC,MAAMC,gBAAgB,CACpGC,OAAQC,SAASC,eAAe,aAChCC,UAAU,EACVC,aAAa,EACbC,OAAQ,EACRC,OAAQ,EACRC,YAAY,EACZC,YAAY,EACZC,mBAAoB,EACpBC,gBAAgB,EAChBC,mBAAoB,KACpBC,oBAAqB,IACrBC,kBAAmB,EACnBC,mBAAoB,EACpBC,UAAW,EACXC,UAAW,EACXC,iBAAiB,EACjBC,kBAAkB,EAClBC,qBAAsB,GACtBC,qBAAsB,GACtBC,gBAAiB3B,EAAa,UAAY,UAC1C4B,aAAa,EACbC,YAAY,GACb/B,IACH,IAAIgC,EAAU,CACVC,MAAO,IACPC,OAAQ,IAEZxC,KAAKyC,cAAgB,IAAIjD,EAAgBkD,aAAa1C,KAAMA,KAAKU,GAAI4B,GACrEtC,KAAK2C,eAAiB,IAAIlD,EAAiBmD,eAAe5C,KAAKU,GAAI4B,EAAStC,KAAKyC,cAAejC,GAIhGR,KAAKU,GAAGmC,OAAOC,SAAW,SAAUC,EAAMC,GACjC7C,EAAM8C,eAGX9C,EAAMwC,eAAeO,YAAY/C,EAAM8C,cACvC9C,EAAMwC,eAAeQ,kBAAkBhD,EAAM8C,cACjD,EACIlD,GACAK,QAAQC,IAAI,+CACZL,KAAKoD,0BACAC,MAAK,SAAUC,GAChBnD,EAAMoD,yBAAyBD,EACnC,IACKE,OAAM,WACPpD,QAAQC,IAAI,+EACZF,EAAMsD,gBAAgB3D,EAC1B,KAGAK,EAAMsD,gBAAgB3D,GAGX,IAAIH,EAAW+D,SAAS1D,KAAKU,GAAGiD,cACtCC,mBAAkB,SAAUC,GACjCzD,QAAQC,IAAI,iCAAkCwD,GAE9C1D,EAAMoD,yBAAyB/D,EAAgBkD,aAAaoB,WAAWD,GAC3E,IAKA9C,SAASC,eAAe,iBAAiB+C,iBAAiB,SAHzC,WACbhD,SAASC,eAAe,qBAAqBgD,OACjD,IAEAjD,SAASC,eAAe,qBAAqB+C,iBAAiB,UAAU,SAAUE,GAC9E,IAAIC,EAAYnD,SAASC,eAAe,qBACxC,GAAKkD,EAAUC,OAAoC,IAA3BD,EAAUC,MAAMC,OAAxC,CAGAhE,QAAQC,IAAI,YAAa6D,EAAUC,MAAM,IACzC,IAAIE,EAAS,IAAIC,WACjBD,EAAOE,OAAS,WACZ,IAAIC,EAAWH,EAAOI,OACtBrE,QAAQC,IAAIgE,EAAOI,QACnBtE,EAAMoD,yBAAyB/D,EAAgBkD,aAAaoB,WAAWY,KAAKC,MAAMH,IACtF,EACAH,EAAOO,WAAWV,EAAUC,MAAM,GARlC,CASJ,IACApD,SAASC,eAAe,cAAc+C,iBAAiB,SAAS,WAC5D5D,EAAM0E,2BACV,IACA9D,SAASC,eAAe,SAAS+C,iBAAiB,QAAS5D,EAAM2E,yBACjE/D,SAASC,eAAe,eAAe+C,iBAAiB,QAAS5D,EAAM4E,YACvEhE,SAASC,eAAe,iBAAiB+C,iBAAiB,SAAS,WAC/DiB,OAAOC,KAAK,gDAAiD,SACjE,GACJ,CAsJA,OArJApF,EAAOqF,UAAUC,qBAAuB,WACpC,IAAInF,KAAKoF,cAAT,CAGA,IAAIjF,EAAQH,KACZA,KAAKoF,cAAgBC,WAAWC,aAAY,WACxCnF,EAAMoF,aACV,GAAG,IAJH,CAKJ,EACA1F,EAAOqF,UAAUK,YAAc,WACvBvF,KAAKyC,cAAc+C,UAAUC,cAE7BzF,KAAK0F,mBAEb,EACA7F,EAAOqF,UAAUJ,sBAAwB,WACrC,IAAI3E,EAAQH,KACZ,OAAO,WACHG,EAAMsC,cAAc+C,UAAUG,MAAMC,SAAS,uBAC7CzF,EAAMsC,cAAc+C,UAAUG,MAAME,QAAQ,sEAC5C1F,EAAMsC,cAAc+C,UAAUG,MAAMG,UAAU,IAC9C3F,EAAMsC,cAAc+C,UAAUG,MAAMI,WAAW,CAC3CnG,EAAQoG,MAAMC,cACd,CACIC,MAAO,MACPC,OAAQ,WACJhG,EAAMsC,cAAc+C,UAAUG,MAAMS,QACpCjG,EAAMkG,iBACV,KAGRlG,EAAMsC,cAAc+C,UAAUG,MAAMV,MACxC,CACJ,EACApF,EAAOqF,UAAUmB,gBAAkB,WAO/BrG,KAAKuD,yBANW,CACZ+C,KAAM,CAAEC,KAAM,aAAcC,KAAM,CAAC,CAAED,KAAM,YAC3CE,MAAO,CACHC,MAAO,CAAEC,EAAG,eAAgBC,EAAG,CAAC,CAAEC,EAAG,cAAeC,KAAM,OAASC,OAAQ,CAAEC,SAAU,CAAEC,EAAG,EAAGC,EAAG,OAI9G,EACArH,EAAOqF,UAAUH,SAAW,WACxB,IAAI5E,EAAQH,KACZ,OAAO,WACH,IACImH,EADkBhH,EAAMsC,cAAc+C,UAAU4B,2BAE9C5H,EAAgBkD,aAAa2E,gBAAgBlH,EAAMsC,cAAc6E,2BACjEnH,EAAMsC,cAAc6E,0BACtBC,EAAa7C,KAAK8C,UAAUL,EAAS,KAAM,GAC3CM,EAAW1G,SAAS2G,cAAc,YACtCD,EAASE,aAAa,WAAY,QAClCF,EAASG,UAAYL,EACrBE,EAASI,UAAUC,IAAI,gBACvB3H,EAAMsC,cAAc+C,UAAUG,MAAMC,SAAS,yBAC7CzF,EAAMsC,cAAc+C,UAAUG,MAAME,QAAQ4B,GAC5CtH,EAAMsC,cAAc+C,UAAUG,MAAMG,UAAU,IAC9C3F,EAAMsC,cAAc+C,UAAUG,MAAMI,WAAW,CAACnG,EAAQoG,MAAM+B,eAC9D5H,EAAMsC,cAAc+C,UAAUG,MAAMV,MACxC,CACJ,EAIApF,EAAOqF,UAAUL,0BAA4B,WACzC,IAAI1E,EAAQH,KAMRgI,EAAkBjH,SAAS2G,cAAc,OACzCO,EAAiBlH,SAAS2G,cAAc,OACxCQ,EAAgBnH,SAAS2G,cAAc,MAC3CM,EAAgBH,UAAUC,IAAI,cAC9BG,EAAeJ,UAAUC,IAAI,uBAC7BI,EAAcL,UAAUC,IAAI,sBAC5BE,EAAgBG,YAAYF,GAC5BD,EAAgBG,YAAYD,GAC5B,IAKIE,EAAW,IAAI7I,EAAmB8I,iBAAiBrI,KAAKiD,cAAc,GAC1EmF,EAASE,2BANc,SAAUC,EAAgBC,EAAcC,EAAaC,GAGxEvI,EAAMsC,cAAckG,mBAAmBH,EAC3C,IAGA,IAAII,EAAyB5I,KAAKyC,cAAcoG,iBAChD7I,KAAKyC,cAAcqG,gBAAgB,KAAM,MACzCV,EAASW,kBAAkBd,EAAgBC,EAAeU,GAC1D5I,KAAKyC,cAAc+C,UAAUG,MAAMC,SAAS,QAC5C5F,KAAKyC,cAAc+C,UAAUG,MAAME,QAAQmC,GAC3ChI,KAAKyC,cAAc+C,UAAUG,MAAMG,UAAU,IAC7C9F,KAAKyC,cAAc+C,UAAUG,MAAMI,WAAW,CAACnG,EAAQoG,MAAM+B,eAC7D/H,KAAKyC,cAAc+C,UAAUG,MAAMV,MACvC,EACApF,EAAOqF,UAAU3B,yBAA2B,SAAUV,GAElD7C,KAAKiD,aAAejD,KAAKyC,cAAcuG,gBAAgBnG,GACvD7C,KAAKyC,cAAcwG,eAAejJ,KAAKiD,cACvC7C,QAAQC,IAAI,qBAAsBL,KAAKiD,cACvCjD,KAAKyC,cAAcyG,gBAAgBlJ,KAAKiD,cAEpCjD,KAAKC,sBACLD,KAAKC,oBAAoBkJ,UACzBnJ,KAAKC,oBAAsB,MAE/BD,KAAKC,oBAAsBD,KAAKyC,cAAc2G,iBAE1CpJ,KAAKE,sBACLF,KAAKE,oBAAoBiJ,UACzBnJ,KAAKE,oBAAsB,MAE/BF,KAAKE,oBAAsB,IAAIR,EAAe2J,aAAarJ,KAAKU,GAAIV,KAAKiD,aAAcjD,KAAKyC,eAC5FzC,KAAKU,GAAG4I,SACRtJ,KAAKmF,sBACT,EACAtF,EAAOqF,UAAUQ,kBAAoB,WACjC,IAAI6B,EAAa7C,KAAK8C,UAAUxH,KAAKiD,cACrCoC,WAAWkE,aAAaC,QAAQ,6BAA8BjC,EAClE,EACA1H,EAAOqF,UAAUzB,gBAAkB,SAAU3D,GACzC,IAAIK,EAAQH,KACZT,EAAmB8I,iBAAiBoB,mBAAmB3J,GAAwBuD,MAAK,SAAUR,GAC1FzC,QAAQC,IAAI,YAAawC,GACzB1C,EAAMoD,yBAAyBV,EACnC,GACJ,EACAhD,EAAOqF,UAAU9B,wBAA0B,WACvC,OAAO,IAAIsG,SAAQ,SAAUC,EAAQC,GACjC,IAAIrC,EAAalC,WAAWkE,aAAaM,QAAQ,8BAC5CtC,GAA6B,KAAfA,GACfqC,IAEJ,IACI,IAAI/F,EAAaa,KAAKC,MAAM4C,GAC5B,IAAK1D,EAED,YADA+F,IAIJD,EADqBnK,EAAgBkD,aAAaoB,WAAWD,GAEjE,CACA,MAAOiG,GACH1J,QAAQ2J,KAAKD,GACbF,GACJ,CACJ,GACJ,EACO/J,CACX,CAzP2B,GA0P3BV,EAAQ,EAASU,C,mCCzQjB,IAAImK,EAAmBhK,MAAQA,KAAKgK,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,EACxD,EACAE,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQkJ,sBAAmB,EAC3B,IAAIiC,EAAUN,EAAgB,EAAQ,MAClC3B,EAAkC,WAClC,SAASA,EAAiBkC,EAAgBC,GAEtCxK,KAAKyK,UAAYF,EACjBvK,KAAK0K,UAAY,GACjB1K,KAAK2K,mBACDH,GACAxK,KAAK4K,UAEb,CAwNA,OAvNAvC,EAAiBnD,UAAUoD,0BAA4B,SAAUuC,GAC7D,IAAK,IAAIC,EAAI,EAAGA,EAAI9K,KAAK0K,UAAUtG,OAAQ0G,IACvC,GAAI9K,KAAK0K,UAAUI,KAAOD,EACtB,OAAO,EAIf,OADA7K,KAAK0K,UAAUK,KAAKF,IACb,CACX,EACAxC,EAAiBnD,UAAU8F,6BAA+B,SAAUH,GAChE,IAAK,IAAIC,EAAI,EAAGA,EAAI9K,KAAK0K,UAAUtG,OAAQ0G,IACvC,GAAI9K,KAAK0K,UAAUI,KAAOD,EAEtB,OADA7K,KAAK0K,UAAUO,OAAOH,EAAG,IAClB,EAGf,OAAO,CACX,EACAzC,EAAiBnD,UAAUgG,gBAAkB,SAAU1C,EAAcC,EAAaC,GAC9E,IAAK,IAAIoC,EAAI,EAAGA,EAAI9K,KAAK0K,UAAUtG,OAAQ0G,IACvC9K,KAAK0K,UAAUI,GAAG9K,KAAKyK,UAAWjC,EAAcC,EAAaC,EAErE,EACAL,EAAiBnD,UAAUiG,kBAAoB,WAC3C,IAAIC,EAAIC,EAAIC,EACRC,EAAwD,QAA5CH,EAAKpL,KAAKwL,oBAAoBD,gBAA6B,IAAPH,EAAgBA,EAAK,EAEzF,OADkG,QAAlFE,EAAoC,QAA9BD,EAAKrL,KAAKyK,UAAUnE,YAAyB,IAAP+E,OAAgB,EAASA,EAAG7E,YAAyB,IAAP8E,OAAgB,EAASA,EAAGlH,QAAU,EAAIpE,KAAKyK,UAAUnE,KAAKE,KAAK+E,GAAUhF,KAAO,IAElM,EACA8B,EAAiBnD,UAAUuG,wBAA0B,SAAUC,EAAiBC,GAC5E,GAAI3L,KAAKwL,oBAAqB,CAC1B,IAAII,EAAU5L,KAAKmL,oBACnBO,EAAgB1L,KAAKwL,oBAAoB7E,EAAGiF,GAC5C,IAAK,IAAId,EAAI,EAAGA,EAAI9K,KAAKwL,oBAAoB5E,EAAExC,OAAQ0G,IACnDa,EAAc3L,KAAKwL,oBAAoB5E,EAAEkE,GAAGjE,EAAGiE,GAEnD,OAAO,CACX,CACA,OAAO,CACX,EAKAzC,EAAiBnD,UAAU2G,uBAAyB,WAChD,OAAO7L,KAAKwL,mBAChB,EAKAnD,EAAiBnD,UAAU4G,aAAe,WACtC,OAAoC,OAA7B9L,KAAKwL,0BAA6DO,IAA7B/L,KAAKwL,mBACrD,EAMAnD,EAAiBnD,UAAU8G,WAAa,SAAUC,GAC9C,GAAIA,EAAQ,GAAKA,GAASjM,KAAKwL,oBAAoB5E,EAAExC,OACjD,OAAO,EAEX,IAAI8H,EAAsBlM,KAAKmM,wBAC3BC,EAAiBpM,KAAKwL,oBAAoB5E,EAAEqF,GAChD,IAAKG,EACD,OAAO,EAEX,GAAKA,EAAetF,KAIf,CACD9G,KAAKmM,wBAA0BC,EAAetF,KAC9C,IAAIuF,EAAmBrM,KAAKyK,UAAUhE,MAAMzG,KAAKmM,yBAE5CE,EAAiBzF,GAAmC,IAA9ByF,EAAiBzF,EAAExC,OAK1CpE,KAAKwL,oBAAsBa,GAJ3BrM,KAAKmM,wBAA0B,KAC/BnM,KAAKwL,oBAAsB,KAKnC,MAdIxL,KAAKmM,wBAA0B,KAC/BnM,KAAKwL,oBAAsB,KAgB/B,OAFAxL,KAAKkL,gBAAgBlL,KAAKmM,wBAAyBD,EAAqBD,GACxE7L,QAAQC,IAAI,oBAAqBL,KAAKwL,sBAC/B,CACX,EAIAnD,EAAiBnD,UAAUyF,iBAAmB,SAAU/B,GAGpD,GAFA5I,KAAKmM,wBAA0BvD,QAAuEA,EAAyB,QAC/H5I,KAAKwL,oBAAsBxL,KAAKyK,UAAUhE,MAAMzG,KAAKmM,0BAChDnM,KAAKwL,oBACN,KAAM,8EAEd,EAIAnD,EAAiBnD,UAAU0F,SAAW,WAEtC,EACAvC,EAAiBnD,UAAUoH,eAAiB,SAAUC,GAClD,MAAyB,iBAAXA,EAAsBxL,SAASC,eAAeuL,GAAUA,CAC1E,EAWAlE,EAAiBnD,UAAU6D,kBAAoB,SAAUyD,EAAgBC,EAAe7D,GACpF,IAAI8D,EAAe1M,KAAKsM,eAAeE,GACnCG,EAAc3M,KAAKsM,eAAeG,GAKlCf,EAAkB,SAAUkB,EAAchB,GAEtCc,EAAa9E,UADbgE,EACyB,6BAA+BiB,OAAOjB,EAAS,aAAaiB,OAAOD,GAGnEA,CAEjC,EAIIE,EAAmB,WACnBH,EAAY/E,UAAY,EAC5B,EAQI+D,EAAgB,SAAUoB,EAAYC,GACtC,IAAIC,EAAalM,SAAS2G,cAAc,MACpCwF,EAAiBnM,SAAS2G,cAAc,KAC5CwF,EAAetF,UAAYmF,EAC3BG,EAAevF,aAAa,OAAQ,KACpCuF,EAAenJ,iBAAiB,SAAS,WACrCiI,EAAWgB,EACf,IACAC,EAAW9E,YAAY+E,GACvBP,EAAYxE,YAAY8E,EAC5B,EACI9M,EAAQH,KAKRgM,EAAa,SAAUC,GACvB9L,EAAM6L,WAAWC,GACb9L,EAAM2L,iBACNJ,EAAgB,iCAA6BK,GAC7Ce,KAEJA,IACA3M,EAAMsL,wBAAwBC,EAAiBC,EACnD,EAEAxL,EAAMwK,iBAAiB/B,GACvBzI,EAAMsL,wBAAwBC,EAAiBC,GAC/CxL,EAAM+K,gBAAgBlL,KAAKmM,wBAAyB,MAAO,EAC/D,EAOA9D,EAAiBoB,mBAAqB,SAAU0D,GAE5C,OADA/M,QAAQC,IAAI,QAASiK,EAAQ8C,SACtB,IAAI1D,SAAQ,SAAUC,EAAQC,GACjCU,EAAQ8C,QACHC,IAAIF,GACJ9J,MAAK,SAAUiK,GAEhBlN,QAAQC,IAAIiN,GAEZ3D,EAAO2D,EAASC,KACpB,IACK/J,OAAM,SAAUgK,GAEjBpN,QAAQC,IAAImN,GACZ5D,GACJ,IACK6D,SAAQ,WAEb,GACJ,GACJ,EAOApF,EAAiBqF,aAAe,SAAUP,GACtC,OAAO,IAAIzD,SAAQ,SAAUC,EAAQC,GACjCvB,EAAiBoB,mBAAmB0D,GAAM9J,MAAK,SAAUsK,GACrDhE,EAAO,IAAItB,EAAiBsF,GAAQ,GACxC,GACJ,GACJ,EACOtF,CACX,CAlOqC,GAmOrClJ,EAAQkJ,iBAAmBA,C,6BCvO3B8B,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQyO,uBAAyBzO,EAAQkK,kBAAe,EACxD,IAAI/J,EAAoB,EAAQ,KAC5B+J,EAA8B,WAC9B,SAASA,EAAa3I,EAAI4G,EAA2BuG,GACjD7N,KAAK8N,cAAe,EACpB,IAQIC,EARA5N,EAAQH,KAERgO,EAAS,SAAUC,GACnB,IAAIC,EAASxN,EAAGI,OAAOqN,wBACvB,MAAO,CAAElH,EAAGgH,EAAIhH,EAAIiH,EAAOE,KAAMlH,EAAG+G,EAAI/G,EAAIgH,EAAOG,IACvD,EACIC,EAAkB,KAClBC,EAAc,KAEdC,GAAa,EACbC,EAAe,KACfC,EAAe,KACfC,EAAa,WACbF,EAAe,KACfC,EAAe,KACfJ,EAAkB,IACtB,EACIM,EAAU,CACVC,WAAY,SAAUC,GAClB1O,QAAQC,IAAI,cACZF,EAAM2N,cAAe,EACK,GAAtBgB,EAAIC,QAAQ3K,SACZqK,EAAe,IAAInP,EAAkB0P,OAAOhB,EAAO,CAAE/G,EAAG6H,EAAIC,QAAQ,GAAGE,QAAS/H,EAAG4H,EAAIC,QAAQ,GAAGG,WAClGR,EAAe,IAAIpP,EAAkB0P,OAAOhB,EAAO,CAAE/G,EAAG6H,EAAIC,QAAQ,GAAGE,QAAS/H,EAAG4H,EAAIC,QAAQ,GAAGG,YAClGZ,EAAkBT,EAAasB,uBAAuBzO,EAAG0O,uBAAuBX,EAAaxH,EAAGwH,EAAavH,KAEzGqH,EAAcjH,EAA0Bb,MAAM6H,GAG9CP,EAAgBF,EAAawB,yBAAyB3O,EAAG0O,uBAAuBX,EAAaxH,EAAGwH,EAAavH,IAEjHsH,GAAa,EAErB,EACAc,UAAW,SAAUR,GAGjB,GAFA1O,QAAQC,IAAI,aACZF,EAAM2N,cAAe,EACK,GAAtBgB,EAAIC,QAAQ3K,QAAemK,EAAa,CAGxC,GAFAO,EAAIS,iBACJT,EAAIU,mBACCd,IAAiBD,EAClB,OAEJ,IAAIgB,EAAMzB,EAAO,CAAE/G,EAAG6H,EAAIC,QAAQ,GAAGE,QAAS/H,EAAG4H,EAAIC,QAAQ,GAAGG,UAC5DQ,EAAQhP,EAAG0O,uBAAuBK,EAAIxI,EAAGwI,EAAIvI,GAC7CyI,EAAO,IAAIrQ,EAAkB0P,OAAOtO,EAAG0O,uBAAuBX,EAAaxH,EAAGwH,EAAavH,IAAI0I,WAAWF,GAC9GnB,EAAYxH,OAAOC,SAASC,GAAK0I,EAAK1I,EACtCsH,EAAYxH,OAAOC,SAASE,GAAKyI,EAAKzI,EACtCuH,EAAe,IAAInP,EAAkB0P,OAAOhB,EAAO,CAAE/G,EAAG6H,EAAIC,QAAQ,GAAGE,QAAS/H,EAAG4H,EAAIC,QAAQ,GAAGG,WAClGV,GAAa,EACb9N,EAAG4I,QACP,CACJ,EACAuG,SAAU,SAAUf,GAIhB,GAHA1O,QAAQC,IAAI,YACZF,EAAM2N,cAAe,EAEjBS,EAAa,CACb,IAAKG,EACD,OAECF,IACDA,GAAa,EACTD,EACIV,EAAaiC,eAEbjC,EAAakC,sBAAsBzB,IAGnCT,EAAamC,kBAAkB,MAAM,GACrCnC,EAAa/E,gBAAgBwF,EAAiBC,KAKlDV,EAAamC,kBAAkBjC,GAAe,GAC9CF,EAAa/E,gBAAgB,KAAM,OAG/C,CACA6F,GACJ,EACAsB,YAAa,SAAUnB,GACnB1O,QAAQC,IAAI,eACZF,EAAM2N,cAAe,EACrBa,GACJ,GAGJxO,EAAM+P,YAAc7K,WAAW8K,kBAAkBzP,EAAGiD,aAAejD,EAAGiD,aAAejD,EAAGI,OAAQ8N,EACpG,CAIA,OAHAvF,EAAanE,UAAUiE,QAAU,WAC7BnJ,KAAKkQ,YAAY/G,SACrB,EACOE,CACX,CAlGiC,GAmGjClK,EAAQkK,aAAeA,EACvB,IAAIuE,EAAwC,WACxC,SAASA,IACL5N,KAAKoQ,mBAAqB,GAC1BpQ,KAAKqQ,mBAAqB,GAC1BrQ,KAAKsQ,OACT,CAiDA,OAhDA1C,EAAuB1I,UAAUqL,aAAe,SAAUC,EAAUC,GAChE,IAAIC,EAAQ1Q,KAEZ,OADAA,KAAKqQ,mBAAmBtF,KAAK,CAACyF,EAAUC,IACjC,WACHC,EAAML,mBAAmBM,QAAQC,KAAI,SAAUC,EAAG/F,GAC1C+F,EAAE,KAAOL,GAAYK,EAAE,KAAOJ,GAC9BzQ,KAAKqQ,mBAAmBpF,OAAO,EAAGH,EAE1C,GACJ,CACJ,EACA8C,EAAuB1I,UAAU4L,aAAe,SAAUN,EAAUC,GAEhE,OADAzQ,KAAKoQ,mBAAmBrF,KAAK,CAACyF,EAAUC,IACjC,WACHzQ,KAAKoQ,mBAAmBO,QAAQC,KAAI,SAAUC,EAAG/F,GACzC+F,EAAE,KAAOL,GAAYK,EAAE,KAAOJ,GAC9BzQ,KAAKoQ,mBAAmBnF,OAAO,EAAGH,EAE1C,GACJ,CACJ,EACA8C,EAAuB1I,UAAUoL,MAAQ,WACrC,IAAIS,EACAC,EACA7Q,EAAQH,KACZe,SAASgD,iBAAiB,aAAa,SAAU8M,GAC7C,IAAII,EAAKlQ,SAASmQ,iBAAiBL,EAAE9B,QAAQ,GAAGE,QAAS4B,EAAE9B,QAAQ,GAAGG,SACjE+B,IAGL9Q,EAAMiQ,mBAAmBQ,KAAI,SAAUO,GAC/BF,GAAMD,GAAkBA,GAAkBA,EAAeI,QAAQD,EAAM,KACnEH,IAAmBD,IACnBI,EAAM,GAAGH,EAAgBH,GACzBE,EAAiBC,EACjBA,EAAiB,KAG7B,IACA7Q,EAAMkQ,mBAAmBO,KAAI,SAAUO,GAC/BF,EAAGG,QAAQD,EAAM,KAAOF,IAAOD,IAC/BA,EAAiBC,EACjBF,EAAiB,KACjBI,EAAM,GAAGF,EAAIJ,GAErB,IACJ,GACJ,EACOjD,CACX,CAvD2C,GAwD3CzO,EAAQyO,uBAAyBA,C,2BC9JjCzD,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQsB,oBAAiB,EAgBzBtB,EAAQsB,eAfa,SAAUH,GAE3B,QAAmB,IAARA,GAAuBA,EAAI+Q,eAAe,aAAe/Q,EAAc,SAAG,CACjF,IAAIgR,EAAgBhR,EAAc,SAClC,GAAsB,MAAlBgR,GAAyD,UAAhCA,EAAcC,cACvC,OAAO,EAEN,GAAsB,MAAlBD,GAAyD,SAAhCA,EAAcC,cAC5C,OAAO,CAEf,CACA,IAAIC,GAAQ,IAAIC,MAAOC,WAEvB,QADgBF,EAAQ,GAAKA,EAAQ,GAEzC,C,6BCfArH,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQwS,mBAAgB,EACxB,IAAIjS,EAAiB,EAAQ,KACzBF,EAAkB,EAAQ,KAC1BI,EAAU,EAAQ,IAClB+R,EAA+B,WAC/B,SAASA,EAAclP,GACnBzC,KAAK4R,2BAA6B,EAClC5R,KAAK6R,wBAA0B,EAC/B7R,KAAKyC,cAAgBA,EACrBzC,KAAK8R,uBAAyB,IAAIpS,EAAekO,uBACjD5N,KAAK+R,cAAgBhR,SAASC,eAAe,oBAC7ChB,KAAKgS,eAAiBjR,SAASC,eAAe,uBAC9ChB,KAAKiS,WAAajS,KAAK+R,cAAcG,cAAc,eACnDlS,KAAKmS,WAAanS,KAAK+R,cAAcG,cAAc,sBACnDlS,KAAKoS,SAAWpS,KAAK+R,cAAcG,cAAc,gBACjDlS,KAAKoS,SAASrO,iBAAiB,SAAU/D,KAAKqS,eAAerS,OAC7DA,KAAKmS,WAAWpO,iBAAiB,SAAU/D,KAAKsS,sBAAsBtS,OACtEA,KAAKiS,WAAWlO,iBAAiB,SAAU/D,KAAKuS,iBAAiBvS,OACjEA,KAAK2F,MAAQ,IAAI/F,EAAQoG,MACzBjF,SAASC,eAAe,iBAAiB+C,iBAAiB,QAAS/D,KAAKwS,WAAWxS,OACnFe,SAASC,eAAe,uBAAuB+C,iBAAiB,QAAS/D,KAAKyS,gBAAgBzS,OAC9Fe,SAASC,eAAe,uBAAuB+C,iBAAiB,QAAS/D,KAAK0S,gBAAgB1S,OAC9Fe,SAASC,eAAe,0BAA0B+C,iBAAiB,QAAS/D,KAAK2S,0BAA0B3S,MAC/G,CAoaA,OAnaA2R,EAAczM,UAAUkC,yBAA2B,WAE/C,OADerG,SAASC,eAAe,+BACvB4R,OACpB,EACAjB,EAAczM,UAAUO,WAAa,WAEjC,OADe1E,SAASC,eAAe,uBACvB4R,OACpB,EACAjB,EAAczM,UAAUsN,WAAa,SAAUrS,GAC3C,OAAO,WACH,IACIgH,EADkBhH,EAAMiH,2BAEtB5H,EAAgBkD,aAAa2E,gBAAgBlH,EAAMsC,cAAc6E,2BACjEnH,EAAMsC,cAAc6E,0BACtBC,EAAa7C,KAAK8C,UAAUL,GAC5B0L,EAAO,IAAIC,KAAK,CAACvL,GAAa,CAAEwL,KAAM,qBACtCC,EAAMC,IAAIC,gBAAgBL,GAC1BhM,EAAI9F,SAAS2G,cAAc,KAC/Bb,EAAEsM,KAAOH,EACTnM,EAAEuM,SAAW,qBACbvM,EAAEwM,YAAc,uBAChBxM,EAAE7C,OACN,CACJ,EACA2N,EAAczM,UAAUuN,gBAAkB,SAAUtS,GAChD,OAAO,WAKHA,EAAMmT,iBAAiB1M,EAAEmE,KAJT,CACZlE,EAAG,GACHC,KAAM,OAGV3G,EAAMoT,sBACNpT,EAAMsC,cAAc/B,GAAG4I,QAC3B,CACJ,EACAqI,EAAczM,UAAUwN,gBAAkB,SAAUvS,GAChD,OAAO,WACHA,EAAMsC,cAAc+Q,oBACxB,CACJ,EACA7B,EAAczM,UAAUyN,0BAA4B,SAAUxS,GAC1D,OAAO,WACHA,EAAMwF,MAAMC,SAAS,kBACrBzF,EAAMwF,MAAME,QAAQ,0DAA0DgH,OAAO1M,EAAMsT,gBAAiB,OAC5GtT,EAAMwF,MAAMG,UAAU,IACtB3F,EAAMwF,MAAMI,WAAW,CACnBnG,EAAQoG,MAAMC,cACd,CACIC,MAAO,MACPC,OAAQ,WACJhG,EAAMwF,MAAMS,QACZjG,EAAMuT,oBACV,KAGRvT,EAAMwF,MAAMV,MAChB,CACJ,EACA0M,EAAczM,UAAUwO,mBAAqB,WACzC1T,KAAKyC,cAAckR,sBAAsB3T,KAAKyT,iBAC9CzT,KAAK4T,kBAAiB,EAC1B,EACAjC,EAAczM,UAAU0O,iBAAmB,SAAUC,GAC7CA,EACA7T,KAAK+R,cAAclK,UAAUiM,OAAO,UAGpC9T,KAAK+R,cAAclK,UAAUC,IAAI,SAEzC,EACA6J,EAAczM,UAAUmN,eAAiB,SAAUlS,GAC/C,OAAO,SAAU4T,GACb5T,EAAMmT,iBAAiB3M,EAAIoN,EAAYC,OAAO3J,MAC9ClK,EAAMsC,cAAc/B,GAAG4I,QAC3B,CACJ,EACAqI,EAAczM,UAAUoN,sBAAwB,SAAUnS,GACtD,IAAIuQ,EAAQ1Q,KACZ,OAAO,SAAUiU,GACb,IAAIC,EAAWC,SAASzD,EAAMyB,WAAW9H,OACrC+J,OAAOC,MAAMH,KACbA,GAAY,GAEhB/T,EAAMmT,iBAAiB/H,SAAW2I,CACtC,CACJ,EACAvC,EAAczM,UAAUqN,iBAAmB,SAAUpS,GACjD,IAAIuQ,EAAQ1Q,KACZ,OAAO,SAAUiU,GACb,IAAIK,EAAU5D,EAAMuB,WAAW5H,MAC1BiK,GAAiD,KAArCA,EAAUA,EAAQC,QAAQnQ,SAGpBjE,EAAMsC,cAAc+R,gBAAgBrU,EAAMsT,gBAAiBa,KAE9EnU,EAAMsT,gBAAkBa,GAEhC,CACJ,EACA3C,EAAczM,UAAUuP,mBAAqB,SAAUtU,EAAOuU,GAC1D,OAAO,SAAUX,GACbW,EAAO7N,EAAIkN,EAAYC,OAAO3J,MAC9BlK,EAAMsC,cAAc/B,GAAG4I,QAC3B,CACJ,EACAqI,EAAczM,UAAUyP,wBAA0B,SAAUxU,EAAOuU,GAC/D,OAAO,SAAUX,GACbW,EAAO5N,KAAOiN,EAAYC,OAAO3J,MACjClK,EAAMsC,cAAc/B,GAAG4I,QAC3B,CACJ,EACAqI,EAAczM,UAAUqO,oBAAsB,WAC1CvT,KAAK4U,kBAAkB5U,KAAKyT,gBAAiBzT,KAAKsT,iBACtD,EACA3B,EAAczM,UAAU2P,oBAAsB,WAC1C,YAAiD,IAAnC7U,KAAKsT,iBAAiB/H,UAA4B6I,OAAOC,MAAMrU,KAAKsT,iBAAiB/H,UAC7F,EACAvL,KAAKsT,iBAAiB/H,QAChC,EACAoG,EAAczM,UAAU4P,kBAAoB,WACxC,GAAK9U,KAAKsT,iBAAV,CAGAtT,KAAKmS,WAAWvK,UAAY,GAG5B,IAFA,IAAImN,EAAc/U,KAAK6U,sBAEd/J,EAAI,EAAGA,EAAI9K,KAAKyC,cAAc6E,0BAA0BhB,KAAKE,KAAKpC,OAAQ0G,IAAK,CACpF,IAAIkK,EAAYjU,SAAS2G,cAAc,UACvCsN,EAAUrN,aAAa,QAAS,GAAGkF,OAAO/B,IAEtCkK,EAAUpN,UADJ,IAANkD,EACsB,GAAG+B,OAAO7M,KAAKyC,cAAc6E,0BAA0BhB,KAAKE,KAAKsE,GAAGvE,KAAM,cAG1EvG,KAAKyC,cAAc6E,0BAA0BhB,KAAKE,KAAKsE,GAAGvE,KAEhFuE,IAAMiK,IACNC,EAAUrN,aAAa,WAAY,QACnCqN,EAAUC,UAAW,GAEzBjV,KAAKmS,WAAWhK,YAAY6M,EAChC,CACAhV,KAAKmS,WAAW9H,MAAQ,GAAGwC,OAAOkI,GAClC/U,KAAKmS,WAAWxK,aAAa,QAAS,GAAGkF,OAAOkI,GApBhD,CAqBJ,EACApD,EAAczM,UAAUgQ,sBAAwB,SAAUlB,GAEtD,IAAImB,EAAcnV,KAAK4R,0BACnBwD,EAAYjB,SAASH,EAAOqB,aAAa,mBACzCrB,EAAOnM,UAAUyN,SAAS,cAAgBH,IAAgBC,GAAaD,EAAc,IAAMC,GAC3FpB,EAAOnM,UAAUC,IAAI,WAE7B,EACA6J,EAAczM,UAAUqQ,sBAAwB,SAAUvB,GACtD5T,QAAQC,IAAI,yBACR2T,EAAOnM,UAAUyN,SAAS,cAC1BtB,EAAOnM,UAAUiM,OAAO,WAEhC,EACAnC,EAAczM,UAAU0P,kBAAoB,SAAUY,EAAUC,GAC5D,IAAItV,EAAQH,KAWZ,GAVAA,KAAKyT,gBAAkB+B,EACvBxV,KAAKsT,iBAAmBmC,EACxBzV,KAAKiS,WAAWtK,aAAa,QAAS6N,GAAsB,IAC5DxV,KAAKiS,WAAW5H,MAAQmL,GAAsB,GAE9CxV,KAAK8U,oBACL9U,KAAKgS,eAAepK,UAAY,GAChC5H,KAAKmS,WAAW9H,OAASoL,GAAarB,OAAOC,MAAMoB,EAAUlK,UAAY,IAAM,GAAGsB,OAAO4I,EAAUlK,UACnGvL,KAAKoS,SAASzK,aAAa,QAAS8N,EAAYA,EAAU9O,EAAI,IAC9D3G,KAAKoS,SAAS/H,MAAQoL,EAAYA,EAAU9O,EAAI,GAC3C8O,EAAL,CAGA,IAAIC,EAAa,SAAUC,GACvBvV,QAAQC,IAAI,aAAcsV,EAAG3B,QAC7B2B,EAAGpG,iBACH,IAAIyE,EAAS2B,EAAG3B,OAChB7T,EAAM+U,sBAAsBlB,EAChC,EACI4B,EAAc,SAAUD,GACxBvV,QAAQC,IAAI,cAAesV,EAAG3B,QAC9B2B,EAAGpG,iBACH,IAAIyE,EAAS2B,EAAG3B,OAChB7T,EAAMoV,sBAAsBvB,EAChC,EAKA7T,EAAM2R,uBAAuBvB,aAAa,eAAe,SAAUsF,GAC/DzV,QAAQC,IAAI,eAAgBwV,GACvBA,EAAQhO,UAAUyN,SAAS,gBAGhCnV,EAAM0R,uBAAyBsC,SAAS0B,EAAQR,aAAa,mBAC7DlV,EAAM+U,sBAAsBW,GAChC,IACA1V,EAAM2R,uBAAuBhB,aAAa,eAAe,SAAU+E,GAC/DzV,QAAQC,IAAI,eAAgBwV,GAC5B1V,EAAM0R,wBAA0B,EAChC1R,EAAMoV,sBAAsBM,EAChC,IACA,IAAIC,EAAO,SAAUH,GACjBvV,QAAQC,IAAI,OAAQsV,GACpBA,EAAGpG,iBACH,IAAIyE,EAAS2B,EAAG3B,OAEZmB,EAAchV,EAAMyR,0BACpBwD,EAAYjB,SAASH,EAAOqB,aAAa,mBAC7CjV,QAAQC,IAAI,OAAQ8U,EAAa,KAAMC,GAElCpB,EAAOnM,UAAUyN,SAAS,cAAgBH,IAAgBC,GAAaD,EAAc,IAAMC,GAIhGjV,EAAM4V,YAAYZ,EAAaC,EACnC,EACIY,EAAgBhW,KAAKyC,cAAcsE,OAAO7G,oBAAoB4N,aAC9DmI,EAAWjW,KAAKkW,cAAc,EAAGJ,EAAMJ,EAAYE,GACvD5V,KAAKgS,eAAe7J,YAAY8N,GAChC,IAAK,IAAInL,EAAI,EAAGA,EAAI2K,EAAU7O,EAAExC,OAAQ0G,IAAK,CACzC,IAAIqL,EAASV,EAAU7O,EAAEkE,GACrBsL,EAAuBrV,SAAS2G,cAAc,OAC9C2O,EAAwBrW,KAAKsW,yBAAyBxL,EAAGkL,GACzDO,EAAgBxV,SAAS2G,cAAc,OACvC8O,EAAezV,SAAS2G,cAAc,OACtC+O,EAAc1V,SAAS2G,cAAc,YACrCgP,EAAgB1W,KAAK2W,wBAAwBnB,EAAUW,EAAOrP,MAClE0P,EAAa5O,UAAY,KAAKiF,OAAO/B,GACrC0L,EAAa3O,UAAUC,IAAI,WAC3B2O,EAAY7O,UAAYuO,EAAOtP,EAC/B0P,EAAcpO,YAAYqO,GAC1BD,EAAcpO,YAAYsO,GAC1BF,EAAcpO,YAAYuO,GA6B1BN,EAAqBvO,UAAUC,IAAI,0BAE/BkO,GAOIK,EAAsBO,mBACtBP,EAAsBO,iBAAiBjP,aAAa,YAAa,QACjE0O,EAAsBO,iBAAiB7S,iBAAiB,aAvC1C,SAAU4R,GAE5BxV,EAAMyR,0BAA4BuC,SAASwB,EAAG3B,OAAOqB,aAAa,qBAElEM,EAAGkB,aAAaC,QAAQ,cAAe,GAAGjK,OAAO1M,EAAMyR,2BAC3D,IAmCQyE,EAAsBO,iBAAiB7S,iBAAiB,cAlCrC,SAAU4R,GACjCA,EAAGpG,iBACH,IAAIwH,EAAmBpB,EAAG3B,OAE1B,GADA7T,EAAMyR,0BAA4BuC,SAAS4C,EAAiB1B,aAAa,qBACrEjB,OAAOC,MAAMlU,EAAMyR,2BAA4B,CAO/C,GAJImF,EAAiBlP,UAAUyN,SAAS,mBACpCyB,EAAmBA,EAAiBC,cAAcA,gBAGjDD,EAAiBlP,UAAUyN,SAAS,4BAA8ByB,EAAiB1B,aAAa,aAEjG,YADAjV,QAAQC,IAAI,kCAGhBF,EAAMyR,0BAA4BuC,SAAS4C,EAAiB1B,aAAa,oBAC7E,CAEJ,IAiBQgB,EAAsBO,iBAAiB7S,iBAAiB,YAhBvC,SAAUkT,GAC/B9W,EAAM4V,YAAY5V,EAAMyR,0BAA2BzR,EAAM0R,uBAC7D,IAeQwE,EAAsBO,iBAAiBjP,aAAa,mBAAoB,GAAGkF,OAAO/B,KAG1FsL,EAAqBjO,YAAYoO,GACjCH,EAAqBjO,YAAYkO,EAAsBa,WACvD,IAAIC,EAAanX,KAAKkW,cAAcpL,EAAI,EAAGgL,EAAMJ,EAAYE,GAC7D5V,KAAKgS,eAAe7J,YAAYiO,GAChCpW,KAAKgS,eAAe7J,YAAYgP,GAChCV,EAAY1S,iBAAiB,SAAU/D,KAAKyU,mBAAmBzU,KAAMmW,IACrEO,EAAc3S,iBAAiB,SAAU/D,KAAK2U,wBAAwB3U,KAAMmW,GAChF,CAlHA,CAmHJ,EAUAxE,EAAczM,UAAUoR,yBAA2B,SAAUrK,EAAO+J,GAChE,IAAI7V,EAAQH,KACRoX,EAAiBrW,SAAS2G,cAAc,OAC5C0P,EAAevP,UAAUC,IAAI,2BAC7B,IAAIuP,EAAa,KACjB,GAAIrB,EAAe,CACf,IAAIsB,EAAgBvW,SAAS2G,cAAc,OAC3C4P,EAAczP,UAAUC,IAAI,0BAC5B,IAAIyP,EAAQxW,SAAS2G,cAAc,UACnC6P,EAAM3P,UAAY,IACJ,IAAVqE,EACAsL,EAAM5P,aAAa,WAAY,QAG/B4P,EAAMxT,iBAAiB,SAAS,WAC5B3D,QAAQC,IAAI,QAAS4L,EAAOA,EAAQ,GACpC9L,EAAM4V,YAAY9J,EAAOA,EAAQ,EACrC,IAEJ,IAAIuL,EAAUzW,SAAS2G,cAAc,UACrC8P,EAAQ5P,UAAY,IAChBqE,EAAQ,IAAMjM,KAAKsT,iBAAiB1M,EAAExC,OACtCoT,EAAQ7P,aAAa,WAAY,QAGjC6P,EAAQzT,iBAAiB,SAAS,WAC9B3D,QAAQC,IAAI,UAAW4L,EAAOA,EAAQ,GACtC9L,EAAM4V,YAAY9J,EAAOA,EAAQ,EACrC,IAEJqL,EAAcnP,YAAYoP,GAC1BD,EAAcnP,YAAYqP,GAC1BJ,EAAejP,YAAYmP,EAC/B,MAEID,EAAatW,SAAS2G,cAAc,QACzBG,UAAUC,IAAI,iBACzBuP,EAAWzP,UAAY,WACvBwP,EAAejP,YAAYkP,GAE/B,IAAII,EAAe1W,SAAS2G,cAAc,UAK1C,OAJA+P,EAAa5P,UAAUC,IAAI,mBAC3B2P,EAAa1T,iBAAiB,QAAS/D,KAAK0X,oBAAoBzL,IAChEwL,EAAa7P,UAAY,YACzBwP,EAAejP,YAAYsP,GACpB,CAAEP,UAAWE,EAAgBR,iBAAkBS,EAC1D,EACA1F,EAAczM,UAAU6Q,YAAc,SAAUZ,EAAaC,GACrDA,EAAYD,GACZC,IAEJ,IAAIuC,EAAM3X,KAAKsT,iBAAiB1M,EAAEuO,GAClCnV,KAAKsT,iBAAiB1M,EAAEuO,GAAenV,KAAKsT,iBAAiB1M,EAAEwO,GAC/DpV,KAAKsT,iBAAiB1M,EAAEwO,GAAauC,EAErC3X,KAAKuT,sBACLvT,KAAKyC,cAAc/B,GAAG4I,QAC1B,EACAqI,EAAczM,UAAUwS,oBAAsB,SAAUzL,GACpD,IAAI9L,EAAQH,KACZ,OAAO,WACHG,EAAMwF,MAAMC,SAAS,kBACrBzF,EAAMwF,MAAME,QAAQ,wCAAwCgH,OAAOZ,EAAO,MAC1E9L,EAAMwF,MAAMG,UAAU,IACtB3F,EAAMwF,MAAMI,WAAW,CACnBnG,EAAQoG,MAAMC,cACd,CACIC,MAAO,MACPC,OAAQ,WACJhG,EAAMwF,MAAMS,QACZjG,EAAMyX,mBAAmB3L,EAC7B,KAGR9L,EAAMwF,MAAMV,MAChB,CACJ,EACA0M,EAAczM,UAAU0S,mBAAqB,SAAU3L,GACnDjM,KAAKsT,iBAAiB1M,EAAEqE,OAAOgB,EAAO,GACtCjM,KAAKuT,sBACLvT,KAAKyC,cAAc/B,GAAG4I,QAC1B,EACAqI,EAAczM,UAAUgR,cAAgB,SAAUd,EAAWU,EAAMJ,EAAYE,GAC3E,IAAIK,EAAWlV,SAAS2G,cAAc,OAMtC,OALAuO,EAAStO,aAAa,iBAAkB,GAAGkF,OAAOuI,IAClDa,EAASpO,UAAUC,IAAI,aAAc,aACrCmO,EAASlS,iBAAiB,OAAQ+R,GAClCG,EAASlS,iBAAiB,WAAY2R,GACtCO,EAASlS,iBAAiB,YAAa6R,GAChCK,CACX,EACAtE,EAAczM,UAAUyR,wBAA0B,SAAUkB,EAAYC,GACpE,IAAIpB,EAAgB3V,SAAS2G,cAAc,UAC3C,GAAK1H,KAAKyC,cAAc6E,0BAGnB,CACD,IAAIyQ,EAAgB/X,KAAKgY,8BAA8B,IAAI,EAAO,MAAM,GAExE,IAAK,IAAIC,KADTvB,EAAcvO,YAAY4P,GACV/X,KAAKyC,cAAc6E,0BAA0Bb,MAAO,CAChE,IAAKzG,KAAKyC,cAAc6E,0BAA0Bb,MAAM4K,eAAe4G,GACnE,OAEJ,IAAIC,EAAelY,KAAKyC,cAAc6E,0BAA0Bb,MAAMwR,GAClEE,EAAkBnY,KAAKgY,8BAA8BE,EAAavR,EAAGsR,IAAQJ,EAAYI,EAAKA,IAAQH,GAC1GpB,EAAcvO,YAAYgQ,EAC9B,CACJ,MAbI/X,QAAQ2J,KAAK,qEAcjB,OAAO2M,CACX,EACA/E,EAAczM,UAAU8S,8BAAgC,SAAUI,EAAkBC,EAAWJ,EAAKK,GAChG,IAAIP,EAAgBhX,SAAS2G,cAAc,UAS3C,OARAqQ,EAAcpQ,aAAa,QAASsQ,GACpCF,EAAcnQ,UAAY,GAAGiF,OAAOoL,QAAiCA,EAAM,GAAI,MAAMpL,OAAOrN,EAAgBkD,aAAa6V,UAAUH,EAAkB,KACjJC,GACAN,EAAcpQ,aAAa,WAAY,QAEvC2Q,GACAP,EAAcpQ,aAAa,WAAY,QAEpCoQ,CACX,EACOpG,CACX,CAxbkC,GAyblCxS,EAAQwS,cAAgBA,C,6BC9bxBxH,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQuD,kBAAe,EACvB,IAAIpD,EAAoB,EAAQ,KAC5BkZ,EAAe,EAAQ,KACvB/Y,EAAmB,EAAQ,KAC3BgZ,EAAgB,EAAQ,KACxB/V,EAA8B,WAC9B,SAASA,EAAaqE,EAAQrG,EAAI4B,GAM9BtC,KAAK0Y,oBAAsB,KAK3B1Y,KAAK2Y,gBAAkB,KAKvB3Y,KAAK6I,iBAAmB,KAKxB7I,KAAK4Y,aAAe,KAKpB5Y,KAAK8P,eAAiB,KAKtB9P,KAAK6Y,mBAAqB,KAK1B7Y,KAAK8Y,sBAAwB,KAC7B9Y,KAAK+G,OAASA,EACd/G,KAAKU,GAAKA,EACVV,KAAKsC,QAAUA,EACftC,KAAK6I,iBAAmB,KACxB7I,KAAKwF,UAAY,IAAIgT,EAAa7G,cAAc3R,MAChDA,KAAK+Y,YAAc,IAAIN,EAAcO,oBAAoBhZ,KAC7D,CA8XA,OA7XA0C,EAAawC,UAAUgE,gBAAkB,SAAU5B,GAC/CtH,KAAKsH,0BAA4BA,CACrC,EACA5E,EAAawC,UAAU8K,kBAAoB,SAAUF,EAAgBmJ,GACjE7Y,QAAQC,IAAI,sBAAuByP,GACnC9P,KAAK8P,eAAiBA,EACjBmJ,GACDjZ,KAAKU,GAAG4I,QAEhB,EACA5G,EAAawC,UAAUgU,qBAAuB,SAAUL,GAEpD,IAAIM,GAAoBnZ,KAAKoZ,wBAAwBpZ,KAAK6Y,mBAAoBA,GAC9E7Y,KAAK6Y,mBAAqBA,EACtBM,GACAnZ,KAAKU,GAAG4I,QAEhB,EACA5G,EAAawC,UAAUyD,mBAAqB,SAAU6M,EAAUyD,GAC5DjZ,KAAK0Y,oBAAsBlD,EAC3BxV,KAAK2Y,gBAAkBnD,EAAWxV,KAAKsH,0BAA0Bb,MAAM+O,GAAY,KAC9EyD,GACDjZ,KAAKU,GAAG4I,QAEhB,EAOA5G,EAAawC,UAAUmU,kBAAoB,WACvC,IAAIC,EAAWtZ,KAAKU,GAAG4Y,WACvB,MAAO,CACHrS,EAAGqS,EAASC,IAAItS,EAAIjH,KAAKsC,QAAQC,OAAS+W,EAAS/W,MAAQ,EAAIvC,KAAKsC,QAAQC,OAASiX,KAAKC,SAC1FvS,EAAGoS,EAASC,IAAIrS,EAAIlH,KAAKsC,QAAQE,QAAU8W,EAAS9W,OAAS,EAAIxC,KAAKsC,QAAQE,QAAUgX,KAAKC,SAErG,EACA/W,EAAawC,UAAU4D,gBAAkB,SAAU0M,EAAUkE,GACzD1Z,KAAK6I,iBAAmB2M,EACxBxV,KAAK4Y,aAAec,EAChBlE,GAAYkE,GAEZ1Z,KAAKwF,UAAUoO,kBAAiB,GAChC5T,KAAKwF,UAAUoP,kBAAkBY,EAAUxV,KAAK4Y,gBAIhD5Y,KAAKwF,UAAUoO,kBAAiB,GAChC5T,KAAKwF,UAAUoP,kBAAkB,KAAM,OAE3C5U,KAAKU,GAAG4I,QACZ,EAUA5G,EAAawC,UAAU8D,gBAAkB,SAAU2Q,GAE/C,IAAIC,EAAsBD,EAC1B,IAAK,IAAInE,KAAYoE,EAAoBnT,MAAO,CAC5C,IAAIgP,EAAYmE,EAAoBnT,MAAM+O,GACrCC,EAKAA,EAAUpE,eAAe,UAGpBoE,EAAU1O,OAAOsK,eAAe,aAIjCoE,EAAU1O,OAAOC,SAASqK,eAAe,OAAQgD,MAAMoB,EAAU1O,OAAOC,SAASC,KAClFwO,EAAU1O,OAAOC,SAASC,EAAIjH,KAAKqZ,oBAAoBpS,GAEtDwO,EAAU1O,OAAOC,SAASqK,eAAe,OAAQgD,MAAMoB,EAAU1O,OAAOC,SAASE,KAClFuO,EAAU1O,OAAOC,SAASE,EAAIlH,KAAKqZ,oBAAoBnS,IAP3DuO,EAAU1O,OAAOC,SAAWhH,KAAKqZ,oBAHjC5D,EAAU1O,OAAS,CAAEC,SAAUhH,KAAKqZ,qBALpCjZ,QAAQ2J,KAAK,uBAAuB8C,OAAO2I,EAAU,0BAkB7D,CACA,OAAOoE,CACX,EAKAlX,EAAawC,UAAU+D,eAAiB,SAAUV,GAC9C,IAAI9D,EAAS8D,EACRA,EAAe8I,eAAe,UAC/B5M,EAAO6B,KAAO,CAAEC,KAAM,SAAUC,KAAM,KAErC/B,EAAO6B,KAAKE,OACb/B,EAAO6B,KAAKE,KAAO,IAES,IAA5B/B,EAAO6B,KAAKE,KAAKpC,QACjBK,EAAO6B,KAAKE,KAAKuE,KAAK,CAAExE,KAAM,UAEtC,EACA7D,EAAawC,UAAU2U,oBAAsB,SAAU5L,EAAKwH,GACxD,OAAQA,EAAU1O,OAAOC,SAASC,GAAKgH,EAAIhH,GACvCwO,EAAU1O,OAAOC,SAASE,GAAK+G,EAAI/G,GACnCuO,EAAU1O,OAAOC,SAASC,EAAIjH,KAAKsC,QAAQC,MAAQ0L,EAAIhH,GACvDwO,EAAU1O,OAAOC,SAASE,EAAIlH,KAAKsC,QAAQE,OAASyL,EAAI/G,CAChE,EACAxE,EAAawC,UAAU4U,qBAAuB,SAAU7L,EAAKwH,EAAWzI,GAEpE,OADAvN,EAAiBmD,eAAemX,gBACxBtE,EAAU1O,OAAOC,SAASC,EAAIxH,EAAiBmD,eAAemX,iBAAmB9L,EAAIhH,GACzFwO,EAAU1O,OAAOC,SAASE,GAAK8F,EAAc,GAAKhN,KAAKsC,QAAQE,QAAUyL,EAAI/G,GAC7EuO,EAAU1O,OAAOC,SAASC,EAAIxH,EAAiBmD,eAAemX,gBAAkB/Z,KAAKsC,QAAQC,MAAQ0L,EAAIhH,GACzGwO,EAAU1O,OAAOC,SAASE,GAAK8F,EAAc,GAAKhN,KAAKsC,QAAQE,OAASxC,KAAKsC,QAAQE,OAASyL,EAAI/G,CAC1G,EACAxE,EAAawC,UAAUiK,uBAAyB,SAAUlB,GACtD,IAAK,IAAIuH,KAAYxV,KAAKsH,0BAA0Bb,MAAO,CACvD,IAAIgP,EAAYzV,KAAKsH,0BAA0Bb,MAAM+O,GACrD,GAAIxV,KAAK6Z,oBAAoB5L,EAAKwH,GAC9B,OAAOD,CAEf,CACA,OAAO,IACX,EACA9S,EAAawC,UAAUmK,yBAA2B,SAAUpB,GACxD,IAAK,IAAIuH,KAAYxV,KAAKsH,0BAA0Bb,MAEhD,IADA,IAAIgP,EAAYzV,KAAKsH,0BAA0Bb,MAAM+O,GAC5C1K,EAAI,EAAGA,EAAI2K,EAAU7O,EAAExC,OAAQ0G,IACpC,GAAI9K,KAAK8Z,qBAAqB7L,EAAKwH,EAAW3K,GAC1C,MAAO,CAAE0K,SAAUA,EAAUkE,KAAMjE,EAAWzI,YAAalC,GAIvE,OAAO,IACX,EACApI,EAAawC,UAAU8U,kBAAoB,SAAUC,GACjD,OAAOja,KAAK0Y,sBAAwBuB,CACxC,EACAvX,EAAawC,UAAUgV,oBAAsB,SAAU1E,EAAUxI,GAC7D,OAAQhN,KAAK6Y,oBACT7Y,KAAK6Y,mBAAmBrD,WAAaA,GACrCxV,KAAK6Y,mBAAmB7L,cAAgBA,CAChD,EACAtK,EAAawC,UAAUiV,iBAAmB,SAAU3E,EAAUxI,GAC1D,OAAOhN,KAAK8P,gBAAkB9P,KAAK8P,eAAe0F,WAAaA,GAAYxV,KAAK8P,eAAe9C,cAAgBA,CACnH,EACAtK,EAAawC,UAAUsO,mBAAqB,WAGxC,IAAIxM,EAAWhH,KAAK4Y,aACd,CACE3R,EAAGjH,KAAK4Y,aAAa7R,OAAOC,SAASC,EAAI,EAAIjH,KAAKsC,QAAQC,MAC1D2E,EAAGlH,KAAK4Y,aAAa7R,OAAOC,SAASE,EAAIlH,KAAKsC,QAAQE,QAExDxC,KAAKqZ,oBACP7D,EAAWxV,KAAKoa,gBAChBC,EAAU,CACV1T,EAAG,GACHC,EAAG,CAAC,CAAEC,EAAG,GAAIC,KAAM,OACnBC,OAAQ,CACJC,SAAUA,IAGlBhH,KAAKsH,0BAA0Bb,MAAM+O,GAAY6E,EACjDra,KAAK6I,iBAAmB2M,EACxBxV,KAAK4Y,aAAeyB,EACpBra,KAAKwF,UAAUoP,kBAAkBY,EAAU6E,GAC3Cra,KAAKU,GAAG4I,QACZ,EACA5G,EAAawC,UAAUyO,sBAAwB,SAAU6B,UAC9CxV,KAAKsH,0BAA0Bb,MAAM+O,GAC5CxV,KAAK6I,iBAAmB,KACxB7I,KAAK4Y,aAAe,KACpB5Y,KAAKwF,UAAUoP,kBAAkB,KAAM,MACvC5U,KAAKU,GAAG4I,QACZ,EACA5G,EAAawC,UAAUkE,eAAiB,WACpC,IAAIsH,EAAQ1Q,KACRG,EAAQH,KAIRsa,EAAe,KACfC,EAAmB,KACnBC,EAAe,KACfC,EAAmB,KAiDvB,OAhDc,IAAInb,EAAkBob,aAAa1a,KAAKU,GAAGiD,cACpDgX,MAAK,SAAU7L,GAChBwL,EAAe5J,EAAMhQ,GAAG0O,uBAAuBN,EAAI8L,OAAON,aAAarT,EAAG6H,EAAI8L,OAAON,aAAapT,GAClGqT,EAAmB,CAAEtT,EAAG6H,EAAI8L,OAAON,aAAarT,EAAGC,EAAG4H,EAAI8L,OAAON,aAAapT,IAC9EuT,EAAmB/J,EAAMvB,uBAAuBmL,MAE5CE,EAAe9J,EAAMpJ,0BAA0Bb,MAAMgU,GAE7D,IACKI,IAAG,SAAU5W,GACdqW,EAAe,KACfE,EAAe,IACnB,IACKM,MAAK,SAAUhM,GACXwL,GAAiBE,IAItBA,EAAazT,OAAOC,SAASC,GAAK6H,EAAI8L,OAAOG,WAAW9T,EAAIyJ,EAAMhQ,GAAGqC,KAAKiY,MAAM/T,EAChFuT,EAAazT,OAAOC,SAASE,GAAK4H,EAAI8L,OAAOG,WAAW7T,EAAIwJ,EAAMhQ,GAAGqC,KAAKiY,MAAM9T,EACpF,IACK+T,MAAK,SAAUnM,GAGhB,IAAIoM,EAAexK,EAAMhQ,GAAG0O,uBAAuBN,EAAI8L,OAAO3M,IAAIhH,EAAG6H,EAAI8L,OAAO3M,IAAI/G,GACpF/G,EAAM2Y,sBAAwB,CAAE7R,EAAGiU,EAAajU,EAAGC,EAAGgU,EAAahU,GACnE,IAAIiU,EAA2BzK,EAAMrB,yBAAyB6L,GAG9D,GADA/a,EAAM+Y,qBAAqBiC,GACtBA,EAMDzK,EAAM/H,mBAAmB,UANE,CAE3B,IAAIyS,EAAmB1K,EAAMvB,uBAAuB+L,GACpDxK,EAAM/H,mBAAmByS,EAC7B,CAIJ,IACKpX,OAAM,SAAU8K,GAGjB,GADA1O,QAAQC,IAAI,mBAAoBka,EAAkB,kBAAmBzL,EAAI8L,OAAO3M,MAC5EsM,GAAqBA,EAAiBtT,IAAM6H,EAAI8L,OAAO3M,IAAIhH,GAAKsT,EAAiBrT,IAAM4H,EAAI8L,OAAO3M,IAAI/G,EAA1G,CAIA,IAAImU,EAAgB3K,EAAMhQ,GAAG0O,uBAAuBN,EAAI8L,OAAO3M,IAAIhH,EAAG6H,EAAI8L,OAAO3M,IAAI/G,GACrF/G,EAAMmb,YAAYD,EAHlB,CAIJ,GAEJ,EACA3Y,EAAawC,UAAUoW,YAAc,SAAUD,GAC3C,IAAIE,EAA0Bvb,KAAKqP,yBAAyBgM,GAC5D,GAAIE,EACAvb,KAAKgQ,kBAAkBuL,OAEtB,CAED,IAAIC,EAAkBxb,KAAKmP,uBAAuBkM,GAClDjb,QAAQC,IAAI,QAASmb,GACjBA,EACIxb,KAAK8P,gBACL9P,KAAK+P,sBAAsByL,GAC3Bxb,KAAKU,GAAG4I,UAGRtJ,KAAK8I,gBAAgB0S,EAAiBxb,KAAKsH,0BAA0Bb,MAAM+U,IAK/Exb,KAAK8I,gBAAgB,KAAM,MAI/B9I,KAAKgQ,kBAAkB,MAAM,EACjC,CACJ,EACAtN,EAAawC,UAAU6K,sBAAwB,SAAUyL,GAChDxb,KAAK8P,gBAEN1P,QAAQ2J,KAAK,6DAEL/J,KAAKsH,0BAA0Bb,MACnB+U,GADxB,IAEIC,EAAazb,KAAK8P,eAAe4J,KACrCtZ,QAAQC,IAAI,aACZob,EAAW7U,EAAE5G,KAAK8P,eAAe9C,aAAalG,KAAO0U,EACrDxb,KAAKwF,UAAUoP,kBAAkB5U,KAAK6I,iBAAkB7I,KAAK4Y,aACjE,EACAlW,EAAawC,UAAUkU,wBAA0B,SAAUsC,EAAQC,GAC/D,SAAMD,GAAUC,GAAYD,IAAWC,YAGhB,IAAXD,QAA4C,IAAXC,QACtB,IAAXD,QAA4C,IAAXC,KAGzCD,IAAWC,QAA6B,IAAXD,QAA4C,IAAXC,GAG3DD,EAAOlG,WAAamG,EAAOnG,UAAYkG,EAAO1O,cAAgB2O,EAAO3O,aAChF,EACAtK,EAAawC,UAAUsP,gBAAkB,SAAUoH,EAAStH,GACxD,IAAKtU,KAAKsH,0BAA0Bb,MAAM4K,eAAeuK,GAErD,OADAxb,QAAQ2J,KAAK,gEAAiE6R,IACvE,EAEX,GAAgB,UAAZA,EAEA,OADAxb,QAAQ2J,KAAK,uEACN,EAEX,GAAI/J,KAAKsH,0BAA0Bb,MAAM4K,eAAeiD,GAEpD,OADAlU,QAAQ2J,KAAK,gEAAiEuK,IACvE,EAEX,GAAIA,IAAYsH,EAEZ,OADAxb,QAAQ2J,KAAK,2EAA4E6R,IAClF,EAEX,IAAInG,EAAYzV,KAAKsH,0BAA0Bb,MAAMmV,GAIrD,IAAK,IAAIpG,KAHTxV,KAAKsH,0BAA0Bb,MAAM6N,GAAWmB,SACzCzV,KAAKsH,0BAA0Bb,MAAMmV,GAEvB5b,KAAKsH,0BAA0Bb,MAChD,GAAKzG,KAAKsH,0BAA0Bb,MAAM4K,eAAemE,GAIzD,IADA,IAAIqG,EAAU7b,KAAKsH,0BAA0Bb,MAAM+O,GAC1CsG,EAAI,EAAGA,EAAID,EAAQjV,EAAExC,OAAQ0X,IAC9BD,EAAQjV,EAAEkV,GAAGhV,OAAS8U,IACtBC,EAAQjV,EAAEkV,GAAGhV,KAAOwN,GAUhC,OALIsH,IAAY5b,KAAK6I,mBACjB7I,KAAK6I,iBAAmByL,EACxBtU,KAAK4Y,aAAe5Y,KAAKsH,0BAA0Bb,MAAM6N,IAE7DtU,KAAKU,GAAG4I,UACD,CACX,EACA5G,EAAa6V,UAAY,SAAUwD,EAAMC,GACrC,OAAKD,GAAQA,EAAK3X,QAAU4X,EACjBD,EAEJ,GAAGlP,OAAOkP,EAAKE,UAAU,EAAGD,GAAY,MACnD,EACAtZ,EAAaoB,WAAa,SAAUoY,GAEhC,GAAsB,iBAAXA,EACP,KAAM,0DAA0DrP,cAAcqP,EAAQ,KAG1F,IAAKA,EAAO7K,eAAe,SACvB,KAAM,2EAEE6K,EAAc,MAG1B,IAAK,IAAIjE,KAAOiE,EAAQ,CACpB,GAAKA,EAAO7K,eAAe4G,GAI3B,GAA4B,iBADTiE,EAAOjE,GAEtB,KAAM,8EAGd,CACA,OAAOiE,CACX,EACAxZ,EAAa2E,gBAAkB,SAAUkB,GACrC,IAAI4T,EAAQzX,KAAKC,MAAMD,KAAK8C,UAAUe,IACtC,IAAK,IAAIiN,KAAY2G,EAAM1V,MAAO,CAC9B,IAAIiT,EAAOyC,EAAM1V,MAAM+O,GACnBkE,EAAKrI,eAAe,kBACbqI,EAAa,MAE5B,CACA,OAAOyC,CACX,EACAzZ,EAAawC,UAAUkV,cAAgB,WAInC,IAHA,IACIgC,EADOjS,OAAOkS,KAAKrc,KAAKsH,0BAA0Bb,OACrCrC,OACb6T,EAAM,OAASmE,EACZpc,KAAKsH,0BAA0Bb,MAAM4K,eAAe4G,IACvDA,EAAM,OAASmE,EACfA,IAEJ,OAAOnE,CACX,EACOvV,CACX,CA3aiC,GA4ajCvD,EAAQuD,aAAeA,C,mCC3bvB,IAAI4Z,EAAYtc,MAAQA,KAAKsc,UAAa,WAStC,OARAA,EAAWnS,OAAOoS,QAAU,SAASC,GACjC,IAAK,IAAIC,EAAG3R,EAAI,EAAG4R,EAAIC,UAAUvY,OAAQ0G,EAAI4R,EAAG5R,IAE5C,IAAK,IAAI8R,KADTH,EAAIE,UAAU7R,GACOX,OAAOjF,UAAUmM,eAAewL,KAAKJ,EAAGG,KACzDJ,EAAEI,GAAKH,EAAEG,IAEjB,OAAOJ,CACX,EACOF,EAASQ,MAAM9c,KAAM2c,UAChC,EACAxS,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQyD,oBAAiB,EAUzB,IAAItD,EAAoB,EAAQ,KAC5BE,EAAkB,EAAQ,KAC1Bud,EAAqB,EAAQ,KAC7BC,EAAU,EAAQ,KAElBpa,EAAgC,WAChC,SAASA,EAAelC,EAAI4B,EAASG,EAAejC,GAChDR,KAAKid,gBAAkB,GACvBjd,KAAKU,GAAKA,EACVV,KAAKsC,QAAUA,EACftC,KAAKyC,cAAgBA,EACrBzC,KAAKkd,YAAc,CACfC,MAAO,QACPC,WAAY,QACZC,SAAU,GACVC,UAAW,SACXC,WAAY,SACZC,WAAY,GACZC,UAAW,OACXC,SAAU,GAEd,IAAIvb,EAAkB3B,EAAawc,EAAQW,MAAMhZ,MAAM,WAAaqY,EAAQW,MAAMhZ,MAAM,WACxF3E,KAAKkd,YAAYC,OAAQ,EAAIJ,EAAmBa,kBAAkBzb,GAAiB0b,SAAS,IAAKC,SACrG,CAmIA,OAlIAlb,EAAesC,UAAUhC,YAAc,SAAUD,GAG7C,IAFA,IAAI8a,EAAY5T,OAAOkS,KAAKpZ,EAAawD,OACrC2V,EAAQ2B,EAAU3Z,OACb0G,EAAI,EAAGA,EAAIsR,EAAOtR,IAAK,CAC5B,IAAI0K,EAAWuI,EAAUjT,GACrB2K,EAAYxS,EAAawD,MAAM+O,GACnCxV,KAAKge,gBAAgBxI,EAAUC,GAC/BzV,KAAKie,cAAczI,EAAUC,EACjC,CAEAzV,KAAKke,2BACT,EACAtb,EAAesC,UAAUgZ,0BAA4B,WACjD,GAAIle,KAAKyC,cAAcqN,eAAgB,CACnC,IAAIqO,EAAyBne,KAAKyC,cAAcqX,qBAAqB9Z,KAAKyC,cAAcqW,sBAAuB9Y,KAAKyC,cAAcqN,eAAe4J,KAAM1Z,KAAKyC,cAAcqN,eAAe9C,aACrLoR,EAAuBpe,KAAKyC,cAAckW,gBACxC3Y,KAAKyC,cAAckW,gBAAgB5R,OAAOC,SAC1CmX,EACI,KACAne,KAAKyC,cAAcqW,sBACzBsF,GACApe,KAAKqe,qBAAqBre,KAAKyC,cAAcqN,eAAe4J,KAAM1Z,KAAKyC,cAAcqN,eAAe9C,YAAaoR,GAAsB,GAAM,EAErJ,CACJ,EACAxb,EAAesC,UAAU8Y,gBAAkB,SAAUxI,EAAUC,GAC3D,IAAI6I,EAAiBte,KAAKyC,cAAcoG,mBAAqB2M,EACzDwE,EAAoBha,KAAKyC,cAAcuX,kBAAkBxE,GAC7DxV,KAAKU,GAAGsC,KAAK+Y,KAAKvG,EAAUC,EAAU1O,OAAOC,SAASC,EAAGwO,EAAU1O,OAAOC,SAASE,EAAIlH,KAAKsC,QAAQE,OAAQ8Z,EAASA,EAAS,CAAC,EAAGtc,KAAKkd,aAAc,CAAEC,MAAO,UAC9Jnd,KAAKU,GAAGqC,KAAKwb,KAAK9I,EAAU1O,OAAOC,SAAUhH,KAAKsC,QAAQC,MAAOvC,KAAKsC,QAAQE,OAAQ8b,EAAiB,sBAAwB,oBAAqB,GAE/I7I,EAAU7O,GAA4B,IAAvB6O,EAAU7O,EAAExC,QAA6B,UAAboR,IAAwBwE,GACpEha,KAAKU,GAAGsC,KAAKub,KAAK,CAAEtX,EAAGwO,EAAU1O,OAAOC,SAASC,EAAGC,EAAGuO,EAAU1O,OAAOC,SAASE,GAAKlH,KAAKsC,QAAQC,MAAOvC,KAAKsC,QAAQE,OAAQwX,EAAoB,sBAAwBsE,EAAiB,sBAAwB,oBAAqB,GAE7Ote,KAAKU,GAAGsC,KAAK+Y,KAAKtG,EAAU9O,EAAK2X,EAAiB7I,EAAU9O,EAAInH,EAAgBkD,aAAa6V,UAAU9C,EAAU9O,EAAG3G,KAAKid,iBAAoB,YAAaxH,EAAU1O,OAAOC,SAASC,EAAGwO,EAAU1O,OAAOC,SAASE,EAAGlH,KAAKkd,YAC7N,EACAta,EAAesC,UAAU+Y,cAAgB,SAAUzI,EAAUC,GAIzD,IAHA,IAAI6I,EAAiBte,KAAKyC,cAAcoG,mBAAqB2M,EACzDgJ,EAAU/I,EAAU1O,OAAOC,SAASE,EAAIlH,KAAKsC,QAAQE,OACrDic,EAAUhJ,EAAU1O,OAAOC,SAASC,EAAIrE,EAAemX,gBAClD+B,EAAI,EAAGA,EAAIrG,EAAU7O,EAAExC,OAAQ0X,IAAK,CACzC,IAAI3F,EAASV,EAAU7O,EAAEkV,GAGrB4C,IAD8D,OAAtC1e,KAAKyC,cAAcqN,iBAA4B9P,KAAKyC,cAAc0X,iBAAiB3E,EAAUsG,KAC3E9b,KAAKyC,cAAcyX,oBAAoB1E,EAAUsG,GAC3FxD,EAAatY,KAAKyC,cAAc0X,iBAAiB3E,EAAUsG,GAM/D,IALI4C,GAAiBpG,IACjBtY,KAAKU,GAAGsC,KAAKub,KAAK,CAAEtX,EAAGwX,EAASvX,EAAGsX,GAAWxe,KAAKsC,QAAQC,MAAOvC,KAAKsC,QAAQE,OAAQ,sBAAuB,GAElHxC,KAAKU,GAAGqC,KAAKwb,KAAK,CAAEtX,EAAGwX,EAASvX,EAAGsX,GAAWxe,KAAKsC,QAAQC,MAAOvC,KAAKsC,QAAQE,OAAQ,OAAQ,GAC/FxC,KAAKU,GAAGsC,KAAK+Y,KAAK5F,EAAOtP,EAAKyX,EAAiBnI,EAAOtP,EAAIrH,EAAgBkD,aAAa6V,UAAUpC,EAAOtP,EAAG7G,KAAKid,iBAAoB,YAAawB,EAASD,EAASlC,EAASA,EAAS,CAAC,EAAGtc,KAAKkd,aAAc,CAAEC,MAAOuB,GAAiBpG,EAAa,QAAU,UACzPoG,GAAiBpG,EAAY,CAE7B,IAAIqG,EAAK,IAAIrf,EAAkB0P,OAAOyG,EAAU1O,OAAOC,UAAU4X,MAAM5e,KAAKsC,QAAQC,MAAQ,GAAIvC,KAAKsC,QAAQE,OAAS,GAAOsZ,EAAI,IAAM9b,KAAKsC,QAAQE,OAAS,GAAK,GAClKxC,KAAKU,GAAGsC,KAAK6b,OAAOF,EAAI,EAAG,SAC/B,CACAH,GAAWxe,KAAKsC,QAAQE,OAAS,CACrC,CACJ,EACAI,EAAesC,UAAU/B,kBAAoB,SAAUF,GAGnD,IAFA,IAAI8a,EAAY5T,OAAOkS,KAAKpZ,EAAawD,OACrC2V,EAAQ2B,EAAU3Z,OACb0G,EAAI,EAAGA,EAAIsR,EAAOtR,IAGvB,IAFA,IAAI0K,EAAWuI,EAAUjT,GACrB2K,EAAYxS,EAAawD,MAAM+O,GAC1BsG,EAAI,EAAGA,EAAIrG,EAAU7O,EAAExC,OAAQ0X,IAAK,CACzC,IAAIgD,EAAgBrJ,EAAU7O,EAAEkV,GAAGhV,KACnC,GAAKgY,EAAL,CAGA,IAAIC,EAAgB9b,EAAawD,MAAMqY,GACvC,GAAKC,EAAL,CAGA,IAAIL,EAAgB1e,KAAKyC,cAAcyX,oBAAoB1E,EAAUsG,GACjEkD,EAA8D,OAAtChf,KAAKyC,cAAcqN,iBAA4B9P,KAAKyC,cAAc0X,iBAAiB3E,EAAUsG,GACrHxD,EAAatY,KAAKyC,cAAc0X,iBAAiB3E,EAAUsG,GAE/D9b,KAAKqe,qBAAqB5I,EAAWqG,EAAGiD,EAAchY,OAAOC,SAAU0X,IAAkBM,EAAuB1G,EALhH,CAJA,CAUJ,CAER,EACA1V,EAAesC,UAAUmZ,qBAAuB,SAAU5I,EAAWqG,EAAGmD,EAAuBP,EAAepG,GAE1G,IAAIqG,EAAK,IAAIrf,EAAkB0P,OAAOyG,EAAU1O,OAAOC,UAAU4X,MAAM5e,KAAKsC,QAAQC,MAAQ,GAAIvC,KAAKsC,QAAQE,OAAS,GAAOsZ,EAAI,IAAM9b,KAAKsC,QAAQE,OAAS,GAAK,GAC9J0c,EAAK,IAAI5f,EAAkB0P,OAAOiQ,GAClCE,EAAKR,EAAGxC,QAAQyC,MAAM,GAAI,GAC1BQ,EAAKF,EAAG/C,QAAQkD,MAAM,GAAI,IAC1BC,EAAWtf,KAAKU,GAAGI,kBAAkBye,kBACrCD,IAEIZ,EACA1e,KAAKU,GAAGqC,KAAKyc,IAAIC,YAAY,CAAC,GAAI,IAGlCzf,KAAKU,GAAGqC,KAAKyc,IAAIC,YAAY,CAAC,KAGtCzf,KAAK0f,iBAAiBf,EAAIO,EAAIC,EAAIC,EAAIV,GAAiBpG,EAAa,sBAAwB,sBAAuB,GAC/GgH,GACAtf,KAAKU,GAAGqC,KAAKyc,IAAIC,YAAY,CAAC,GAEtC,EAaA7c,EAAesC,UAAUwa,iBAAmB,SAAUf,EAAIO,EAAIC,EAAIC,EAAIjC,EAAOwC,GACzE,IAAIjP,EAAQ1Q,KAER4f,EAAWtgB,EAAkB0P,OAAOpO,MACnCif,eAAeT,EAAIF,EAFV,EAEuB,EAAK,GACrCtO,KAAI,SAAUkP,GACf,OAAOA,EAAO9E,MAAM,EAAMtK,EAAMhQ,GAAGqC,KAAKiY,MAAM/T,EAAGiY,EACrD,IACAlf,KAAKU,GAAGqC,KAAKgd,YAAYpB,EAAIO,EAAIC,EAAIC,EAAIjC,EAAOwC,GAChD3f,KAAKU,GAAGsC,KAAKgd,SAASJ,GAAU,EAAOzC,EAAOwC,EAIlD,EACA/c,EAAemX,gBAAkB,GAC1BnX,CACX,CAtJmC,GAuJnCzD,EAAQyD,eAAiBA,C,gBC1IzByC,WAAW9E,IAAM,WACjB8E,WAAW5E,eAAiB,sBAC5B4E,WAAWgD,iBAAmB,wBAC9BhD,WAAWsM,cAAgB,qBAC3BtM,WAAW2T,oBAAsB,2BACjC3T,WAAWW,MAAQ,YACnBX,WAAW3C,aAAe,oBAC1B2C,WAAWgE,aAAe,oBAC1BhE,WAAWxF,OAAS,QAEpBO,QAAQC,IAAI,SAAUR,O,2BClDtBsK,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQoB,SAAM,EAkBdpB,EAAQoB,IAZE,WACN,IAAI0f,EAAO,CAAC,EACAjb,OAAOkb,SAAS/M,KAAKgN,QAAQ,2BAA2B,SAAUC,EAAInI,EAAK5N,GAEnF,IADA,IAAIgW,EAAO,GACFC,EAAK,EAAGA,EAAK3D,UAAUvY,OAAQkc,IACpCD,EAAKC,EAAK,GAAK3D,UAAU2D,GAG7B,OADAL,EAAKhI,GAAO5N,EACLA,CACX,IACA,OAAO4V,CACX,C,6BCXA9V,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQ6Z,yBAAsB,EAC9B,IAAIpZ,EAAU,EAAQ,IAClBoZ,EAAqC,WACrC,SAASA,EAAoBvW,GACzBzC,KAAKyC,cAAgBA,EACrB1B,SAASC,eAAe,oBAAoB+C,iBAAiB,QAAS/D,KAAKugB,kBAC/E,CA+FA,OA9FAvH,EAAoB9T,UAAUqb,gBAAkB,WAC5C,IAAI7P,EAAQ1Q,KACRG,EAAQH,KACZ,OAAO,WACHG,EAAMqgB,SAAWxH,EAAoByH,UAAU/P,EAAMjO,cAAc6E,0BAA0BhB,MAC7FnG,EAAMsC,cAAc+C,UAAUG,MAAMC,SAAS,6BAC7CzF,EAAMsC,cAAc+C,UAAUG,MAAME,QAAQ1F,EAAMugB,iBAClDvgB,EAAMsC,cAAc+C,UAAUG,MAAMG,UAAU,IAC9C3F,EAAMsC,cAAc+C,UAAUG,MAAMI,WAAW,CAAC,CAAEG,MAAO,OAAQC,OAAQhG,EAAMwgB,cAAgB/gB,EAAQoG,MAAMC,gBAC7G9F,EAAMsC,cAAc+C,UAAUG,MAAMV,MACxC,CACJ,EACA+T,EAAoB9T,UAAU0b,gBAAkB,WAC5C,IAAIC,EAAU7gB,KAAK0gB,gBACnB1gB,KAAKyC,cAAc+C,UAAUG,MAAME,QAAQgb,EAC/C,EACA7H,EAAoB9T,UAAUwb,cAAgB,WAC1C,IAAII,EAAW/f,SAAS2G,cAAc,OACtC1H,KAAK+gB,UAAYhgB,SAAS2G,cAAc,SACxC1H,KAAK+gB,UAAU1W,MAAQrK,KAAKwgB,SAASja,KACrCvG,KAAK+gB,UAAUhd,iBAAiB,SAAU/D,KAAKghB,wBAC/C,IAAIC,EAAYlgB,SAAS2G,cAAc,OACvCuZ,EAAUrZ,UAAY,gBACtB,IAAIsZ,EAAengB,SAAS2G,cAAc,OAC1CwZ,EAAarZ,UAAUC,IAAI,uBAC3B9H,KAAKmhB,eAAiB,GACtB,IAAK,IAAIrW,EAAI,EAAGA,EAAI9K,KAAKwgB,SAASha,KAAKpC,OAAQ0G,IAAK,CAChD,IAAIoM,EAAYnW,SAAS2G,cAAc,OACnCxB,EAAQnF,SAAS2G,cAAc,OACnCxB,EAAM0B,UAAY,QAAQiF,OAAO/B,GACjC,IAAIsW,EAAergB,SAAS2G,cAAc,SAC1C0Z,EAAa/W,MAAQrK,KAAKwgB,SAASha,KAAKsE,GAAGvE,KAC3C6a,EAAard,iBAAiB,SAAU/D,KAAKqhB,oBAAoBvW,IACjE,IAAIwW,EAAYvgB,SAAS2G,cAAc,UACvC4Z,EAAU1Z,UAAY,YACtB0Z,EAAUvd,iBAAiB,QAAS/D,KAAKuhB,gBAAgBzW,IACzDoM,EAAU/O,YAAYjC,GACtBgR,EAAU/O,YAAYiZ,GACtBlK,EAAU/O,YAAYmZ,GACtBJ,EAAa/Y,YAAY+O,GACzBlX,KAAKmhB,eAAepW,KAAKqW,EAC7B,CACA,IAAII,EAAYzgB,SAAS2G,cAAc,UAOvC,OANA8Z,EAAU5Z,UAAY,UACtB4Z,EAAUzd,iBAAiB,QAAS/D,KAAKyhB,gBACzCX,EAAS3Y,YAAY8Y,GACrBH,EAAS3Y,YAAYnI,KAAK+gB,WAC1BD,EAAS3Y,YAAY+Y,GACrBJ,EAAS3Y,YAAYqZ,GACdV,CACX,EACA9H,EAAoB9T,UAAU8b,qBAAuB,WACjD,IAAI7gB,EAAQH,KACZ,OAAO,SAAUmR,GACbhR,EAAMqgB,SAASja,KAAO4K,EAAM6C,OAAO3J,KACvC,CACJ,EACA2O,EAAoB9T,UAAUmc,oBAAsB,SAAUpV,GAC1D,IAAI9L,EAAQH,KACZ,OAAO,SAAUmR,GACbhR,EAAMqgB,SAASha,KAAKyF,GAAO1F,KAAO4K,EAAM6C,OAAO3J,KACnD,CACJ,EACA2O,EAAoB9T,UAAUqc,gBAAkB,SAAUtV,GACtD,IAAI9L,EAAQH,KACZ,OAAO,WACHG,EAAMqgB,SAASha,KAAKyE,OAAOgB,EAAO,GAClC9L,EAAMygB,iBACV,CACJ,EACA5H,EAAoB9T,UAAUuc,aAAe,WACzC,IAAIthB,EAAQH,KACZ,OAAO,WACHG,EAAMqgB,SAASha,KAAKuE,KAAK,CAAExE,KAAM,YACjCpG,EAAMygB,iBACV,CACJ,EACA5H,EAAoB9T,UAAUyb,WAAa,WACvC,IAAIxgB,EAAQH,KACZ,OAAO,WACHG,EAAMsC,cAAc6E,0BAA0BhB,KAAOnG,EAAMqgB,SAC3DrgB,EAAMsC,cAAc+C,UAAUG,MAAMS,QACpCjG,EAAMsC,cAAc+C,UAAUsP,mBAClC,CACJ,EACAkE,EAAoByH,UAAY,SAAUna,GACtC,IAAIob,EAAO,CAAC,EACZA,EAAKnb,KAAOD,EAAKC,KACjBmb,EAAKlb,KAAO,GACZ,IAAK,IAAIsE,EAAI,EAAGA,EAAIxE,EAAKE,KAAKpC,OAAQ0G,IAClC4W,EAAKlb,KAAKuE,KAAK,CAAExE,KAAMD,EAAKE,KAAKsE,GAAGvE,OAExC,OAAOmb,CACX,EACO1I,CACX,CApGwC,GAqGxC7Z,EAAQ6Z,oBAAsBA,C,0BCpG9B7O,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,IACtDlL,EAAQ6G,WAAQ,EAChB,IAAIA,EAAuB,WACvB,SAASA,IACLhG,KAAK2hB,cAAgB3hB,KAAK4hB,aAAa,WAAa5b,EAAM6b,gBAC9D,CAmIA,OAlIA7b,EAAMd,UAAUU,SAAW,SAAUkc,GACjC9hB,KAAK2hB,cAAchc,MAAMoc,OAAOC,QAAQpa,UAAYka,CACxD,EACA9b,EAAMd,UAAUW,QAAU,SAAUoc,GAC5Bjc,EAAMkc,UAAUD,IAChBjc,EAAMmc,iBAAiBniB,KAAK2hB,cAAchc,MAAMyc,KAAKJ,SACrDhiB,KAAK2hB,cAAchc,MAAMyc,KAAKJ,QAAQK,OAAOJ,IAG7CjiB,KAAK2hB,cAAchc,MAAMyc,KAAKJ,QAAQpa,UAAYqa,CAE1D,EACAjc,EAAMd,UAAUY,UAAY,SAAUgc,GACb,iBAAVA,EACP9hB,KAAK2hB,cAAchc,MAAM2c,OAAON,QAAQpa,UAA4B,GAAhBka,EAAM1d,OAAc,SAAW0d,EAGnF1hB,QAAQC,IAAI,mBAEpB,EACA2F,EAAMd,UAAUa,WAAa,SAAUwc,GACnC,IAAIpiB,EAAQH,KAEZ,GADAgG,EAAMmc,iBAAiBniB,KAAK2hB,cAAchc,MAAM2c,OAAOC,SACnDC,MAAMC,QAAQF,GACd,IAAK,IAAIzX,KAAKyX,EAAS,CACnB,IAAI1b,EAAI0b,EAAQzX,GACZ4X,EAAM,KACNC,EAAM5hB,SAAS2G,cAAc,UACjCib,EAAI/a,UAAYf,EAAEX,MACM,mBAAbW,EAAEV,OACTwc,EAAI5e,iBAAiB,QAAS8C,EAAEV,SAEb,iBAANU,GAA+B,OAAZ6b,EAAM7b,IAAoC,iBAAbA,EAAEV,QAA2C,OAAnBuc,EAAM7b,EAAEV,WACnF,WAARuc,GAA4B,OAARA,GAAwB,UAARA,GACpCC,EAAI5e,iBAAiB,SAAS,WAC1B5D,EAAMiG,OACV,KAERpG,KAAK2hB,cAAchc,MAAM2c,OAAOC,QAAQpa,YAAYwa,EACxD,CAER,EACA3c,EAAMd,UAAUkB,MAAQ,WACpBpG,KAAK2hB,cAAchc,MAAMid,OAAO/a,UAAUiM,OAAO,gBACjD9T,KAAK2hB,cAAchc,MAAMid,OAAO/a,UAAUC,IAAI,eAClD,EACA9B,EAAMd,UAAUD,KAAO,WACnBjF,KAAK2hB,cAAchc,MAAMid,OAAO/a,UAAUiM,OAAO,gBACjD9T,KAAK2hB,cAAchc,MAAMid,OAAO/a,UAAUC,IAAI,eAClD,EACA9B,EAAMd,UAAU0c,aAAe,SAAUiB,GACrC,IAAI1iB,EAAQH,KACR2F,EAAQ5E,SAAS2G,cAAc,OACnC/B,EAAMgC,aAAa,KAAMkb,GACzBld,EAAMkC,UAAUC,IAAI,SACpBnC,EAAMkC,UAAUC,IAAI,gBACpB,IAAIka,EAAUjhB,SAAS2G,cAAc,OACrCsa,EAAQna,UAAUC,IAAI,iBACtB,IAAIia,EAAShhB,SAAS2G,cAAc,OACpCqa,EAAOla,UAAUC,IAAI,gBACrB,IAAIgb,EAAW/hB,SAAS2G,cAAc,QACtCob,EAASjb,UAAUC,IAAI,eACvBgb,EAASlb,UAAY,UACrB,IAAImb,EAAKhiB,SAAS2G,cAAc,MAChCqb,EAAGnb,UAAY,eACf,IAAIwa,EAAOrhB,SAAS2G,cAAc,OAClC0a,EAAKva,UAAUC,IAAI,cAEnB,IAAIma,EAAclhB,SAAS2G,cAAc,KACzCua,EAAYra,UAAY,8BACxB,IAAI0a,EAASvhB,SAAS2G,cAAc,OACpC4a,EAAOza,UAAUC,IAAI,gBACrB,IAAIkb,EAAgBjiB,SAAS2G,cAAc,MACvCub,EAAgBliB,SAAS2G,cAAc,OAkB3C,OAjBAsb,EAAcpb,UAAY,eAC1Bqb,EAAcpb,UAAUC,IAAI,iBAC5Bwa,EAAOna,YAAY6a,GACnBV,EAAOna,YAAY8a,GACnBlB,EAAO5Z,YAAY2a,GACnBf,EAAO5Z,YAAY4a,GACnBf,EAAQ7Z,YAAY4Z,GACpBK,EAAKja,YAAY8Z,GACjBD,EAAQ7Z,YAAYia,GACpBJ,EAAQ7Z,YAAYma,GACpB3c,EAAMwC,YAAY6Z,GAElBc,EAASI,QAAU,WACf/iB,EAAMiG,OACV,EAEArF,SAASoiB,qBAAqB,QAAQ,GAAGhb,YAAYxC,GAC9C,CACHA,MAAO,CACHkd,GAAIA,EACJD,OAAQjd,EACRoc,OAAQ,CACJe,SAAUA,EACVd,QAASe,GAEbX,KAAM,CAAEJ,QAASC,GACjBK,OAAQ,CACJN,QAASgB,EACTT,QAASU,IAIzB,EAEAjd,EAAMkc,UAAY,SAAUkB,GACxB,IAEI,OAAOA,aAAeC,WAC1B,CACA,MAAOxS,GAIH,MAAuB,iBAARuS,GAAqC,IAAjBA,EAAIE,UAAuC,iBAAdF,EAAIG,OAAmD,iBAAtBH,EAAII,aACzG,CACJ,EACAxd,EAAM+B,aAAe,CAAE7B,MAAO,QAASC,OAAQ,SAC/CH,EAAMC,cAAgB,CAAEC,MAAO,SAAUC,OAAQ,SACjDH,EAAMyd,UAAY,CAAEvd,MAAO,KAAMC,OAAQ,SACzCH,EAAM6b,cAAgB,EACtB7b,EAAMmc,iBAAmB,SAAUzI,GAE/B,KAAOA,EAAKgK,YACRhK,EAAKiK,YAAYjK,EAAKkK,UAE9B,EACO5d,CACX,CAvI0B,GAwI1B7G,EAAQ6G,MAAQA,C,GCrJZ6d,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBhY,IAAjBiY,EACH,OAAOA,EAAa7kB,QAGrB,IAAI8kB,EAASJ,EAAyBE,GAAY,CAGjD5kB,QAAS,CAAC,GAOX,OAHA+kB,EAAoBH,GAAUlH,KAAKoH,EAAO9kB,QAAS8kB,EAAQA,EAAO9kB,QAAS2kB,GAGpEG,EAAO9kB,OACf,CAGA2kB,EAAoBK,EAAID,EZzBpBhlB,EAAW,GACf4kB,EAAoBM,EAAI,CAAC3f,EAAQ4f,EAAU5T,EAAI6T,KAC9C,IAAGD,EAAH,CAMA,IAAIE,EAAeC,IACnB,IAAS1Z,EAAI,EAAGA,EAAI5L,EAASkF,OAAQ0G,IAAK,CAGzC,IAFA,IAAKuZ,EAAU5T,EAAI6T,GAAYplB,EAAS4L,GACpC2Z,GAAY,EACP3I,EAAI,EAAGA,EAAIuI,EAASjgB,OAAQ0X,MACpB,EAAXwI,GAAsBC,GAAgBD,IAAana,OAAOkS,KAAKyH,EAAoBM,GAAGM,OAAOzM,GAAS6L,EAAoBM,EAAEnM,GAAKoM,EAASvI,MAC9IuI,EAASpZ,OAAO6Q,IAAK,IAErB2I,GAAY,EACTH,EAAWC,IAAcA,EAAeD,IAG7C,GAAGG,EAAW,CACbvlB,EAAS+L,OAAOH,IAAK,GACrB,IAAI6Z,EAAIlU,SACE1E,IAAN4Y,IAAiBlgB,EAASkgB,EAC/B,CACD,CACA,OAAOlgB,CAnBP,CAJC6f,EAAWA,GAAY,EACvB,IAAI,IAAIxZ,EAAI5L,EAASkF,OAAQ0G,EAAI,GAAK5L,EAAS4L,EAAI,GAAG,GAAKwZ,EAAUxZ,IAAK5L,EAAS4L,GAAK5L,EAAS4L,EAAI,GACrG5L,EAAS4L,GAAK,CAACuZ,EAAU5T,EAAI6T,EAqBjB,EazBdR,EAAoBc,EAAI,CAACzlB,EAAS0lB,KACjC,IAAI,IAAI5M,KAAO4M,EACXf,EAAoBld,EAAEie,EAAY5M,KAAS6L,EAAoBld,EAAEzH,EAAS8Y,IAC5E9N,OAAOC,eAAejL,EAAS8Y,EAAK,CAAE6M,YAAY,EAAMzX,IAAKwX,EAAW5M,IAE1E,ECND6L,EAAoBiB,EAAI,WACvB,GAA0B,iBAAf1f,WAAyB,OAAOA,WAC3C,IACC,OAAOrF,MAAQ,IAAIglB,SAAS,cAAb,EAChB,CAAE,MAAOnU,GACR,GAAsB,iBAAX7L,OAAqB,OAAOA,MACxC,CACA,CAPuB,GCAxB8e,EAAoBld,EAAI,CAACwc,EAAK6B,IAAU9a,OAAOjF,UAAUmM,eAAewL,KAAKuG,EAAK6B,GCClFnB,EAAoBa,EAAKxlB,IACH,oBAAX+lB,QAA0BA,OAAOC,aAC1Chb,OAAOC,eAAejL,EAAS+lB,OAAOC,YAAa,CAAE9a,MAAO,WAE7DF,OAAOC,eAAejL,EAAS,aAAc,CAAEkL,OAAO,GAAO,E,MCA9D,IAAI+a,EAAkB,CACrB,IAAK,GAaNtB,EAAoBM,EAAEtI,EAAKuJ,GAA0C,IAA7BD,EAAgBC,GAGxD,IAAIC,EAAuB,CAACC,EAA4BhY,KACvD,IAGIwW,EAAUsB,GAHThB,EAAUmB,EAAaC,GAAWlY,EAGhBzC,EAAI,EAC3B,GAAGuZ,EAASqB,MAAM7C,GAAgC,IAAxBuC,EAAgBvC,KAAa,CACtD,IAAIkB,KAAYyB,EACZ1B,EAAoBld,EAAE4e,EAAazB,KACrCD,EAAoBK,EAAEJ,GAAYyB,EAAYzB,IAGhD,GAAG0B,EAAS,IAAIhhB,EAASghB,EAAQ3B,EAClC,CAEA,IADGyB,GAA4BA,EAA2BhY,GACrDzC,EAAIuZ,EAASjgB,OAAQ0G,IACzBua,EAAUhB,EAASvZ,GAChBgZ,EAAoBld,EAAEwe,EAAiBC,IAAYD,EAAgBC,IACrED,EAAgBC,GAAS,KAE1BD,EAAgBC,GAAW,EAE5B,OAAOvB,EAAoBM,EAAE3f,EAAO,EAGjCkhB,EAAqBC,KAA+B,yBAAIA,KAA+B,0BAAK,GAChGD,EAAmBE,QAAQP,EAAqBQ,KAAK,KAAM,IAC3DH,EAAmB5a,KAAOua,EAAqBQ,KAAK,KAAMH,EAAmB5a,KAAK+a,KAAKH,G,KC7CvF,IAAII,EAAsBjC,EAAoBM,OAAErY,EAAW,CAAC,MAAM,IAAO+X,EAAoB,OAC7FiC,EAAsBjC,EAAoBM,EAAE2B,E","sources":["webpack://rpg-dialogue/webpack/runtime/chunk loaded","webpack://rpg-dialogue/./dist/cjs/Editor.js","webpack://rpg-dialogue/./dist/cjs/RPGDialogueLogic.js","webpack://rpg-dialogue/./dist/cjs/TouchHandler.js","webpack://rpg-dialogue/./dist/cjs/detectDarkMode.js","webpack://rpg-dialogue/./dist/cjs/domHelpers.js","webpack://rpg-dialogue/./dist/cjs/editorHelpers.js","webpack://rpg-dialogue/./dist/cjs/editorRenderer.js","webpack://rpg-dialogue/./dist/cjs/entry.js","webpack://rpg-dialogue/./dist/cjs/gup.js","webpack://rpg-dialogue/./dist/cjs/metaHelpers.js","webpack://rpg-dialogue/./dist/cjs/modal.js","webpack://rpg-dialogue/webpack/bootstrap","webpack://rpg-dialogue/webpack/runtime/define property getters","webpack://rpg-dialogue/webpack/runtime/global","webpack://rpg-dialogue/webpack/runtime/hasOwnProperty shorthand","webpack://rpg-dialogue/webpack/runtime/make namespace object","webpack://rpg-dialogue/webpack/runtime/jsonp chunk loading","webpack://rpg-dialogue/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","\"use strict\";\n/**\n * A script for demonstrating the line-point-distance.\n *\n * @require PlotBoilerplate, MouseHandler, gup, dat.gui\n *\n * @author   Ikaros Kappler\n * @date     2023-07-25\n * @version  1.0.0\n **/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Editor = void 0;\nvar gup_1 = require(\"./gup\");\nvar detectDarkMode_1 = require(\"./detectDarkMode\");\nvar plotboilerplate_1 = require(\"plotboilerplate\");\nvar RPGDialogueLogic_1 = require(\"./RPGDialogueLogic\");\nvar editorHelpers_1 = require(\"./editorHelpers\");\nvar editorRenderer_1 = require(\"./editorRenderer\");\nvar TouchHandler_1 = require(\"./TouchHandler\");\nvar FileDrop_1 = require(\"plotboilerplate/src/cjs/utils/io/FileDrop\");\nvar modal_1 = require(\"./modal\");\nvar Editor = /** @class */ (function () {\n    function Editor(dialogueConfigJSONPath, isRecoveryFromLocalStorageActive) {\n        this.currentMouseHandler = null;\n        this.currentTouchHandler = null;\n        var _self = this;\n        console.log(\"Initialize plotboilerplate\");\n        // Fetch the GET params\n        var GUP = (0, gup_1.gup)();\n        var isDarkmode = (0, detectDarkMode_1.detectDarkMode)(GUP);\n        // All config params are optional.\n        this.pb = new plotboilerplate_1.PlotBoilerplate(plotboilerplate_1.PlotBoilerplate.utils.safeMergeByKeys({\n            canvas: document.getElementById(\"my-canvas\"),\n            fullSize: true,\n            fitToParent: true,\n            scaleX: 1.0,\n            scaleY: 1.0,\n            rasterGrid: true,\n            drawOrigin: false,\n            rasterAdjustFactor: 2.0,\n            redrawOnResize: true,\n            defaultCanvasWidth: 1024,\n            defaultCanvasHeight: 768,\n            canvasWidthFactor: 1.0,\n            canvasHeightFactor: 1.0,\n            cssScaleX: 1.0,\n            cssScaleY: 1.0,\n            cssUniformScale: true,\n            autoAdjustOffset: true,\n            offsetAdjustXPercent: 50,\n            offsetAdjustYPercent: 50,\n            backgroundColor: isDarkmode ? \"#000000\" : \"#ffffff\",\n            enableMouse: true,\n            enableKeys: true\n        }, GUP));\n        var boxSize = {\n            width: 120,\n            height: 20\n        };\n        this.editorHelpers = new editorHelpers_1.EditorHelper(this, this.pb, boxSize);\n        this.editorRenderer = new editorRenderer_1.EditorRenderer(this.pb, boxSize, this.editorHelpers, isDarkmode);\n        // +---------------------------------------------------------------------------------\n        // | The render method.\n        // +-------------------------------\n        this.pb.config.postDraw = function (draw, fill) {\n            if (!_self.dialogConfig) {\n                return;\n            }\n            _self.editorRenderer.renderBoxes(_self.dialogConfig);\n            _self.editorRenderer.renderConnections(_self.dialogConfig);\n        };\n        if (isRecoveryFromLocalStorageActive) {\n            console.log(\"Trying to recover config from localstorage.\");\n            this.tryLoadFromLocalStorage()\n                .then(function (dc) {\n                _self.handleDialogConfigLoaded(dc);\n            })\n                .catch(function () {\n                console.log(\"Loading from localstorage failed. Falling back loading from specified path.\");\n                _self.tryLoadFromJSON(dialogueConfigJSONPath);\n            });\n        }\n        else {\n            _self.tryLoadFromJSON(dialogueConfigJSONPath);\n        }\n        // Install DnD with FileDrop\n        var fileDrop = new FileDrop_1.FileDrop(this.pb.eventCatcher);\n        fileDrop.onFileJSONDropped(function (jsonObject) {\n            console.log(\"[onFileJSONDropped] jsonObject\", jsonObject);\n            // TODO: properly convert to dialog-config\n            _self.handleDialogConfigLoaded(editorHelpers_1.EditorHelper.fromObject(jsonObject));\n        });\n        // Also accept uploads via button\n        var importJSON = function () {\n            document.getElementById(\"input-upload-file\").click();\n        };\n        document.getElementById(\"b-import-json\").addEventListener(\"click\", importJSON);\n        document.getElementById(\"input-upload-file\").addEventListener(\"change\", function (_evt) {\n            var fileInput = document.getElementById(\"input-upload-file\");\n            if (!fileInput.files || fileInput.files.length === 0) {\n                return;\n            }\n            console.log(\"inputFile\", fileInput.files[0]);\n            var reader = new FileReader();\n            reader.onload = function () {\n                var jsonText = reader.result;\n                console.log(reader.result);\n                _self.handleDialogConfigLoaded(editorHelpers_1.EditorHelper.fromObject(JSON.parse(jsonText)));\n            };\n            reader.readAsText(fileInput.files[0]);\n        });\n        document.getElementById(\"b-run-test\").addEventListener(\"click\", function () {\n            _self.testCurrentDialogueConfig();\n        });\n        document.getElementById(\"b-new\").addEventListener(\"click\", _self.requestCreateNewGraph());\n        document.getElementById(\"b-show-json\").addEventListener(\"click\", _self.showJSON());\n        document.getElementById(\"b-goto-github\").addEventListener(\"click\", function () {\n            window.open(\"https://github.com/IkarosKappler/rpg-dialogue\", \"_blank\");\n        });\n    }\n    Editor.prototype.tryStartAutosaveLoop = function () {\n        if (this.autosaveTimer) {\n            return;\n        }\n        var _self = this;\n        this.autosaveTimer = globalThis.setInterval(function () {\n            _self.tryAutoSave();\n        }, 10000);\n    };\n    Editor.prototype.tryAutoSave = function () {\n        if (this.editorHelpers.domHelper.isAutoSave()) {\n            // console.log(\"Putting to localstorage.\");\n            this.putToLocalStorage();\n        }\n    };\n    Editor.prototype.requestCreateNewGraph = function () {\n        var _self = this;\n        return function () {\n            _self.editorHelpers.domHelper.modal.setTitle(\"Drop current graph?\");\n            _self.editorHelpers.domHelper.modal.setBody(\"Do you really want to create a new graph and lose unsaved changes?\");\n            _self.editorHelpers.domHelper.modal.setFooter(\"\");\n            _self.editorHelpers.domHelper.modal.setActions([\n                modal_1.Modal.ACTION_CANCEL,\n                {\n                    label: \"Yes\",\n                    action: function () {\n                        _self.editorHelpers.domHelper.modal.close();\n                        _self.performNewGraph();\n                    }\n                }\n            ]);\n            _self.editorHelpers.domHelper.modal.open();\n        };\n    };\n    Editor.prototype.performNewGraph = function () {\n        var newConfig = {\n            meta: { name: \"dialogue_A\", npcs: [{ name: \"NPC #0\" }] },\n            graph: {\n                intro: { q: \"Hello world!\", o: [{ a: \"Hello, NPC!\", next: null }], editor: { position: { x: 0, y: 0 } } }\n            }\n        };\n        this.handleDialogConfigLoaded(newConfig);\n    };\n    Editor.prototype.showJSON = function () {\n        var _self = this;\n        return function () {\n            var removePositions = _self.editorHelpers.domHelper.isExportWithoutPositions();\n            var dConfig = removePositions\n                ? editorHelpers_1.EditorHelper.removePositions(_self.editorHelpers.dialogConfigWithPositions)\n                : _self.editorHelpers.dialogConfigWithPositions;\n            var jsonString = JSON.stringify(dConfig, null, 4);\n            var jsonArea = document.createElement(\"textarea\");\n            jsonArea.setAttribute(\"readonly\", \"true\");\n            jsonArea.innerHTML = jsonString;\n            jsonArea.classList.add(\"json-preview\");\n            _self.editorHelpers.domHelper.modal.setTitle(\"Current Graph as JSON\");\n            _self.editorHelpers.domHelper.modal.setBody(jsonArea);\n            _self.editorHelpers.domHelper.modal.setFooter(\"\");\n            _self.editorHelpers.domHelper.modal.setActions([modal_1.Modal.ACTION_CLOSE]);\n            _self.editorHelpers.domHelper.modal.open();\n        };\n    };\n    /**\n     * Open a modal and test the current dialogue config (runs a RPGDialogueLogic instant).\n     */\n    Editor.prototype.testCurrentDialogueConfig = function () {\n        var _self = this;\n        // Create this structure:\n        // <div class=\"rpg-output\">\n        //    <div class=\"rpg-output-question\"></div>\n        //    <ul class=\"rpg-output-options\"></ul>\n        // </div>\n        var outputContainer = document.createElement(\"div\");\n        var outputQuestion = document.createElement(\"div\");\n        var outputOptions = document.createElement(\"ul\");\n        outputContainer.classList.add(\"rpg-output\");\n        outputQuestion.classList.add(\"rpg-output-question\");\n        outputOptions.classList.add(\"rpg-output-options\");\n        outputContainer.appendChild(outputQuestion);\n        outputContainer.appendChild(outputOptions);\n        var dialogueListener = function (dialogueConfig, nextNodeName, oldNodeName, selectedOptionIndex) {\n            // Highlight current node in the graph editor :)\n            // console.log(\"nextNodeName\", nextNodeName, \"oldNodeName\", oldNodeName, \"selectedOptionIndex\", selectedOptionIndex);\n            _self.editorHelpers.setHighlightedNode(nextNodeName);\n        };\n        var rpgLogic = new RPGDialogueLogic_1.RPGDialogueLogic(this.dialogConfig, false);\n        rpgLogic.addDialogueChangeListener(dialogueListener);\n        var alternateStartNodeName = this.editorHelpers.selectedNodeName;\n        this.editorHelpers.setSelectedNode(null, null);\n        rpgLogic.beginConversation(outputQuestion, outputOptions, alternateStartNodeName);\n        this.editorHelpers.domHelper.modal.setTitle(\"Test\");\n        this.editorHelpers.domHelper.modal.setBody(outputContainer);\n        this.editorHelpers.domHelper.modal.setFooter(\"\");\n        this.editorHelpers.domHelper.modal.setActions([modal_1.Modal.ACTION_CLOSE]);\n        this.editorHelpers.domHelper.modal.open();\n    };\n    Editor.prototype.handleDialogConfigLoaded = function (config) {\n        // Check if all graph nodes have positions to render.\n        this.dialogConfig = this.editorHelpers.enrichPositions(config);\n        this.editorHelpers.enrichMetaData(this.dialogConfig);\n        console.log(\"Enriched meta data\", this.dialogConfig);\n        this.editorHelpers.setDialogConfig(this.dialogConfig);\n        // Ad DnD support for boxes.\n        if (this.currentMouseHandler) {\n            this.currentMouseHandler.destroy();\n            this.currentMouseHandler = null;\n        }\n        this.currentMouseHandler = this.editorHelpers.boxMovehandler(); // dialogConfig);\n        // Ad DnD support for boxes.\n        if (this.currentTouchHandler) {\n            this.currentTouchHandler.destroy();\n            this.currentTouchHandler = null;\n        }\n        this.currentTouchHandler = new TouchHandler_1.TouchHandler(this.pb, this.dialogConfig, this.editorHelpers);\n        this.pb.redraw();\n        this.tryStartAutosaveLoop();\n    };\n    Editor.prototype.putToLocalStorage = function () {\n        var jsonString = JSON.stringify(this.dialogConfig);\n        globalThis.localStorage.setItem(\"__rpgeditor.dialogueconfig\", jsonString);\n    };\n    Editor.prototype.tryLoadFromJSON = function (dialogueConfigJSONPath) {\n        var _self = this;\n        RPGDialogueLogic_1.RPGDialogueLogic.loadConfigFromJSON(dialogueConfigJSONPath).then(function (config) {\n            console.log(\"structure\", config);\n            _self.handleDialogConfigLoaded(config);\n        });\n    };\n    Editor.prototype.tryLoadFromLocalStorage = function () {\n        return new Promise(function (accept, reject) {\n            var jsonString = globalThis.localStorage.getItem(\"__rpgeditor.dialogueconfig\");\n            if (!jsonString || jsonString === \"\") {\n                reject();\n            }\n            try {\n                var jsonObject = JSON.parse(jsonString);\n                if (!jsonObject) {\n                    reject();\n                    return;\n                }\n                var dialogueConfig = editorHelpers_1.EditorHelper.fromObject(jsonObject);\n                accept(dialogueConfig);\n            }\n            catch (exception) {\n                console.warn(exception);\n                reject();\n            }\n        });\n    };\n    return Editor;\n}());\nexports.Editor = Editor;\n//# sourceMappingURL=Editor.js.map","\"use strict\";\n/**\n * @author  Ikaros Kappler\n * @date    2023-07-25\n * @version 1.0.0\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RPGDialogueLogic = void 0;\nvar axios_1 = __importDefault(require(\"axios\"));\nvar RPGDialogueLogic = /** @class */ (function () {\n    function RPGDialogueLogic(dialogueStruct, validateStructure) {\n        // this.name = \"RPGDialogue\";\n        this.structure = dialogueStruct;\n        this.listeners = [];\n        this.resetToBeginning();\n        if (validateStructure) {\n            this.validate();\n        }\n    }\n    RPGDialogueLogic.prototype.addDialogueChangeListener = function (listener) {\n        for (var i = 0; i < this.listeners.length; i++) {\n            if (this.listeners[i] === listener) {\n                return false;\n            }\n        }\n        this.listeners.push(listener);\n        return true;\n    };\n    RPGDialogueLogic.prototype.removeDialogueChangeListener = function (listener) {\n        for (var i = 0; i < this.listeners.length; i++) {\n            if (this.listeners[i] === listener) {\n                this.listeners.splice(i, 1);\n                return true;\n            }\n        }\n        return false;\n    };\n    RPGDialogueLogic.prototype.fireStateChange = function (nextNodeName, oldNodeName, selectedOptionIndex) {\n        for (var i = 0; i < this.listeners.length; i++) {\n            this.listeners[i](this.structure, nextNodeName, oldNodeName, selectedOptionIndex);\n        }\n    };\n    RPGDialogueLogic.prototype.getCurrentNpcName = function () {\n        var _a, _b, _c;\n        var npcIndex = (_a = this.currentQuestionaire.npcIndex) !== null && _a !== void 0 ? _a : 0;\n        var npcName = ((_c = (_b = this.structure.meta) === null || _b === void 0 ? void 0 : _b.npcs) === null || _c === void 0 ? void 0 : _c.length) > 0 ? this.structure.meta.npcs[npcIndex].name : null;\n        return npcName;\n    };\n    RPGDialogueLogic.prototype.loadCurrentQuestionaire = function (setQuestionText, addOptionNode) {\n        if (this.currentQuestionaire) {\n            var npcName = this.getCurrentNpcName();\n            setQuestionText(this.currentQuestionaire.q, npcName);\n            for (var i = 0; i < this.currentQuestionaire.o.length; i++) {\n                addOptionNode(this.currentQuestionaire.o[i].a, i);\n            }\n            return true;\n        }\n        return false;\n    };\n    /**\n     * Get the current mini questionaire or null if no current or next questionaire is available.\n     * @returns\n     */\n    RPGDialogueLogic.prototype.getCurrentQuestionaire = function () {\n        return this.currentQuestionaire;\n    };\n    /**\n     * Check if the end was reached or if there are more questions available\n     * @returns {boolean} false if there is a current question active.\n     */\n    RPGDialogueLogic.prototype.isEndReached = function () {\n        return this.currentQuestionaire === null || this.currentQuestionaire === undefined;\n    };\n    /**\n     * Give an answer to the current questionaire. Only valid answer indices will be acceped.\n     * @param {number} index\n     * @returns {boolean} true if the the index is valid.\n     */\n    RPGDialogueLogic.prototype.sendAnswer = function (index) {\n        if (index < 0 || index >= this.currentQuestionaire.o.length) {\n            return false;\n        }\n        var oldQuestionaireName = this.currentQuestionaireName;\n        var selectedAnswer = this.currentQuestionaire.o[index];\n        if (!selectedAnswer) {\n            return false;\n        }\n        if (!selectedAnswer.next) {\n            this.currentQuestionaireName = null;\n            this.currentQuestionaire = null;\n        }\n        else {\n            this.currentQuestionaireName = selectedAnswer.next;\n            var nextQuestionaire = this.structure.graph[this.currentQuestionaireName];\n            // Can be the final one!\n            if (!nextQuestionaire.o || nextQuestionaire.o.length === 0) {\n                this.currentQuestionaireName = null;\n                this.currentQuestionaire = null;\n            }\n            else {\n                this.currentQuestionaire = nextQuestionaire;\n            }\n        }\n        this.fireStateChange(this.currentQuestionaireName, oldQuestionaireName, index);\n        console.log(\"Next questionaire\", this.currentQuestionaire);\n        return true;\n    };\n    /**\n     * Find the initial mini questionaire.\n     */\n    RPGDialogueLogic.prototype.resetToBeginning = function (alternateStartNodeName) {\n        this.currentQuestionaireName = alternateStartNodeName !== null && alternateStartNodeName !== void 0 ? alternateStartNodeName : \"intro\";\n        this.currentQuestionaire = this.structure.graph[this.currentQuestionaireName];\n        if (!this.currentQuestionaire) {\n            throw \"Cannot initialize RPGDialogueLogic: structure does not have an 'intro' entry\";\n        }\n    };\n    /**\n     * Check if the current dialogue is still valid or reached its end.\n     */\n    RPGDialogueLogic.prototype.validate = function () {\n        // ...\n    };\n    RPGDialogueLogic.prototype.getHTMLElement = function (nodeId) {\n        return typeof nodeId === \"string\" ? document.getElementById(nodeId) : nodeId;\n    };\n    /**\n     * This is a convenient function for quickly integrating the dialogue logic into\n     * an existing HTML document with prepared two <div> elements for displaying\n     * the question and possible answers.\n     *\n     * @param {string|HTMLElement} questionNodeId - The output container (or ID) for questions.\n     * @param {string|HTMLElement} optionsNodeId - The output container (or ID) for answer options.\n     * @param {string} alternateStartNodeName - If you don't want to start at 'intro' specify your start node name here.\n     * @returns\n     */\n    RPGDialogueLogic.prototype.beginConversation = function (questionNodeId, optionsNodeId, alternateStartNodeName) {\n        var questionNode = this.getHTMLElement(questionNodeId);\n        var optionsNode = this.getHTMLElement(optionsNodeId);\n        /**\n         * Set the text in the question node.\n         * @param {*} questionText\n         */\n        var setQuestionText = function (questionText, npcName) {\n            if (npcName) {\n                questionNode.innerHTML = \"<span class=\\\"rpg-npcname\\\">\".concat(npcName, \":</span> \").concat(questionText);\n            }\n            else {\n                questionNode.innerHTML = questionText;\n            }\n        };\n        /**\n         * Clear the options node. Just for upper level use here.\n         */\n        var clearOptionsNode = function () {\n            optionsNode.innerHTML = \"\";\n        };\n        /**\n         * Add a new option node with the given answer text and option index. Use\n         * the option index to send the answer.\n         *\n         * @param {*} answerText\n         * @param {*} optionIndex\n         */\n        var addOptionNode = function (answerText, optionIndex) {\n            var answerNode = document.createElement(\"li\");\n            var answerLinkNode = document.createElement(\"a\");\n            answerLinkNode.innerHTML = answerText;\n            answerLinkNode.setAttribute(\"href\", \"#\");\n            answerLinkNode.addEventListener(\"click\", function () {\n                sendAnswer(optionIndex);\n            });\n            answerNode.appendChild(answerLinkNode);\n            optionsNode.appendChild(answerNode);\n        };\n        var _self = this;\n        /**\n         * Send the selected answer (by index).\n         * @param {number} index\n         */\n        var sendAnswer = function (index) {\n            _self.sendAnswer(index);\n            if (_self.isEndReached()) {\n                setQuestionText(\"---END OF CONVERSATION---\", undefined);\n                clearOptionsNode();\n            }\n            clearOptionsNode();\n            _self.loadCurrentQuestionaire(setQuestionText, addOptionNode);\n        };\n        // Initialize the first question.\n        _self.resetToBeginning(alternateStartNodeName);\n        _self.loadCurrentQuestionaire(setQuestionText, addOptionNode);\n        _self.fireStateChange(this.currentQuestionaireName, null, -1);\n    };\n    /**\n     * Load the dialogue structure from the JSON document at the given path.\n     *\n     * @param {string} path\n     * @returns {Promise<RPGDialogueLogic>}\n     */\n    RPGDialogueLogic.loadConfigFromJSON = function (path) {\n        console.log(\"axios\", axios_1.default);\n        return new Promise(function (accept, reject) {\n            axios_1.default\n                .get(path)\n                .then(function (response) {\n                // handle success\n                console.log(response);\n                // Validate response data?\n                accept(response.data);\n            })\n                .catch(function (error) {\n                // handle error\n                console.log(error);\n                reject();\n            })\n                .finally(function () {\n                // always executed\n            });\n        });\n    };\n    /**\n     * Load the dialogue structure from the JSON document at the given path.\n     *\n     * @param {string} path\n     * @returns {Promise<RPGDialogueLogic>}\n     */\n    RPGDialogueLogic.loadFromJSON = function (path) {\n        return new Promise(function (accept, reject) {\n            RPGDialogueLogic.loadConfigFromJSON(path).then(function (struct) {\n                accept(new RPGDialogueLogic(struct, true));\n            });\n        });\n    };\n    return RPGDialogueLogic;\n}());\nexports.RPGDialogueLogic = RPGDialogueLogic;\n//# sourceMappingURL=RPGDialogueLogic.js.map","\"use strict\";\n/**\n * A wrapper class for AlloyFinger.\n *\n * @author  Ikaros Kappler\n * @date    2023-07-31\n * @version 1.0.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TouchEnterLeaveHandler = exports.TouchHandler = void 0;\nvar plotboilerplate_1 = require(\"plotboilerplate\");\nvar TouchHandler = /** @class */ (function () {\n    function TouchHandler(pb, dialogConfigWithPositions, editorHelper) {\n        this.wasTouchUsed = false;\n        var _self = this;\n        // Install a touch handler on the canvas.\n        var relPos = function (pos) {\n            var bounds = pb.canvas.getBoundingClientRect();\n            return { x: pos.x - bounds.left, y: pos.y - bounds.top };\n        };\n        var draggedNodeName = null;\n        var draggedNode = null;\n        var draggedOption;\n        var wasDragged = false;\n        var touchMovePos = null;\n        var touchDownPos = null;\n        var clearTouch = function () {\n            touchMovePos = null;\n            touchDownPos = null;\n            draggedNodeName = null;\n        };\n        var afProps = {\n            touchStart: function (evt) {\n                console.log(\"Touchstart\");\n                _self.wasTouchUsed = true;\n                if (evt.touches.length == 1) {\n                    touchMovePos = new plotboilerplate_1.Vertex(relPos({ x: evt.touches[0].clientX, y: evt.touches[0].clientY }));\n                    touchDownPos = new plotboilerplate_1.Vertex(relPos({ x: evt.touches[0].clientX, y: evt.touches[0].clientY }));\n                    draggedNodeName = editorHelper.locateNodeBoxNameAtPos(pb.transformMousePosition(touchMovePos.x, touchMovePos.y));\n                    if (draggedNodeName) {\n                        draggedNode = dialogConfigWithPositions.graph[draggedNodeName];\n                    }\n                    else {\n                        draggedOption = editorHelper.locateOptionBoxNameAtPos(pb.transformMousePosition(touchMovePos.x, touchMovePos.y));\n                    }\n                    wasDragged = false;\n                }\n            },\n            touchMove: function (evt) {\n                console.log(\"touchMove\");\n                _self.wasTouchUsed = true;\n                if (evt.touches.length == 1 && draggedNode) {\n                    evt.preventDefault();\n                    evt.stopPropagation();\n                    if (!touchDownPos || !touchMovePos) {\n                        return;\n                    }\n                    var rel = relPos({ x: evt.touches[0].clientX, y: evt.touches[0].clientY });\n                    var trans = pb.transformMousePosition(rel.x, rel.y);\n                    var diff = new plotboilerplate_1.Vertex(pb.transformMousePosition(touchMovePos.x, touchMovePos.y)).difference(trans);\n                    draggedNode.editor.position.x += diff.x;\n                    draggedNode.editor.position.y += diff.y;\n                    touchMovePos = new plotboilerplate_1.Vertex(relPos({ x: evt.touches[0].clientX, y: evt.touches[0].clientY }));\n                    wasDragged = true;\n                    pb.redraw();\n                }\n            },\n            touchEnd: function (evt) {\n                console.log(\"touchEnd\");\n                _self.wasTouchUsed = true;\n                // Note: e.touches.length is 0 here\n                if (draggedNode) {\n                    if (!touchDownPos) {\n                        return;\n                    }\n                    if (!wasDragged) {\n                        wasDragged = false;\n                        if (draggedNode) {\n                            if (editorHelper.selectedOption) {\n                                // reconnect\n                                editorHelper.handleOptionReconnect(draggedNodeName);\n                            }\n                            else {\n                                editorHelper.setSelectedOption(null, false);\n                                editorHelper.setSelectedNode(draggedNodeName, draggedNode);\n                            }\n                        }\n                        else {\n                            // Option can be null, too.\n                            editorHelper.setSelectedOption(draggedOption, true);\n                            editorHelper.setSelectedNode(null, null);\n                        }\n                    }\n                }\n                clearTouch();\n            },\n            touchCancel: function (evt) {\n                console.log(\"touchCancel\");\n                _self.wasTouchUsed = true;\n                clearTouch();\n            }\n        }; // END afProps\n        /* tslint:disable-next-line */\n        _self.alloyFinger = globalThis.createAlloyFinger(pb.eventCatcher ? pb.eventCatcher : pb.canvas, afProps);\n    }\n    TouchHandler.prototype.destroy = function () {\n        this.alloyFinger.destroy();\n    };\n    return TouchHandler;\n}());\nexports.TouchHandler = TouchHandler;\nvar TouchEnterLeaveHandler = /** @class */ (function () {\n    function TouchEnterLeaveHandler() {\n        this.onTouchLeaveEvents = [];\n        this.onTouchEnterEvents = [];\n        this._init();\n    }\n    TouchEnterLeaveHandler.prototype.onTouchEnter = function (selector, fn) {\n        var _this = this;\n        this.onTouchEnterEvents.push([selector, fn]);\n        return function () {\n            _this.onTouchEnterEvents.slice().map(function (e, i) {\n                if (e[0] === selector && e[1] === fn) {\n                    this.onTouchEnterEvents.splice(1, i);\n                }\n            });\n        };\n    };\n    TouchEnterLeaveHandler.prototype.onTouchLeave = function (selector, fn) {\n        this.onTouchLeaveEvents.push([selector, fn]);\n        return function () {\n            this.onTouchLeaveEvents.slice().map(function (e, i) {\n                if (e[0] === selector && e[1] === fn) {\n                    this.onTouchLeaveEvents.splice(1, i);\n                }\n            });\n        };\n    };\n    TouchEnterLeaveHandler.prototype._init = function () {\n        var lastTouchLeave;\n        var lastTouchEnter;\n        var _self = this;\n        document.addEventListener(\"touchmove\", function (e) {\n            var el = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);\n            if (!el) {\n                return;\n            }\n            _self.onTouchLeaveEvents.map(function (event) {\n                if (el != lastTouchEnter && lastTouchEnter && lastTouchEnter.matches(event[0])) {\n                    if (lastTouchEnter !== lastTouchLeave) {\n                        event[1](lastTouchEnter, e);\n                        lastTouchLeave = lastTouchEnter;\n                        lastTouchEnter = null;\n                    }\n                }\n            });\n            _self.onTouchEnterEvents.map(function (event) {\n                if (el.matches(event[0]) && el !== lastTouchEnter) {\n                    lastTouchEnter = el;\n                    lastTouchLeave = null;\n                    event[1](el, e);\n                }\n            });\n        });\n    };\n    return TouchEnterLeaveHandler;\n}());\nexports.TouchEnterLeaveHandler = TouchEnterLeaveHandler;\n// Test\n// onTouchEnter('.area',function(el,e){\n//   el.classList.add('hover')\n// })\n// onTouchLeave('.area',function(el,e){\n//   el.classList.remove('hover')\n// })\n//# sourceMappingURL=TouchHandler.js.map","\"use strict\";\n/**\n * @author  Ikaros Kappler\n * @date    2021-11-07\n * @version 1.0.0\n *\n * @param {Record<string,string>} GUP\n * @returns {boolean}\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.detectDarkMode = void 0;\nvar detectDarkMode = function (GUP) {\n    // Respect overrides\n    if (typeof GUP !== \"undefined\" && GUP.hasOwnProperty(\"darkmode\") && GUP[\"darkmode\"]) {\n        var overrideValue = GUP[\"darkmode\"];\n        if (overrideValue === \"0\" || overrideValue.toLowerCase() === \"false\") {\n            return false;\n        }\n        else if (overrideValue === \"1\" || overrideValue.toLowerCase() === \"true\") {\n            return true;\n        }\n    }\n    var hours = new Date().getHours();\n    var isDayTime = hours > 6 && hours < 18;\n    return !isDayTime;\n};\nexports.detectDarkMode = detectDarkMode;\n//# sourceMappingURL=detectDarkMode.js.map","\"use strict\";\n/**\n * A script for demonstrating the line-point-distance.\n *\n * @require PlotBoilerplate, MouseHandler, gup, dat.gui\n *\n * @author   Ikaros Kappler\n * @date     2023-08-01\n * @version  1.0.0\n **/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RPGDOMHelpers = void 0;\nvar TouchHandler_1 = require(\"./TouchHandler\");\nvar editorHelpers_1 = require(\"./editorHelpers\");\nvar modal_1 = require(\"./modal\");\nvar RPGDOMHelpers = /** @class */ (function () {\n    function RPGDOMHelpers(editorHelpers) {\n        this.currentDraggedAnswerIndex = -1;\n        this.currentDropAnswerIndex = -1;\n        this.editorHelpers = editorHelpers;\n        this.touchEnterLeaveHandler = new TouchHandler_1.TouchEnterLeaveHandler();\n        this.editorElement = document.getElementById(\"attribute-editor\");\n        this.optionsElement = document.getElementById(\"e-options-container\");\n        this.keyElement = this.editorElement.querySelector(\"input#e-key\");\n        this.npcElement = this.editorElement.querySelector(\"select#e-npc-index\");\n        this.qElement = this.editorElement.querySelector(\"textarea#e-q\");\n        this.qElement.addEventListener(\"change\", this.handleQChanged(this));\n        this.npcElement.addEventListener(\"change\", this.handleNPCIndexChanged(this));\n        this.keyElement.addEventListener(\"change\", this.handleKeyChanged(this));\n        this.modal = new modal_1.Modal();\n        document.getElementById(\"b-export-json\").addEventListener(\"click\", this.exportJSON(this));\n        document.getElementById(\"b-add-answer-option\").addEventListener(\"click\", this.addAnswerOption(this));\n        document.getElementById(\"b-add-dialogue-node\").addEventListener(\"click\", this.addDialogueNode(this));\n        document.getElementById(\"b-delete-dialogue-node\").addEventListener(\"click\", this.requestRemoveDialogueNode(this));\n    }\n    RPGDOMHelpers.prototype.isExportWithoutPositions = function () {\n        var checkbox = document.getElementById(\"cb-export-without-positions\");\n        return checkbox.checked;\n    };\n    RPGDOMHelpers.prototype.isAutoSave = function () {\n        var checkbox = document.getElementById(\"cb-use-localstorage\");\n        return checkbox.checked;\n    };\n    RPGDOMHelpers.prototype.exportJSON = function (_self) {\n        return function () {\n            var removePositions = _self.isExportWithoutPositions();\n            var dConfig = removePositions\n                ? editorHelpers_1.EditorHelper.removePositions(_self.editorHelpers.dialogConfigWithPositions)\n                : _self.editorHelpers.dialogConfigWithPositions;\n            var jsonString = JSON.stringify(dConfig);\n            var blob = new Blob([jsonString], { type: \"application/json\" });\n            var url = URL.createObjectURL(blob);\n            var a = document.createElement(\"a\");\n            a.href = url;\n            a.download = \"dialog-config.json\";\n            a.textContent = \"Download backup.json\";\n            a.click();\n        };\n    };\n    RPGDOMHelpers.prototype.addAnswerOption = function (_self) {\n        return function () {\n            var newOption = {\n                a: \"\",\n                next: null\n            };\n            _self.currentGraphNode.o.push(newOption);\n            _self.updateAnswerOptions();\n            _self.editorHelpers.pb.redraw();\n        };\n    };\n    RPGDOMHelpers.prototype.addDialogueNode = function (_self) {\n        return function () {\n            _self.editorHelpers.addNewDialogueNode();\n        };\n    };\n    RPGDOMHelpers.prototype.requestRemoveDialogueNode = function (_self) {\n        return function () {\n            _self.modal.setTitle(\"Delete option?\");\n            _self.modal.setBody(\"Do you really want to delete the current dialoge node '\".concat(_self.currentNodeName, \"'?\"));\n            _self.modal.setFooter(\"\");\n            _self.modal.setActions([\n                modal_1.Modal.ACTION_CANCEL,\n                {\n                    label: \"Yes\",\n                    action: function () {\n                        _self.modal.close();\n                        _self.removeDialogueNode();\n                    }\n                }\n            ]);\n            _self.modal.open();\n        };\n    };\n    RPGDOMHelpers.prototype.removeDialogueNode = function () {\n        this.editorHelpers.removeNewDialogueNode(this.currentNodeName);\n        this.toggleVisibility(false);\n    };\n    RPGDOMHelpers.prototype.toggleVisibility = function (isVisible) {\n        if (isVisible) {\n            this.editorElement.classList.remove(\"d-none\");\n        }\n        else {\n            this.editorElement.classList.add(\"d-none\");\n        }\n    };\n    RPGDOMHelpers.prototype.handleQChanged = function (_self) {\n        return function (changeEvent) {\n            _self.currentGraphNode.q = changeEvent.target.value;\n            _self.editorHelpers.pb.redraw();\n        };\n    };\n    RPGDOMHelpers.prototype.handleNPCIndexChanged = function (_self) {\n        var _this = this;\n        return function (_changeEvent) {\n            var newIndex = parseInt(_this.npcElement.value);\n            if (Number.isNaN(newIndex)) {\n                newIndex = -1;\n            }\n            _self.currentGraphNode.npcIndex = newIndex;\n        };\n    };\n    RPGDOMHelpers.prototype.handleKeyChanged = function (_self) {\n        var _this = this;\n        return function (_changeEvent) {\n            var newName = _this.keyElement.value;\n            if (!newName || (newName = newName.trim()).length === 0) {\n                return;\n            }\n            var renameSuccessful = _self.editorHelpers.renameGraphNode(_self.currentNodeName, newName);\n            if (renameSuccessful) {\n                _self.currentNodeName = newName;\n            }\n        };\n    };\n    RPGDOMHelpers.prototype.handleATextChanged = function (_self, answer) {\n        return function (changeEvent) {\n            answer.a = changeEvent.target.value;\n            _self.editorHelpers.pb.redraw();\n        };\n    };\n    RPGDOMHelpers.prototype.handleASuccessorChanged = function (_self, answer) {\n        return function (changeEvent) {\n            answer.next = changeEvent.target.value;\n            _self.editorHelpers.pb.redraw();\n        };\n    };\n    RPGDOMHelpers.prototype.updateAnswerOptions = function () {\n        this.showAnswerOptions(this.currentNodeName, this.currentGraphNode);\n    };\n    RPGDOMHelpers.prototype.getSelectedNpcIndex = function () {\n        return typeof this.currentGraphNode.npcIndex === \"undefined\" || Number.isNaN(this.currentGraphNode.npcIndex)\n            ? 0\n            : this.currentGraphNode.npcIndex;\n    };\n    RPGDOMHelpers.prototype.updateNpcSelector = function () {\n        if (!this.currentGraphNode) {\n            return;\n        }\n        this.npcElement.innerHTML = \"\";\n        var curNpcIndex = this.getSelectedNpcIndex();\n        // console.log(\"this.currentGraphNode.npcIndex\", this.currentGraphNode.npcIndex, \"curNpcIndex\", curNpcIndex);\n        for (var i = 0; i < this.editorHelpers.dialogConfigWithPositions.meta.npcs.length; i++) {\n            var npcOption = document.createElement(\"option\");\n            npcOption.setAttribute(\"value\", \"\".concat(i));\n            if (i === 0) {\n                npcOption.innerHTML = \"\".concat(this.editorHelpers.dialogConfigWithPositions.meta.npcs[i].name, \" (default)\");\n            }\n            else {\n                npcOption.innerHTML = this.editorHelpers.dialogConfigWithPositions.meta.npcs[i].name;\n            }\n            if (i === curNpcIndex) {\n                npcOption.setAttribute(\"selected\", \"true\");\n                npcOption.selected = true;\n            }\n            this.npcElement.appendChild(npcOption);\n        }\n        this.npcElement.value = \"\".concat(curNpcIndex);\n        this.npcElement.setAttribute(\"value\", \"\".concat(curNpcIndex));\n    };\n    RPGDOMHelpers.prototype.toggleDragEnterStyles = function (target) {\n        // console.log(\"toggleDragEnterStyles\");\n        var answerIndex = this.currentDraggedAnswerIndex;\n        var dropIndex = parseInt(target.getAttribute(\"data-dropindex\"));\n        if (target.classList.contains(\"droppable\") && answerIndex !== dropIndex && answerIndex + 1 !== dropIndex) {\n            target.classList.add(\"dragover\");\n        }\n    };\n    RPGDOMHelpers.prototype.toggleDragLeaveStyles = function (target) {\n        console.log(\"toggleDragLeaveStyles\");\n        if (target.classList.contains(\"droppable\")) {\n            target.classList.remove(\"dragover\");\n        }\n    };\n    RPGDOMHelpers.prototype.showAnswerOptions = function (nodeName, graphNode) {\n        var _self = this;\n        this.currentNodeName = nodeName;\n        this.currentGraphNode = graphNode;\n        this.keyElement.setAttribute(\"value\", nodeName ? nodeName : \"\");\n        this.keyElement.value = nodeName ? nodeName : \"\";\n        // console.log(\"showAnswerOptions\", this.currentGraphNode);\n        this.updateNpcSelector();\n        this.optionsElement.innerHTML = \"\";\n        this.npcElement.value = !graphNode || Number.isNaN(graphNode.npcIndex) ? \"0\" : \"\".concat(graphNode.npcIndex);\n        this.qElement.setAttribute(\"value\", graphNode ? graphNode.q : \"\");\n        this.qElement.value = graphNode ? graphNode.q : \"\";\n        if (!graphNode) {\n            return;\n        }\n        var onDragOver = function (ev) {\n            console.log(\"ondragover\", ev.target);\n            ev.preventDefault();\n            var target = ev.target;\n            _self.toggleDragEnterStyles(target);\n        };\n        var onDragLeave = function (ev) {\n            console.log(\"ondragleave\", ev.target);\n            ev.preventDefault();\n            var target = ev.target;\n            _self.toggleDragLeaveStyles(target);\n        };\n        /**\n         * Native browser DnD does not support touch events.\n         * So we need a workaround using our custom TouchEnterLeaverHandler here.\n         */\n        _self.touchEnterLeaveHandler.onTouchEnter(\".a-droparea\", function (element) {\n            console.log(\"onTouchEnter\", element);\n            if (!element.classList.contains(\"a-droparea\")) {\n                return;\n            }\n            _self.currentDropAnswerIndex = parseInt(element.getAttribute(\"data-dropIndex\"));\n            _self.toggleDragEnterStyles(element);\n        });\n        _self.touchEnterLeaveHandler.onTouchLeave(\".a-droparea\", function (element) {\n            console.log(\"onTouchLeave\", element);\n            _self.currentDropAnswerIndex = -1;\n            _self.toggleDragLeaveStyles(element);\n        });\n        var drop = function (ev) {\n            console.log(\"Drop\", ev);\n            ev.preventDefault();\n            var target = ev.target;\n            // const answerIndex = parseInt(ev.dataTransfer.getData(\"answerindex\"));\n            var answerIndex = _self.currentDraggedAnswerIndex;\n            var dropIndex = parseInt(target.getAttribute(\"data-dropindex\"));\n            console.log(\"Move\", answerIndex, \"to\", dropIndex);\n            // target.appendChild(document.getElementById(data));\n            if (!target.classList.contains(\"droppable\") || answerIndex === dropIndex || answerIndex + 1 === dropIndex) {\n                // No real change\n                return;\n            }\n            _self.performDrop(answerIndex, dropIndex);\n        };\n        var isTouchDevice = this.editorHelpers.editor.currentTouchHandler.wasTouchUsed;\n        var dropArea = this.makeADropArea(0, drop, onDragOver, onDragLeave);\n        this.optionsElement.appendChild(dropArea);\n        for (var i = 0; i < graphNode.o.length; i++) {\n            var option = graphNode.o[i];\n            var answerWrapperElement = document.createElement(\"div\");\n            var answerControlsElement = this.makeAnswerControlElement(i, isTouchDevice);\n            var answerElement = document.createElement(\"div\");\n            var labelElement = document.createElement(\"div\");\n            var textElement = document.createElement(\"textarea\");\n            var selectElement = this.createNodeSelectElement(nodeName, option.next);\n            labelElement.innerHTML = \"A#\".concat(i);\n            labelElement.classList.add(\"e-label\");\n            textElement.innerHTML = option.a;\n            answerElement.appendChild(labelElement);\n            answerElement.appendChild(textElement);\n            answerElement.appendChild(selectElement);\n            var handleDragStart = function (ev) {\n                // console.log(\"handleDragStart\");\n                _self.currentDraggedAnswerIndex = parseInt(ev.target.getAttribute(\"data-answerindex\"));\n                // console.log(\"handleDragStart\", _self.currentDraggedAnswerIndex);\n                ev.dataTransfer.setData(\"answerindex\", \"\".concat(_self.currentDraggedAnswerIndex));\n            };\n            var handleTouchDragStart = function (ev) {\n                ev.preventDefault(); // Is this required?\n                var dragStartElement = ev.target;\n                _self.currentDraggedAnswerIndex = parseInt(dragStartElement.getAttribute(\"data-answerindex\"));\n                if (Number.isNaN(_self.currentDraggedAnswerIndex)) {\n                    // touchStart on touch devices is a bit different than dragStart on Desktop devives.\n                    // Try to find enclosing draggable element\n                    if (dragStartElement.classList.contains(\"a-dnd-element\")) {\n                        dragStartElement = dragStartElement.parentElement.parentElement;\n                    }\n                    // This should not be a node of class 'answer-wrapper-element' and draggable=true\n                    if (!dragStartElement.classList.contains(\"answer-wrapper-element\") || !dragStartElement.getAttribute(\"draggable\")) {\n                        console.log(\"Cannot find draggable element.\");\n                        return;\n                    }\n                    _self.currentDraggedAnswerIndex = parseInt(dragStartElement.getAttribute(\"data-answerindex\"));\n                }\n                // console.log(\"handleTouchDragStart\", _self.currentDraggedAnswerIndex);\n            };\n            var handleTouchDragEnd = function (_ev) {\n                _self.performDrop(_self.currentDraggedAnswerIndex, _self.currentDropAnswerIndex);\n            };\n            answerWrapperElement.classList.add(\"answer-wrapper-element\");\n            // answerWrapperElement.setAttribute(\"data-answerindex\", `${i}`);\n            if (isTouchDevice) {\n                // Regular 'mouse' or Desktop device.\n                // No additional listeners to install.\n            }\n            else {\n                // The TouchHandler already received an only-touch event, so we are\n                // probably currently running on a touch device\n                if (answerControlsElement.dndHandleElement) {\n                    answerControlsElement.dndHandleElement.setAttribute(\"draggable\", \"true\");\n                    answerControlsElement.dndHandleElement.addEventListener(\"dragstart\", handleDragStart);\n                    answerControlsElement.dndHandleElement.addEventListener(\"touchstart\", handleTouchDragStart);\n                    answerControlsElement.dndHandleElement.addEventListener(\"touchend\", handleTouchDragEnd);\n                    answerControlsElement.dndHandleElement.setAttribute(\"data-answerindex\", \"\".concat(i));\n                }\n            }\n            answerWrapperElement.appendChild(answerElement);\n            answerWrapperElement.appendChild(answerControlsElement.container);\n            var dropArea_1 = this.makeADropArea(i + 1, drop, onDragOver, onDragLeave);\n            this.optionsElement.appendChild(answerWrapperElement);\n            this.optionsElement.appendChild(dropArea_1);\n            textElement.addEventListener(\"change\", this.handleATextChanged(this, option));\n            selectElement.addEventListener(\"change\", this.handleASuccessorChanged(this, option));\n        }\n    };\n    /**\n     * Create a new answer element (consisting of labels, input fields and buttons).\n     * If `isTouchDevice` is true, then a drag element will be added.\n     * Otherwise two up/down-buttons will be added.\n     *\n     * @param {number} index - The answer option index inside the config.\n     * @param {boolean} isTouchDevice - Set to `true` if drag-and-drop handles should be added instead of buttons.\n     * @returns {HTMLDivElement}\n     */\n    RPGDOMHelpers.prototype.makeAnswerControlElement = function (index, isTouchDevice) {\n        var _self = this;\n        var controlElement = document.createElement(\"div\");\n        controlElement.classList.add(\"answer-controls-element\");\n        var dndElement = null;\n        if (isTouchDevice) {\n            var upDownElement = document.createElement(\"div\");\n            upDownElement.classList.add(\"answer-up-down-element\");\n            var upBtn = document.createElement(\"button\");\n            upBtn.innerHTML = \"▴\";\n            if (index === 0) {\n                upBtn.setAttribute(\"disabled\", \"true\");\n            }\n            else {\n                upBtn.addEventListener(\"click\", function () {\n                    console.log(\"upBtn\", index, index - 1);\n                    _self.performDrop(index, index - 1);\n                });\n            }\n            var downBtn = document.createElement(\"button\");\n            downBtn.innerHTML = \"▾\";\n            if (index + 1 === this.currentGraphNode.o.length) {\n                downBtn.setAttribute(\"disabled\", \"true\");\n            }\n            else {\n                downBtn.addEventListener(\"click\", function () {\n                    console.log(\"downBtn\", index, index + 2); // Think of drop zone indices here\n                    _self.performDrop(index, index + 2); // Think of drop zone indices here\n                });\n            }\n            upDownElement.appendChild(upBtn);\n            upDownElement.appendChild(downBtn);\n            controlElement.appendChild(upDownElement);\n        }\n        else {\n            dndElement = document.createElement(\"div\");\n            dndElement.classList.add(\"a-dnd-element\");\n            dndElement.innerHTML = \"&vellip;\";\n            controlElement.appendChild(dndElement);\n        }\n        var deleteButton = document.createElement(\"button\");\n        deleteButton.classList.add(\"a-delete-button\");\n        deleteButton.addEventListener(\"click\", this.requestDeleteOption(index));\n        deleteButton.innerHTML = \"&#x1F5D1;\";\n        controlElement.appendChild(deleteButton);\n        return { container: controlElement, dndHandleElement: dndElement };\n    };\n    RPGDOMHelpers.prototype.performDrop = function (answerIndex, dropIndex) {\n        if (dropIndex > answerIndex) {\n            dropIndex--;\n        }\n        var old = this.currentGraphNode.o[answerIndex];\n        this.currentGraphNode.o[answerIndex] = this.currentGraphNode.o[dropIndex];\n        this.currentGraphNode.o[dropIndex] = old;\n        // Re-build the list : )\n        this.updateAnswerOptions();\n        this.editorHelpers.pb.redraw();\n    };\n    RPGDOMHelpers.prototype.requestDeleteOption = function (index) {\n        var _self = this;\n        return function () {\n            _self.modal.setTitle(\"Delete option?\");\n            _self.modal.setBody(\"Do you really want to delete option #\".concat(index, \"?\"));\n            _self.modal.setFooter(\"\");\n            _self.modal.setActions([\n                modal_1.Modal.ACTION_CANCEL,\n                {\n                    label: \"Yes\",\n                    action: function () {\n                        _self.modal.close();\n                        _self.handleDeleteOption(index);\n                    }\n                }\n            ]);\n            _self.modal.open();\n        };\n    };\n    RPGDOMHelpers.prototype.handleDeleteOption = function (index) {\n        this.currentGraphNode.o.splice(index, 1);\n        this.updateAnswerOptions();\n        this.editorHelpers.pb.redraw();\n    };\n    RPGDOMHelpers.prototype.makeADropArea = function (dropIndex, drop, onDragOver, onDragLeave) {\n        var dropArea = document.createElement(\"div\");\n        dropArea.setAttribute(\"data-dropindex\", \"\".concat(dropIndex));\n        dropArea.classList.add(\"a-droparea\", \"droppable\");\n        dropArea.addEventListener(\"drop\", drop);\n        dropArea.addEventListener(\"dragover\", onDragOver);\n        dropArea.addEventListener(\"dragleave\", onDragLeave);\n        return dropArea;\n    };\n    RPGDOMHelpers.prototype.createNodeSelectElement = function (currentKey, selectedKey) {\n        var selectElement = document.createElement(\"select\");\n        if (!this.editorHelpers.dialogConfigWithPositions) {\n            console.warn(\"Warning: cannout populate nodeSelectElement. No dialogConfig set.\");\n        }\n        else {\n            var optionElement = this.createNodeSelectOptionElement(\"\", false, null, false);\n            selectElement.appendChild(optionElement);\n            for (var key in this.editorHelpers.dialogConfigWithPositions.graph) {\n                if (!this.editorHelpers.dialogConfigWithPositions.graph.hasOwnProperty(key)) {\n                    return;\n                }\n                var questionaire = this.editorHelpers.dialogConfigWithPositions.graph[key];\n                var optionElement_1 = this.createNodeSelectOptionElement(questionaire.q, key === currentKey, key, key === selectedKey);\n                selectElement.appendChild(optionElement_1);\n            }\n        }\n        return selectElement;\n    };\n    RPGDOMHelpers.prototype.createNodeSelectOptionElement = function (questionaireText, isCurrent, key, isSelected) {\n        var optionElement = document.createElement(\"option\");\n        optionElement.setAttribute(\"value\", key);\n        optionElement.innerHTML = \"\".concat(key !== null && key !== void 0 ? key : \"\", \": \").concat(editorHelpers_1.EditorHelper.ellipsify(questionaireText, 20));\n        if (isCurrent) {\n            optionElement.setAttribute(\"disabled\", \"true\");\n        }\n        if (isSelected) {\n            optionElement.setAttribute(\"selected\", \"true\");\n        }\n        return optionElement;\n    };\n    return RPGDOMHelpers;\n}());\nexports.RPGDOMHelpers = RPGDOMHelpers;\n//# sourceMappingURL=domHelpers.js.map","\"use strict\";\n/**\n * Helpers for the graph editor.\n *\n * @require PlotBoilerplate\n *\n * @author   Ikaros Kappler\n * @date     2023-07-28\n * @version  1.0.0\n **/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorHelper = void 0;\nvar plotboilerplate_1 = require(\"plotboilerplate\");\nvar domHelpers_1 = require(\"./domHelpers\");\nvar editorRenderer_1 = require(\"./editorRenderer\");\nvar metaHelpers_1 = require(\"./metaHelpers\");\nvar EditorHelper = /** @class */ (function () {\n    function EditorHelper(editor, pb, boxSize) {\n        // TODO: convert into node identifyer\n        /**\n         * The highlighted node's name or null if none is highlighted.\n         * Used to highlight nodes when the mouse is over.\n         */\n        this.highlightedNodeName = null;\n        /**\n         * The highlighted node itself or null if none is highligted.\n         * Used to determine rendering colors.\n         */\n        this.highlightedNode = null;\n        /**\n         * The selected node's name or null if none is selected.\n         * Used to determine the node editor's contents.\n         */\n        this.selectedNodeName = null;\n        /**\n         * The selected node itself or null if none is selected.\n         * Used to determine the node editor's contents.\n         */\n        this.selectedNode = null;\n        /**\n         * The currently selected option or null if none is selected.\n         * Used to re-connect an option with a new successor node.\n         */\n        this.selectedOption = null;\n        /**\n         * The currently highlighted option.\n         * Used to draw on-mouse-over options with a different color.\n         */\n        this.hightlightedOption = null;\n        /**\n         * The current mouse position (or null if mouse is not on canvas).\n         * In local relative coordinate system.\n         */\n        this.relativeMousePosition = null;\n        this.editor = editor;\n        this.pb = pb;\n        this.boxSize = boxSize;\n        this.selectedNodeName = null;\n        this.domHelper = new domHelpers_1.RPGDOMHelpers(this);\n        this.metaHelpers = new metaHelpers_1.DialogueMetaHelpers(this);\n    }\n    EditorHelper.prototype.setDialogConfig = function (dialogConfigWithPositions) {\n        this.dialogConfigWithPositions = dialogConfigWithPositions;\n    };\n    EditorHelper.prototype.setSelectedOption = function (selectedOption, noRedraw) {\n        console.log(\"Set selected option\", selectedOption);\n        this.selectedOption = selectedOption;\n        if (!noRedraw) {\n            this.pb.redraw();\n        }\n    };\n    EditorHelper.prototype.setHighlightedOption = function (hightlightedOption) {\n        // const isRedrawRequired = this.hightlightedOption !== hightlightedOption;\n        var isRedrawRequired = !this.isEqualOptionIdentifyer(this.hightlightedOption, hightlightedOption);\n        this.hightlightedOption = hightlightedOption;\n        if (isRedrawRequired) {\n            this.pb.redraw();\n        }\n    };\n    EditorHelper.prototype.setHighlightedNode = function (nodeName, noRedraw) {\n        this.highlightedNodeName = nodeName;\n        this.highlightedNode = nodeName ? this.dialogConfigWithPositions.graph[nodeName] : null;\n        if (!noRedraw) {\n            this.pb.redraw();\n        }\n    };\n    /**\n     * A helper function to create random safe positions in the viewport area.\n     * @param {PlotBoilerplate} pb\n     * @param {XYDimension} boxSize\n     * @returns\n     */\n    EditorHelper.prototype.getRandomPosition = function () {\n        var viewport = this.pb.viewport();\n        return {\n            x: viewport.min.x + this.boxSize.width + (viewport.width - 2 * this.boxSize.width) * Math.random(),\n            y: viewport.min.y + this.boxSize.height + (viewport.height - 2 * this.boxSize.height) * Math.random()\n        };\n    };\n    EditorHelper.prototype.setSelectedNode = function (nodeName, node) {\n        this.selectedNodeName = nodeName;\n        this.selectedNode = node;\n        if (nodeName && node) {\n            // this.domHelper.editorElement.classList.remove(\"d-none\");\n            this.domHelper.toggleVisibility(true);\n            this.domHelper.showAnswerOptions(nodeName, this.selectedNode);\n        }\n        else {\n            // this.domHelper.editorElement.classList.add(\"d-none\");\n            this.domHelper.toggleVisibility(false);\n            this.domHelper.showAnswerOptions(null, null);\n        }\n        this.pb.redraw();\n    };\n    /**\n     * A helper function to make sure all graph nodes have valid positions. Those without\n     * valid positions (eg like those being loaded from an incomplete JSON file) will be\n     * assigned to a random position inside the viewport.\n     *\n     * @param {PlotBoilerplate} pb\n     * @param {XYDimension} boxSize\n     * @returns\n     */\n    EditorHelper.prototype.enrichPositions = function (baseConfig) {\n        // Clone?\n        var configWithPositions = baseConfig;\n        for (var nodeName in configWithPositions.graph) {\n            var graphNode = configWithPositions.graph[nodeName];\n            if (!graphNode) {\n                console.warn(\"Warning: graph node \".concat(nodeName, \" is null or undefined!\"));\n                continue;\n            }\n            // Anonymous member check\n            if (!graphNode.hasOwnProperty(\"editor\")) {\n                graphNode.editor = { position: this.getRandomPosition() };\n            }\n            else if (!graphNode.editor.hasOwnProperty(\"position\")) {\n                graphNode.editor.position = this.getRandomPosition();\n            }\n            else {\n                if (!graphNode.editor.position.hasOwnProperty(\"x\") || isNaN(graphNode.editor.position.x)) {\n                    graphNode.editor.position.x = this.getRandomPosition().x;\n                }\n                if (!graphNode.editor.position.hasOwnProperty(\"y\") || isNaN(graphNode.editor.position.y)) {\n                    graphNode.editor.position.y = this.getRandomPosition().y;\n                }\n            }\n        }\n        return configWithPositions;\n    };\n    /**\n     * Check if the meta data is valid and – if not – add missing default fields.\n     * @param dialogueConfig\n     */\n    EditorHelper.prototype.enrichMetaData = function (dialogueConfig) {\n        var result = dialogueConfig;\n        if (!dialogueConfig.hasOwnProperty(\"meta\")) {\n            result.meta = { name: \"noname\", npcs: [] };\n        }\n        if (!result.meta.npcs) {\n            result.meta.npcs = [];\n        }\n        if (result.meta.npcs.length === 0) {\n            result.meta.npcs.push({ name: \"NPC #0\" });\n        }\n    };\n    EditorHelper.prototype.isPosInGraphNodeBox = function (pos, graphNode) {\n        return (graphNode.editor.position.x <= pos.x &&\n            graphNode.editor.position.y <= pos.y &&\n            graphNode.editor.position.x + this.boxSize.width > pos.x &&\n            graphNode.editor.position.y + this.boxSize.height > pos.y);\n    };\n    EditorHelper.prototype.isPosInOptionNodeBox = function (pos, graphNode, optionIndex) {\n        editorRenderer_1.EditorRenderer.OPTION_OFFSET_X;\n        return (graphNode.editor.position.x + editorRenderer_1.EditorRenderer.OPTION_OFFSET_X <= pos.x &&\n            graphNode.editor.position.y + (optionIndex + 1) * this.boxSize.height <= pos.y &&\n            graphNode.editor.position.x + editorRenderer_1.EditorRenderer.OPTION_OFFSET_X + this.boxSize.width > pos.x &&\n            graphNode.editor.position.y + (optionIndex + 1) * this.boxSize.height + this.boxSize.height > pos.y);\n    };\n    EditorHelper.prototype.locateNodeBoxNameAtPos = function (pos) {\n        for (var nodeName in this.dialogConfigWithPositions.graph) {\n            var graphNode = this.dialogConfigWithPositions.graph[nodeName];\n            if (this.isPosInGraphNodeBox(pos, graphNode)) {\n                return nodeName;\n            }\n        }\n        return null;\n    };\n    EditorHelper.prototype.locateOptionBoxNameAtPos = function (pos) {\n        for (var nodeName in this.dialogConfigWithPositions.graph) {\n            var graphNode = this.dialogConfigWithPositions.graph[nodeName];\n            for (var i = 0; i < graphNode.o.length; i++) {\n                if (this.isPosInOptionNodeBox(pos, graphNode, i)) {\n                    return { nodeName: nodeName, node: graphNode, optionIndex: i };\n                }\n            }\n        }\n        return null;\n    };\n    EditorHelper.prototype.isNodeHighlighted = function (nodName) {\n        return this.highlightedNodeName === nodName;\n    };\n    EditorHelper.prototype.isOptionHighlighted = function (nodeName, optionIndex) {\n        return (this.hightlightedOption &&\n            this.hightlightedOption.nodeName === nodeName &&\n            this.hightlightedOption.optionIndex === optionIndex);\n    };\n    EditorHelper.prototype.isOptionSelected = function (nodeName, optionIndex) {\n        return this.selectedOption && this.selectedOption.nodeName === nodeName && this.selectedOption.optionIndex === optionIndex;\n    };\n    EditorHelper.prototype.addNewDialogueNode = function () {\n        // Place two box units to the right if currently there is a selected node.\n        // Otherwise random position.\n        var position = this.selectedNode\n            ? {\n                x: this.selectedNode.editor.position.x + 2 * this.boxSize.width,\n                y: this.selectedNode.editor.position.y + this.boxSize.height\n            }\n            : this.getRandomPosition();\n        var nodeName = this.randomNodeKey();\n        var newNode = {\n            q: \"\",\n            o: [{ a: \"\", next: null }],\n            editor: {\n                position: position\n            }\n        };\n        this.dialogConfigWithPositions.graph[nodeName] = newNode;\n        this.selectedNodeName = nodeName;\n        this.selectedNode = newNode;\n        this.domHelper.showAnswerOptions(nodeName, newNode);\n        this.pb.redraw();\n    };\n    EditorHelper.prototype.removeNewDialogueNode = function (nodeName) {\n        delete this.dialogConfigWithPositions.graph[nodeName];\n        this.selectedNodeName = null;\n        this.selectedNode = null;\n        this.domHelper.showAnswerOptions(null, null);\n        this.pb.redraw();\n    };\n    EditorHelper.prototype.boxMovehandler = function () {\n        var _this = this;\n        var _self = this;\n        // +---------------------------------------------------------------------------------\n        // | Add a mouse listener to track the mouse position.\n        // +-------------------------------\n        var mouseDownPos = null;\n        var lastMouseDownPos = null;\n        var draggingNode = null;\n        var draggingNodeName = null;\n        var handler = new plotboilerplate_1.MouseHandler(this.pb.eventCatcher)\n            .down(function (evt) {\n            mouseDownPos = _this.pb.transformMousePosition(evt.params.mouseDownPos.x, evt.params.mouseDownPos.y);\n            lastMouseDownPos = { x: evt.params.mouseDownPos.x, y: evt.params.mouseDownPos.y };\n            draggingNodeName = _this.locateNodeBoxNameAtPos(mouseDownPos);\n            if (draggingNodeName) {\n                draggingNode = _this.dialogConfigWithPositions.graph[draggingNodeName];\n            }\n        })\n            .up(function (_evt) {\n            mouseDownPos = null;\n            draggingNode = null;\n        })\n            .drag(function (evt) {\n            if (!mouseDownPos || !draggingNode) {\n                return;\n            }\n            // const diff = evt.params.dragAmount;\n            draggingNode.editor.position.x += evt.params.dragAmount.x / _this.pb.draw.scale.x;\n            draggingNode.editor.position.y += evt.params.dragAmount.y / _this.pb.draw.scale.y;\n        })\n            .move(function (evt) {\n            // console.log(\"move\", evt);\n            // Check if mouse pointer hovers over an option -> set highlighted\n            var mouseMovePos = _this.pb.transformMousePosition(evt.params.pos.x, evt.params.pos.y);\n            _self.relativeMousePosition = { x: mouseMovePos.x, y: mouseMovePos.y };\n            var hoveringOptionIdentifyer = _this.locateOptionBoxNameAtPos(mouseMovePos);\n            // Can be null\n            _self.setHighlightedOption(hoveringOptionIdentifyer);\n            if (!hoveringOptionIdentifyer) {\n                // Check if hover on graph node\n                var hoveringNodeName = _this.locateNodeBoxNameAtPos(mouseMovePos);\n                _this.setHighlightedNode(hoveringNodeName);\n            }\n            else {\n                _this.setHighlightedNode(null);\n            }\n        })\n            .click(function (evt) {\n            // Stop if mouse was moved\n            console.log(\"lastMouseDownPos\", lastMouseDownPos, \" evt.params.pos\", evt.params.pos);\n            if (lastMouseDownPos && (lastMouseDownPos.x !== evt.params.pos.x || lastMouseDownPos.y !== evt.params.pos.y)) {\n                return;\n            }\n            // Check if mouse pointer hovers over an option -> set selected AND select node\n            var mouseClickPos = _this.pb.transformMousePosition(evt.params.pos.x, evt.params.pos.y);\n            _self.handleClick(mouseClickPos);\n        });\n        return handler;\n    };\n    EditorHelper.prototype.handleClick = function (mouseClickPos) {\n        var clickedOptionIdentifyer = this.locateOptionBoxNameAtPos(mouseClickPos);\n        if (clickedOptionIdentifyer) {\n            this.setSelectedOption(clickedOptionIdentifyer);\n        }\n        else {\n            // Otherwise (no option was clicked) check if a node was clicked directly.\n            var clickedNodeName = this.locateNodeBoxNameAtPos(mouseClickPos);\n            console.log(\"Click\", clickedNodeName);\n            if (clickedNodeName) {\n                if (this.selectedOption) {\n                    this.handleOptionReconnect(clickedNodeName);\n                    this.pb.redraw();\n                }\n                else {\n                    this.setSelectedNode(clickedNodeName, this.dialogConfigWithPositions.graph[clickedNodeName]);\n                    // this.pb.redraw();\n                }\n            }\n            else {\n                this.setSelectedNode(null, null);\n                // this.selectedNode = null;\n                // this.pb.redraw();\n            }\n            this.setSelectedOption(null, false);\n        }\n    };\n    EditorHelper.prototype.handleOptionReconnect = function (clickedNodeName) {\n        if (!this.selectedOption) {\n            // Actually this fuction should not be called at all in that case.\n            console.warn(\"Warn: cannot reconnect option when no option is selected.\");\n        }\n        var graph = this.dialogConfigWithPositions.graph;\n        var clickedNode = graph[clickedNodeName];\n        var sourceNode = this.selectedOption.node;\n        console.log(\"Reconnect\");\n        sourceNode.o[this.selectedOption.optionIndex].next = clickedNodeName;\n        this.domHelper.showAnswerOptions(this.selectedNodeName, this.selectedNode);\n    };\n    EditorHelper.prototype.isEqualOptionIdentifyer = function (identA, identB) {\n        if ((!identA && identB) || (identA && !identB)) {\n            return false;\n        }\n        if ((typeof identA === \"undefined\" && typeof identB !== \"undefined\") ||\n            (typeof identA !== \"undefined\" && typeof identB === \"undefined\")) {\n            return false;\n        }\n        if (identA === identB || (typeof identA === \"undefined\" && typeof identB === \"undefined\")) {\n            return true;\n        }\n        return identA.nodeName === identB.nodeName && identA.optionIndex === identB.optionIndex;\n    };\n    EditorHelper.prototype.renameGraphNode = function (oldName, newName) {\n        if (!this.dialogConfigWithPositions.graph.hasOwnProperty(oldName)) {\n            console.warn(\"Warning: cannot rename node, because old name does not exist.\", oldName);\n            return false;\n        }\n        if (oldName === \"intro\") {\n            console.warn(\"Warning: cannot rename node, because 'intro' must not be renamed'.\");\n            return false;\n        }\n        if (this.dialogConfigWithPositions.graph.hasOwnProperty(newName)) {\n            console.warn(\"Warning: cannot rename node, because new name already exists.\", newName);\n            return false;\n        }\n        if (newName === oldName) {\n            console.warn(\"Warning: cannot rename node, because old name and new name are the same.\", oldName);\n            return false;\n        }\n        var graphNode = this.dialogConfigWithPositions.graph[oldName];\n        this.dialogConfigWithPositions.graph[newName] = graphNode;\n        delete this.dialogConfigWithPositions.graph[oldName];\n        // Update all references\n        for (var nodeName in this.dialogConfigWithPositions.graph) {\n            if (!this.dialogConfigWithPositions.graph.hasOwnProperty(nodeName)) {\n                continue;\n            }\n            var tmpNode = this.dialogConfigWithPositions.graph[nodeName];\n            for (var j = 0; j < tmpNode.o.length; j++) {\n                if (tmpNode.o[j].next === oldName) {\n                    tmpNode.o[j].next = newName;\n                }\n            }\n        }\n        // Update local selected fields\n        if (oldName === this.selectedNodeName) {\n            this.selectedNodeName = newName;\n            this.selectedNode = this.dialogConfigWithPositions.graph[newName];\n        }\n        this.pb.redraw();\n        return true;\n    };\n    EditorHelper.ellipsify = function (text, maxLength) {\n        if (!text || text.length <= maxLength) {\n            return text;\n        }\n        return \"\".concat(text.substring(0, maxLength), \"...\");\n    };\n    EditorHelper.fromObject = function (object) {\n        // Must be of type object\n        if (typeof object !== \"object\") {\n            throw \"Cannot convert non-objects to dialogue config: type is \".concat(typeof object, \".\");\n        }\n        // Must have a 'graph' member.\n        if (!object.hasOwnProperty(\"graph\")) {\n            throw \"Cannot convert object to dialogue config: object missing member `graph`.\";\n        }\n        var graph = object[\"graph\"];\n        // Check if 'intro' is present?\n        // All members must be of correct type\n        for (var key in object) {\n            if (!object.hasOwnProperty(key)) {\n                continue;\n            }\n            var questionaire = object[key];\n            if (typeof questionaire !== \"object\") {\n                throw \"Cannot converto bject to dialogue config: all graph members must be objects.\";\n            }\n            // Check if 'q' (string) and 'o' (array) attributes are present?\n        }\n        return object;\n    };\n    EditorHelper.removePositions = function (dialogueConfig) {\n        var clone = JSON.parse(JSON.stringify(dialogueConfig));\n        for (var nodeName in clone.graph) {\n            var node = clone.graph[nodeName];\n            if (node.hasOwnProperty(\"editor\")) {\n                delete node[\"editor\"];\n            }\n        }\n        return clone;\n    };\n    EditorHelper.prototype.randomNodeKey = function () {\n        var keys = Object.keys(this.dialogConfigWithPositions.graph);\n        var count = keys.length;\n        var key = \"New \" + count;\n        while (this.dialogConfigWithPositions.graph.hasOwnProperty(key)) {\n            key = \"New \" + count;\n            count++;\n        }\n        return key;\n    };\n    return EditorHelper;\n}());\nexports.EditorHelper = EditorHelper;\n//# sourceMappingURL=editorHelpers.js.map","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EditorRenderer = void 0;\n/**\n * A renderer for the graph editor.\n *\n * @require PlotBoilerplate\n *\n * @author   Ikaros Kappler\n * @date     2023-07-28\n * @version  1.0.0\n **/\nvar plotboilerplate_1 = require(\"plotboilerplate\");\nvar editorHelpers_1 = require(\"./editorHelpers\");\nvar getContrastColor_1 = require(\"plotboilerplate/src/cjs/utils/algorithms/getContrastColor\");\nvar Color_1 = require(\"plotboilerplate/src/cjs/utils/datastructures/Color\");\n// import { FileDrop } from \"plotboilerplate/src/cjs/utils/io/FileDrop\";\nvar EditorRenderer = /** @class */ (function () {\n    function EditorRenderer(pb, boxSize, editorHelpers, isDarkmode) {\n        this.TEXT_MAX_LENGTH = 20;\n        this.pb = pb;\n        this.boxSize = boxSize;\n        this.editorHelpers = editorHelpers;\n        this.fontOptions = {\n            color: \"black\",\n            fontFamily: \"Arial\",\n            fontSize: 12,\n            fontStyle: \"italic\",\n            fontWeight: \"normal\",\n            lineHeight: 26,\n            textAlign: \"left\",\n            rotation: 0\n        };\n        var backgroundColor = isDarkmode ? Color_1.Color.parse(\"#000000\") : Color_1.Color.parse(\"#ffffff\");\n        this.fontOptions.color = (0, getContrastColor_1.getContrastColor)(backgroundColor).setAlpha(0.8).cssRGBA();\n    }\n    EditorRenderer.prototype.renderBoxes = function (dialogConfig) {\n        var nodeNames = Object.keys(dialogConfig.graph);\n        var count = nodeNames.length;\n        for (var i = 0; i < count; i++) {\n            var nodeName = nodeNames[i];\n            var graphNode = dialogConfig.graph[nodeName];\n            this.renderGraphNode(nodeName, graphNode);\n            this.renderOptions(nodeName, graphNode);\n        }\n        // Render suggested new connection\n        this.renderSuggestedConnection();\n    };\n    EditorRenderer.prototype.renderSuggestedConnection = function () {\n        if (this.editorHelpers.selectedOption) {\n            var isMousePosInsideOption = this.editorHelpers.isPosInOptionNodeBox(this.editorHelpers.relativeMousePosition, this.editorHelpers.selectedOption.node, this.editorHelpers.selectedOption.optionIndex);\n            var bezierTargetPosition = this.editorHelpers.highlightedNode\n                ? this.editorHelpers.highlightedNode.editor.position\n                : isMousePosInsideOption\n                    ? null\n                    : this.editorHelpers.relativeMousePosition;\n            if (bezierTargetPosition) {\n                this.drawBezierConnection(this.editorHelpers.selectedOption.node, this.editorHelpers.selectedOption.optionIndex, bezierTargetPosition, true, true);\n            }\n        }\n    };\n    EditorRenderer.prototype.renderGraphNode = function (nodeName, graphNode) {\n        var isNodeSelected = this.editorHelpers.selectedNodeName === nodeName;\n        var isNodeHighlighted = this.editorHelpers.isNodeHighlighted(nodeName);\n        this.pb.fill.text(nodeName, graphNode.editor.position.x, graphNode.editor.position.y - this.boxSize.height, __assign(__assign({}, this.fontOptions), { color: \"grey\" }));\n        this.pb.draw.rect(graphNode.editor.position, this.boxSize.width, this.boxSize.height, isNodeSelected ? \"rgba(255,128,0,1.0)\" : \"rgba(0,255,0,1.0)\", 1.0);\n        // Show initial and terminal nodes with fill color\n        if (!graphNode.o || graphNode.o.length === 0 || nodeName === \"intro\" || isNodeHighlighted) {\n            this.pb.fill.rect({ x: graphNode.editor.position.x, y: graphNode.editor.position.y }, this.boxSize.width, this.boxSize.height, isNodeHighlighted ? \"rgba(255,128,0,0.5)\" : isNodeSelected ? \"rgba(255,128,0,0.3)\" : \"rgba(0,255,0,0.3)\", 1.0);\n        }\n        this.pb.fill.text(graphNode.q ? (isNodeSelected ? graphNode.q : editorHelpers_1.EditorHelper.ellipsify(graphNode.q, this.TEXT_MAX_LENGTH)) : \"-no text-\", graphNode.editor.position.x, graphNode.editor.position.y, this.fontOptions);\n    };\n    EditorRenderer.prototype.renderOptions = function (nodeName, graphNode) {\n        var isNodeSelected = this.editorHelpers.selectedNodeName === nodeName;\n        var offsetY = graphNode.editor.position.y + this.boxSize.height;\n        var offsetX = graphNode.editor.position.x + EditorRenderer.OPTION_OFFSET_X;\n        for (var j = 0; j < graphNode.o.length; j++) {\n            var option = graphNode.o[j];\n            // Render highlighted option?\n            var otherOptionIsSelected = this.editorHelpers.selectedOption !== null && !this.editorHelpers.isOptionSelected(nodeName, j);\n            var isHighlighted = !otherOptionIsSelected && this.editorHelpers.isOptionHighlighted(nodeName, j);\n            var isSelected = this.editorHelpers.isOptionSelected(nodeName, j);\n            if (isHighlighted || isSelected) {\n                this.pb.fill.rect({ x: offsetX, y: offsetY }, this.boxSize.width, this.boxSize.height, \"rgba(255,192,0,0.5)\", 1);\n            }\n            this.pb.draw.rect({ x: offsetX, y: offsetY }, this.boxSize.width, this.boxSize.height, \"grey\", 1);\n            this.pb.fill.text(option.a ? (isNodeSelected ? option.a : editorHelpers_1.EditorHelper.ellipsify(option.a, this.TEXT_MAX_LENGTH)) : \"-no text-\", offsetX, offsetY, __assign(__assign({}, this.fontOptions), { color: isHighlighted || isSelected ? \"black\" : \"grey\" }));\n            if (isHighlighted || isSelected) {\n                // Draw connect indicator when highlighted\n                var zA = new plotboilerplate_1.Vertex(graphNode.editor.position).addXY(this.boxSize.width + 16, this.boxSize.height / 2.0 + (j + 1) * (this.boxSize.height + 2) - 2);\n                this.pb.fill.circle(zA, 5, \"orange\");\n            }\n            offsetY += this.boxSize.height + 2;\n        }\n    };\n    EditorRenderer.prototype.renderConnections = function (dialogConfig) {\n        var nodeNames = Object.keys(dialogConfig.graph);\n        var count = nodeNames.length;\n        for (var i = 0; i < count; i++) {\n            var nodeName = nodeNames[i];\n            var graphNode = dialogConfig.graph[nodeName];\n            for (var j = 0; j < graphNode.o.length; j++) {\n                var successorName = graphNode.o[j].next;\n                if (!successorName) {\n                    continue;\n                }\n                var successorNode = dialogConfig.graph[successorName];\n                if (!successorNode) {\n                    continue;\n                }\n                var isHighlighted = this.editorHelpers.isOptionHighlighted(nodeName, j);\n                var otherOptionIsSelected = this.editorHelpers.selectedOption !== null && !this.editorHelpers.isOptionSelected(nodeName, j);\n                var isSelected = this.editorHelpers.isOptionSelected(nodeName, j);\n                // this.drawLinearConnection(graphNode, successorNode, j);\n                this.drawBezierConnection(graphNode, j, successorNode.editor.position, isHighlighted && !otherOptionIsSelected, isSelected);\n            }\n        }\n    };\n    EditorRenderer.prototype.drawBezierConnection = function (graphNode, j, successorNodePosition, isHighlighted, isSelected) {\n        // Construct Bézier handles.\n        var zA = new plotboilerplate_1.Vertex(graphNode.editor.position).addXY(this.boxSize.width + 16, this.boxSize.height / 2.0 + (j + 1) * (this.boxSize.height + 2) - 2);\n        var zB = new plotboilerplate_1.Vertex(successorNodePosition);\n        var cA = zA.clone().addXY(50, 0);\n        var cB = zB.clone().subXY(50, 50);\n        var isCanvas = this.pb.canvas instanceof HTMLCanvasElement;\n        if (isCanvas) {\n            // Maybe future versions of PlotBoilerplate support this for Canvas & SVG nodes\n            if (isHighlighted) {\n                this.pb.draw.ctx.setLineDash([10, 6]);\n            }\n            else {\n                this.pb.draw.ctx.setLineDash([0]);\n            }\n        }\n        this.cubicBezierArrow(zA, zB, cA, cB, isHighlighted || isSelected ? \"rgba(0,192,255,0.5)\" : \"rgba(255,192,0,0.5)\", 2);\n        if (isCanvas) {\n            this.pb.draw.ctx.setLineDash([0]);\n        }\n    };\n    /**\n     * Draw a line and an arrow at the end (zB) of the given line with the specified (CSS-) color.\n     *\n     * @method arrow\n     * @param {Vertex} zA - The start point of the arrow-line.\n     * @param {Vertex} zB - The end point of the arrow-line.\n     * @param {string} color - Any valid CSS color string.\n     * @param {number=} lineWidth - (optional) The line width to use; default is 1.\n     * @return {void}\n     * @instance\n     * @memberof drawutils\n     **/\n    EditorRenderer.prototype.cubicBezierArrow = function (zA, zB, cA, cB, color, lineWidth) {\n        var _this = this;\n        var headlen = 8; // length of head in pixels\n        var vertices = plotboilerplate_1.Vertex.utils\n            .buildArrowHead(cB, zB, headlen, 1.0, 1.0) // this.pb.draw.scale.x, this.pb.draw.scale.y);\n            .map(function (vertex) {\n            return vertex.scale(1.0 / _this.pb.draw.scale.x, zB);\n        });\n        this.pb.draw.cubicBezier(zA, zB, cA, cB, color, lineWidth);\n        this.pb.fill.polyline(vertices, false, color, lineWidth);\n        // Draw bezier control lines?\n        // this.pb.draw.line(zA, cA, \"grey\", 1);\n        // this.pb.draw.line(zB, cB, \"grey\", 1);\n    };\n    EditorRenderer.OPTION_OFFSET_X = 16;\n    return EditorRenderer;\n}());\nexports.EditorRenderer = EditorRenderer;\n//# sourceMappingURL=editorRenderer.js.map","// import { detectDarkMode } from \"./detectDarkMode\";\n// import { RPGDOMHelpers } from \"./domHelpers\";\n// import { EditorHelper } from \"./editorHelpers\";\n// import { Editor } from \"./Editor\";\n// import { gup } from \"./gup\";\n// import { DialogueMetaHelpers } from \"./metaHelpers\";\n// import { Modal } from \"./modal\";\n// import { RPGDialogueLogic } from \"./RPGDialogueLogic\";\n// import { TouchHandler } from \"./TouchHandler\";\n\n// export const RPG = {\n//   detectDarkMode: detectDarkMode,\n//   RPGDOMHelpers: RPGDOMHelpers,\n//   Editor: Editor,\n//   EditorHelper: EditorHelper,\n//   gup: gup,\n//   DialogueMetaHelpers: DialogueMetaHelpers,\n//   Modal: Modal,\n//   RPGDialogueLogic: RPGDialogueLogic,\n//   TouchHandler: TouchHandler\n// };\n\n// globalThis.RPGDOMHelpers = RPGDOMHelpers;\n// globalThis.Editor = Editor;\n// globalThis.EditorHelper = EditorHelper;\n// globalThis.gup = gup;\n// globalThis.DialogueMetaHelpers = DialogueMetaHelpers;\n// globalThis.globalThisModal = globalThisModal;\n// globalThis.RPGDialogueLogic = RPGDialogueLogic;\n// globalThis.TouchHandler = TouchHandler;\n\n// import { detectDarkMode } from \"./detectDarkMode\";\n// import { RPGDOMHelpers } from \"./domHelpers\";\n// import { EditorHelper } from \"./editorHelpers\";\n// import { Editor } from \"./Editor\";\n// import { gup } from \"./gup\";\n// import { DialogueMetaHelpers } from \"./metaHelpers\";\n// import { Modal } from \"./modal\";\n// import { RPGDialogueLogic } from \"./RPGDialogueLogic\";\n// import { TouchHandler } from \"./TouchHandler\";\n\nglobalThis.gup = require(\"./gup\").gup;\nglobalThis.detectDarkMode = require(\"./detectDarkMode\").detectDarkMode;\nglobalThis.RPGDialogueLogic = require(\"./RPGDialogueLogic\").RPGDialogueLogic;\nglobalThis.RPGDOMHelpers = require(\"./domHelpers\").RPGDOMHelpers;\nglobalThis.DialogueMetaHelpers = require(\"./metaHelpers\").DialogueMetaHelpers;\nglobalThis.Modal = require(\"./modal\").Modal;\nglobalThis.EditorHelper = require(\"./editorHelpers\").EditorHelper;\nglobalThis.TouchHandler = require(\"./TouchHandler\").TouchHandler;\nglobalThis.Editor = require(\"./Editor\").Editor;\n\nconsole.log(\"Editor\", Editor);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.gup = void 0;\n// Get the URI GET params as an assoc.\n//\n// A nicer version with regex\n// Found at\n//    https://stackoverflow.com/questions/979975/how-to-get-the-value-from-the-get-parameters?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa\nvar gup = function () {\n    var vars = {};\n    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (_m, key, value) {\n        var args = [];\n        for (var _i = 3; _i < arguments.length; _i++) {\n            args[_i - 3] = arguments[_i];\n        }\n        vars[key] = value;\n        return value;\n    });\n    return vars;\n};\nexports.gup = gup;\n//# sourceMappingURL=gup.js.map","\"use strict\";\n/**\n * Helper to edit dialogue meta data.\n *\n * @author  Ikaros Kappler\n * @date    2023-08-09\n * @version 1.0.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DialogueMetaHelpers = void 0;\nvar modal_1 = require(\"./modal\");\nvar DialogueMetaHelpers = /** @class */ (function () {\n    function DialogueMetaHelpers(editorHelpers) {\n        this.editorHelpers = editorHelpers;\n        document.getElementById(\"b-configure-meta\").addEventListener(\"click\", this.handleModalOpen());\n    }\n    DialogueMetaHelpers.prototype.handleModalOpen = function () {\n        var _this = this;\n        var _self = this;\n        return function () {\n            _self.metaCopy = DialogueMetaHelpers.cloneMeta(_this.editorHelpers.dialogConfigWithPositions.meta);\n            _self.editorHelpers.domHelper.modal.setTitle(\"Dialogue Config Meta Data\");\n            _self.editorHelpers.domHelper.modal.setBody(_self.buildMetaBody());\n            _self.editorHelpers.domHelper.modal.setFooter(\"\");\n            _self.editorHelpers.domHelper.modal.setActions([{ label: \"Save\", action: _self.handleSave() }, modal_1.Modal.ACTION_CANCEL]);\n            _self.editorHelpers.domHelper.modal.open();\n        };\n    };\n    DialogueMetaHelpers.prototype.updateModalBody = function () {\n        var newBody = this.buildMetaBody();\n        this.editorHelpers.domHelper.modal.setBody(newBody);\n    };\n    DialogueMetaHelpers.prototype.buildMetaBody = function () {\n        var metaBody = document.createElement(\"div\");\n        this.inputName = document.createElement(\"input\");\n        this.inputName.value = this.metaCopy.name;\n        this.inputName.addEventListener(\"change\", this.handleUpdateMetaName());\n        var nameLabel = document.createElement(\"div\");\n        nameLabel.innerHTML = \"Dialogue name\";\n        var npcContainer = document.createElement(\"div\");\n        npcContainer.classList.add(\"e-meta-npccontainer\");\n        this.inputsNpcNames = [];\n        for (var i = 0; i < this.metaCopy.npcs.length; i++) {\n            var container = document.createElement(\"div\");\n            var label = document.createElement(\"div\");\n            label.innerHTML = \"NPC #\".concat(i);\n            var npcNameInput = document.createElement(\"input\");\n            npcNameInput.value = this.metaCopy.npcs[i].name;\n            npcNameInput.addEventListener(\"change\", this.handleNpcNameChange(i));\n            var btnRemove = document.createElement(\"button\");\n            btnRemove.innerHTML = \"&#x1F5D1;\";\n            btnRemove.addEventListener(\"click\", this.handleDeleteNpc(i));\n            container.appendChild(label);\n            container.appendChild(npcNameInput);\n            container.appendChild(btnRemove);\n            npcContainer.appendChild(container);\n            this.inputsNpcNames.push(npcNameInput);\n        }\n        var btnAddNpc = document.createElement(\"button\");\n        btnAddNpc.innerHTML = \"Add NPC\";\n        btnAddNpc.addEventListener(\"click\", this.handleAddNpc());\n        metaBody.appendChild(nameLabel);\n        metaBody.appendChild(this.inputName);\n        metaBody.appendChild(npcContainer);\n        metaBody.appendChild(btnAddNpc);\n        return metaBody;\n    };\n    DialogueMetaHelpers.prototype.handleUpdateMetaName = function () {\n        var _self = this;\n        return function (event) {\n            _self.metaCopy.name = event.target.value;\n        };\n    };\n    DialogueMetaHelpers.prototype.handleNpcNameChange = function (index) {\n        var _self = this;\n        return function (event) {\n            _self.metaCopy.npcs[index].name = event.target.value;\n        };\n    };\n    DialogueMetaHelpers.prototype.handleDeleteNpc = function (index) {\n        var _self = this;\n        return function () {\n            _self.metaCopy.npcs.splice(index, 1);\n            _self.updateModalBody();\n        };\n    };\n    DialogueMetaHelpers.prototype.handleAddNpc = function () {\n        var _self = this;\n        return function () {\n            _self.metaCopy.npcs.push({ name: \"New NPC\" });\n            _self.updateModalBody();\n        };\n    };\n    DialogueMetaHelpers.prototype.handleSave = function () {\n        var _self = this;\n        return function () {\n            _self.editorHelpers.dialogConfigWithPositions.meta = _self.metaCopy;\n            _self.editorHelpers.domHelper.modal.close();\n            _self.editorHelpers.domHelper.updateNpcSelector();\n        };\n    };\n    DialogueMetaHelpers.cloneMeta = function (meta) {\n        var copy = {};\n        copy.name = meta.name;\n        copy.npcs = [];\n        for (var i = 0; i < meta.npcs.length; i++) {\n            copy.npcs.push({ name: meta.npcs[i].name });\n        }\n        return copy;\n    };\n    return DialogueMetaHelpers;\n}());\nexports.DialogueMetaHelpers = DialogueMetaHelpers;\n//# sourceMappingURL=metaHelpers.js.map","\"use strict\";\n/**\n * Original source: https://www.w3schools.com/howto/howto_css_modals.asp\n *\n * @requires modal.css\n *\n * Converted to a class by\n * @author   Ikaros Kappler\n * @date     2020-09-14\n * @modified 2023-08-09 Ported to typescript.\n * @version  1.1.0\n **/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Modal = void 0;\nvar Modal = /** @class */ (function () {\n    function Modal() {\n        this.modalElements = this.buildDOMNode(\"myModal-\" + Modal.MODAL_COUNTER++);\n    }\n    Modal.prototype.setTitle = function (title) {\n        this.modalElements.modal.header.content.innerHTML = title;\n    };\n    Modal.prototype.setBody = function (bodyContent) {\n        if (Modal.isDOMNode(bodyContent)) {\n            Modal.removeChildNodes(this.modalElements.modal.body.content);\n            this.modalElements.modal.body.content.append(bodyContent);\n        }\n        else {\n            this.modalElements.modal.body.content.innerHTML = bodyContent;\n        }\n    };\n    Modal.prototype.setFooter = function (title) {\n        if (typeof title === \"string\") {\n            this.modalElements.modal.footer.content.innerHTML = title.length == 0 ? \"&nbsp;\" : title;\n        }\n        else {\n            console.log(\"Footer elements?\");\n        }\n    };\n    Modal.prototype.setActions = function (actions) {\n        var _self = this;\n        Modal.removeChildNodes(this.modalElements.modal.footer.actions);\n        if (Array.isArray(actions)) {\n            for (var i in actions) {\n                var a = actions[i];\n                var cmd = null;\n                var btn = document.createElement(\"button\");\n                btn.innerHTML = a.label;\n                if (typeof a.action === \"function\") {\n                    btn.addEventListener(\"click\", a.action);\n                }\n                else if ((typeof a === \"string\" && (cmd = a) != null) || (typeof a.action === \"string\" && (cmd = a.action) != null)) {\n                    if (cmd === \"cancel\" || cmd === \"ok\" || cmd === \"close\")\n                        btn.addEventListener(\"click\", function () {\n                            _self.close();\n                        });\n                }\n                this.modalElements.modal.footer.actions.appendChild(btn);\n            }\n        }\n    };\n    Modal.prototype.close = function () {\n        this.modalElements.modal.parent.classList.remove(\"modal-opened\");\n        this.modalElements.modal.parent.classList.add(\"modal-closed\");\n    };\n    Modal.prototype.open = function () {\n        this.modalElements.modal.parent.classList.remove(\"modal-closed\");\n        this.modalElements.modal.parent.classList.add(\"modal-opened\");\n    };\n    Modal.prototype.buildDOMNode = function (id) {\n        var _self = this;\n        var modal = document.createElement(\"div\");\n        modal.setAttribute(\"id\", id);\n        modal.classList.add(\"modal\");\n        modal.classList.add(\"modal-closed\");\n        var content = document.createElement(\"div\");\n        content.classList.add(\"modal-content\");\n        var header = document.createElement(\"div\");\n        header.classList.add(\"modal-header\");\n        var closeBtn = document.createElement(\"span\");\n        closeBtn.classList.add(\"modal-close\");\n        closeBtn.innerHTML = \"&times;\";\n        var h2 = document.createElement(\"h2\");\n        h2.innerHTML = \"Modal Header\";\n        var body = document.createElement(\"div\");\n        body.classList.add(\"modal-body\");\n        // Body contents?\n        var bodyContent = document.createElement(\"p\");\n        bodyContent.innerHTML = \"Some text in the Modal Body\";\n        var footer = document.createElement(\"div\");\n        footer.classList.add(\"modal-footer\");\n        var footerContent = document.createElement(\"h3\");\n        var footerActions = document.createElement(\"div\");\n        footerContent.innerHTML = \"Modal Footer\";\n        footerActions.classList.add(\"modal-actions\");\n        footer.appendChild(footerContent);\n        footer.appendChild(footerActions);\n        header.appendChild(closeBtn);\n        header.appendChild(h2);\n        content.appendChild(header);\n        body.appendChild(bodyContent);\n        content.appendChild(body);\n        content.appendChild(footer);\n        modal.appendChild(content);\n        // When the user clicks on <span> (x), close the modal\n        closeBtn.onclick = function () {\n            _self.close();\n        };\n        // Append new modal to body\n        document.getElementsByTagName(\"body\")[0].appendChild(modal);\n        return {\n            modal: {\n                id: id,\n                parent: modal,\n                header: {\n                    closeBtn: closeBtn,\n                    content: h2\n                },\n                body: { content: bodyContent },\n                footer: {\n                    content: footerContent,\n                    actions: footerActions\n                }\n            }\n        };\n    };\n    // https://stackoverflow.com/questions/384286/how-do-you-check-if-a-javascript-object-is-a-dom-object\n    Modal.isDOMNode = function (obj) {\n        try {\n            //Using W3 DOM2 (works for FF, Opera and Chrome)\n            return obj instanceof HTMLElement;\n        }\n        catch (e) {\n            //Browsers not supporting W3 DOM2 don't have HTMLElement and\n            //an exception is thrown and we end up here. Testing some\n            //properties that all elements have (works on IE7)\n            return (typeof obj === \"object\" && obj.nodeType === 1 && typeof obj.style === \"object\" && typeof obj.ownerDocument === \"object\");\n        }\n    };\n    Modal.ACTION_CLOSE = { label: \"Close\", action: \"close\" };\n    Modal.ACTION_CANCEL = { label: \"Cancel\", action: \"close\" };\n    Modal.ACTION_OK = { label: \"OK\", action: \"close\" };\n    Modal.MODAL_COUNTER = 0;\n    Modal.removeChildNodes = function (node) {\n        // Remove all current actions\n        while (node.firstChild) {\n            node.removeChild(node.lastChild);\n        }\n    };\n    return Modal;\n}());\nexports.Modal = Modal;\n//# sourceMappingURL=modal.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkrpg_dialogue\"] = self[\"webpackChunkrpg_dialogue\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [736], () => (__webpack_require__(706)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","exports","gup_1","detectDarkMode_1","plotboilerplate_1","RPGDialogueLogic_1","editorHelpers_1","editorRenderer_1","TouchHandler_1","FileDrop_1","modal_1","Editor","dialogueConfigJSONPath","isRecoveryFromLocalStorageActive","this","currentMouseHandler","currentTouchHandler","_self","console","log","GUP","gup","isDarkmode","detectDarkMode","pb","PlotBoilerplate","utils","safeMergeByKeys","canvas","document","getElementById","fullSize","fitToParent","scaleX","scaleY","rasterGrid","drawOrigin","rasterAdjustFactor","redrawOnResize","defaultCanvasWidth","defaultCanvasHeight","canvasWidthFactor","canvasHeightFactor","cssScaleX","cssScaleY","cssUniformScale","autoAdjustOffset","offsetAdjustXPercent","offsetAdjustYPercent","backgroundColor","enableMouse","enableKeys","boxSize","width","height","editorHelpers","EditorHelper","editorRenderer","EditorRenderer","config","postDraw","draw","fill","dialogConfig","renderBoxes","renderConnections","tryLoadFromLocalStorage","then","dc","handleDialogConfigLoaded","catch","tryLoadFromJSON","FileDrop","eventCatcher","onFileJSONDropped","jsonObject","fromObject","addEventListener","click","_evt","fileInput","files","length","reader","FileReader","onload","jsonText","result","JSON","parse","readAsText","testCurrentDialogueConfig","requestCreateNewGraph","showJSON","window","open","prototype","tryStartAutosaveLoop","autosaveTimer","globalThis","setInterval","tryAutoSave","domHelper","isAutoSave","putToLocalStorage","modal","setTitle","setBody","setFooter","setActions","Modal","ACTION_CANCEL","label","action","close","performNewGraph","meta","name","npcs","graph","intro","q","o","a","next","editor","position","x","y","dConfig","isExportWithoutPositions","removePositions","dialogConfigWithPositions","jsonString","stringify","jsonArea","createElement","setAttribute","innerHTML","classList","add","ACTION_CLOSE","outputContainer","outputQuestion","outputOptions","appendChild","rpgLogic","RPGDialogueLogic","addDialogueChangeListener","dialogueConfig","nextNodeName","oldNodeName","selectedOptionIndex","setHighlightedNode","alternateStartNodeName","selectedNodeName","setSelectedNode","beginConversation","enrichPositions","enrichMetaData","setDialogConfig","destroy","boxMovehandler","TouchHandler","redraw","localStorage","setItem","loadConfigFromJSON","Promise","accept","reject","getItem","exception","warn","__importDefault","mod","__esModule","Object","defineProperty","value","axios_1","dialogueStruct","validateStructure","structure","listeners","resetToBeginning","validate","listener","i","push","removeDialogueChangeListener","splice","fireStateChange","getCurrentNpcName","_a","_b","_c","npcIndex","currentQuestionaire","loadCurrentQuestionaire","setQuestionText","addOptionNode","npcName","getCurrentQuestionaire","isEndReached","undefined","sendAnswer","index","oldQuestionaireName","currentQuestionaireName","selectedAnswer","nextQuestionaire","getHTMLElement","nodeId","questionNodeId","optionsNodeId","questionNode","optionsNode","questionText","concat","clearOptionsNode","answerText","optionIndex","answerNode","answerLinkNode","path","default","get","response","data","error","finally","loadFromJSON","struct","TouchEnterLeaveHandler","editorHelper","wasTouchUsed","draggedOption","relPos","pos","bounds","getBoundingClientRect","left","top","draggedNodeName","draggedNode","wasDragged","touchMovePos","touchDownPos","clearTouch","afProps","touchStart","evt","touches","Vertex","clientX","clientY","locateNodeBoxNameAtPos","transformMousePosition","locateOptionBoxNameAtPos","touchMove","preventDefault","stopPropagation","rel","trans","diff","difference","touchEnd","selectedOption","handleOptionReconnect","setSelectedOption","touchCancel","alloyFinger","createAlloyFinger","onTouchLeaveEvents","onTouchEnterEvents","_init","onTouchEnter","selector","fn","_this","slice","map","e","onTouchLeave","lastTouchLeave","lastTouchEnter","el","elementFromPoint","event","matches","hasOwnProperty","overrideValue","toLowerCase","hours","Date","getHours","RPGDOMHelpers","currentDraggedAnswerIndex","currentDropAnswerIndex","touchEnterLeaveHandler","editorElement","optionsElement","keyElement","querySelector","npcElement","qElement","handleQChanged","handleNPCIndexChanged","handleKeyChanged","exportJSON","addAnswerOption","addDialogueNode","requestRemoveDialogueNode","checked","blob","Blob","type","url","URL","createObjectURL","href","download","textContent","currentGraphNode","updateAnswerOptions","addNewDialogueNode","currentNodeName","removeDialogueNode","removeNewDialogueNode","toggleVisibility","isVisible","remove","changeEvent","target","_changeEvent","newIndex","parseInt","Number","isNaN","newName","trim","renameGraphNode","handleATextChanged","answer","handleASuccessorChanged","showAnswerOptions","getSelectedNpcIndex","updateNpcSelector","curNpcIndex","npcOption","selected","toggleDragEnterStyles","answerIndex","dropIndex","getAttribute","contains","toggleDragLeaveStyles","nodeName","graphNode","onDragOver","ev","onDragLeave","element","drop","performDrop","isTouchDevice","dropArea","makeADropArea","option","answerWrapperElement","answerControlsElement","makeAnswerControlElement","answerElement","labelElement","textElement","selectElement","createNodeSelectElement","dndHandleElement","dataTransfer","setData","dragStartElement","parentElement","_ev","container","dropArea_1","controlElement","dndElement","upDownElement","upBtn","downBtn","deleteButton","requestDeleteOption","old","handleDeleteOption","currentKey","selectedKey","optionElement","createNodeSelectOptionElement","key","questionaire","optionElement_1","questionaireText","isCurrent","isSelected","ellipsify","domHelpers_1","metaHelpers_1","highlightedNodeName","highlightedNode","selectedNode","hightlightedOption","relativeMousePosition","metaHelpers","DialogueMetaHelpers","noRedraw","setHighlightedOption","isRedrawRequired","isEqualOptionIdentifyer","getRandomPosition","viewport","min","Math","random","node","baseConfig","configWithPositions","isPosInGraphNodeBox","isPosInOptionNodeBox","OPTION_OFFSET_X","isNodeHighlighted","nodName","isOptionHighlighted","isOptionSelected","randomNodeKey","newNode","mouseDownPos","lastMouseDownPos","draggingNode","draggingNodeName","MouseHandler","down","params","up","drag","dragAmount","scale","move","mouseMovePos","hoveringOptionIdentifyer","hoveringNodeName","mouseClickPos","handleClick","clickedOptionIdentifyer","clickedNodeName","sourceNode","identA","identB","oldName","tmpNode","j","text","maxLength","substring","object","clone","count","keys","__assign","assign","t","s","n","arguments","p","call","apply","getContrastColor_1","Color_1","TEXT_MAX_LENGTH","fontOptions","color","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","textAlign","rotation","Color","getContrastColor","setAlpha","cssRGBA","nodeNames","renderGraphNode","renderOptions","renderSuggestedConnection","isMousePosInsideOption","bezierTargetPosition","drawBezierConnection","isNodeSelected","rect","offsetY","offsetX","isHighlighted","zA","addXY","circle","successorName","successorNode","otherOptionIsSelected","successorNodePosition","zB","cA","cB","subXY","isCanvas","HTMLCanvasElement","ctx","setLineDash","cubicBezierArrow","lineWidth","vertices","buildArrowHead","vertex","cubicBezier","polyline","vars","location","replace","_m","args","_i","handleModalOpen","metaCopy","cloneMeta","buildMetaBody","handleSave","updateModalBody","newBody","metaBody","inputName","handleUpdateMetaName","nameLabel","npcContainer","inputsNpcNames","npcNameInput","handleNpcNameChange","btnRemove","handleDeleteNpc","btnAddNpc","handleAddNpc","copy","modalElements","buildDOMNode","MODAL_COUNTER","title","header","content","bodyContent","isDOMNode","removeChildNodes","body","append","footer","actions","Array","isArray","cmd","btn","parent","id","closeBtn","h2","footerContent","footerActions","onclick","getElementsByTagName","obj","HTMLElement","nodeType","style","ownerDocument","ACTION_OK","firstChild","removeChild","lastChild","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","m","O","chunkIds","priority","notFulfilled","Infinity","fulfilled","every","r","d","definition","enumerable","g","Function","prop","Symbol","toStringTag","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","forEach","bind","__webpack_exports__"],"sourceRoot":""}