"use strict";(self.webpackChunkrpg_dialogue=self.webpackChunkrpg_dialogue||[]).push([[736],{726:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getContrastColor=void 0;var i=s(696),r=i.Color.makeRGB(0,0,0),n=i.Color.makeRGB(255,255,255);e.getContrastColor=function(t){var e=2.2;return.2126*Math.pow(t.r,e)+.7152*Math.pow(t.g,e)+.0722*Math.pow(t.b,e)>Math.pow(.5,e)?r:n}},696:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;var s=function(){function t(){this.r=this.g=this.b=0,this.h=this.s=this.l=0,this.a=1}return t.prototype.cssRGB=function(){return"rgb("+Math.round(255*this.r)+","+Math.round(255*this.g)+","+Math.round(255*this.b)+")"},t.prototype.cssRGBA=function(){return"rgba("+Math.round(255*this.r)+","+Math.round(255*this.g)+","+Math.round(255*this.b)+","+this.a+")"},t.prototype.red=function(){return this.r},t.prototype.green=function(){return this.g},t.prototype.blue=function(){return this.b},t.prototype.set=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.h=t.h,this.s=t.s,this.l=t.l,this},t.prototype.setRed=function(t){return this.r=t,this},t.prototype.setBlue=function(e){return this.b=e,t.Converter.RGBToHSL(this),this},t.prototype.setAlpha=function(e){return this.a=e,t.Converter.RGBToHSL(this),this},t.prototype.setGreen=function(e){return this.g=e,t.Converter.RGBToHSL(this),this},t.prototype.setHue=function(e){return this.h=e,t.Converter.HSLToRGB(this),this},t.prototype.setSaturation=function(e){return this.s=e,t.Converter.HSLToRGB(this),this},t.prototype.setLuminance=function(e){return this.l=e,t.Converter.HSLToRGB(this),this},t.prototype.cssHSL=function(){return"hsl("+Math.round(360*this.h)+","+Math.round(100*this.s)+"%,"+Math.round(100*this.l)+"%)"},t.prototype.cssHSLA=function(){return"hsla("+Math.round(360*this.h)+","+Math.round(100*this.s)+"%,"+Math.round(100*this.l)+"%,"+Math.round(this.a)+")"},t.prototype.hue=function(){return this.h},t.prototype.saturation=function(){return this.s},t.prototype.lightness=function(){return this.l},t.prototype.cssHEX=function(){return"#"+(255*this.r<16?"0":"")+Math.round(255*this.r).toString(16)+(255*this.g<16?"0":"")+Math.round(255*this.g).toString(16)+(255*this.b<16?"0":"")+Math.round(255*this.b).toString(16)},t.prototype.alpha=function(){return this.a},t.prototype.saturate=function(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.s+=(1-this.s)*(e/100);else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.s+=e>=-0&&e<=1?(1-this.s)*e:(1-this.s)*(e/255)}return this.s>1?this.s=1:this.s<0&&(this.s=0),t.Converter.HSLToRGB(this),this},t.prototype.desaturate=function(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.s-=e/100;else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.s-=e>=0&&e<=1?this.s*e:this.s*(e/255)}return this.s>1?this.s=1:this.s<0&&(this.s=0),t.Converter.HSLToRGB(this),this},t.prototype.lighten=function(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.l+=(1-this.l)*(e/100);else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.l+=e>=0&&e<=1?(1-this.l)*e:(1-this.l)*(e/255)}return this.l>1?this.l=1:this.l<0&&(this.l=0),t.Converter.HSLToRGB(this),this},t.prototype.darken=function(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.l-=this.l*(e/100);else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.l-=e>=0&&e<=1?this.l*e:this.l*(e/255)}return this.l>1?this.l=1:this.l<0&&(this.l=0),t.Converter.HSLToRGB(this),this},t.prototype.fadein=function(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.a+=(1-this.a)*(e/100);else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.a+=e>=0&&e<=1?(1-this.a)*e:(1-this.a)*(e/255)}return console.log("New alpha",this.a),this.a>1?this.a=1:this.a<0&&(this.a=0),t.Converter.HSLToRGB(this),this},t.prototype.fadeout=function(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.a-=e/100;else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.a-=e>=0&&e<=1?e:e/255}return this.a>1?this.a=1:this.a<0&&(this.a=0),t.Converter.HSLToRGB(this),this},t.prototype.spin=function(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.h+=e/100;else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.h+=e/360}return this.h>1?this.h=1:this.h<0&&(this.h=0),t.Converter.HSLToRGB(this),this},t.makeRGB=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];var i,r=new t;if(arguments.length<3||arguments.length>4)throw new Error("error: 3 or 4 arguments");return i=t.Sanitizer.RGB(arguments[0],arguments[1],arguments[2]),r.r=i[0],r.g=i[1],r.b=i[2],r.a=4==arguments.length?arguments[3]:1,t.Converter.RGBToHSL(r),r},t.makeHSL=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];var i,r=new t;if(arguments.length<3||arguments.length>4)throw new Error("error: 3 or 4 arguments");return i=t.Sanitizer.HSL(arguments[0],arguments[1],arguments[2]),r.h=i[0],r.s=i[1],r.l=i[2],r.a=4==arguments.length?arguments[3]:1,t.Converter.HSLToRGB(r),r},t.makeHEX=function(e){var s,i=new t;if(e&&e.startsWith("#")&&(e=e.substr(1)),t.Validator.checkHEX(e),3==e.length)s=t.Sanitizer.RGB(parseInt(e.substr(0,1)+e.substr(0,1),16),parseInt(e.substr(1,1)+e.substr(1,1),16),parseInt(e.substr(2,1)+e.substr(2,1),16));else{if(6!=e.length)throw new Error("error: 3 or 6 arguments");s=t.Sanitizer.RGB(parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16))}return i.r=s[0],i.g=s[1],i.b=s[2],i.a=1,t.Converter.RGBToHSL(i),i},t.parse=function(e){if(void 0===e)return null;if(0==(e=e.trim().toLowerCase()).length)return null;if(e.startsWith("#"))return t.makeHEX(e.substring(1,e.length));if(e.startsWith("rgb")){var s=e.match(/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,?\s*(\d*(?:\.\d+\s*)?)\)$/);if(!s)throw"Unrecognized color format (2): "+e;return s.length<=4||void 0===s[4]||""==s[4]?t.makeRGB(s[1],s[2],s[3]):t.makeRGB(s[1],s[2],s[3],Number(s[4]))}throw"Unrecognized color format (1): "+e},t.prototype.clone=function(){var e=new t;return e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a,e.h=this.h,e.s=this.s,e.l=this.l,e},t.prototype.interpolate=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this.a+=(t.a-this.a)*e,this},t.Sanitizer={RGB:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var s=[];if(0==arguments.length)return[];for(var i=0;i<arguments.length;i++){var r=arguments[i];if("string"==typeof r&&r.indexOf("%")>-1){if(NaN==(r=parseInt(r)))throw new Error("Bad format");if(r<0||r>100)throw new Error("Bad format");s[i]=r/100}else{if("string"==typeof r&&NaN==(r=parseInt(r)))throw new Error("Bad format");if(r<0)throw new Error("Bad format");if(r>=0&&r<1)s[i]=r;else{if(!(r>=1&&r<256))throw new Error("Bad format ("+r+")");s[i]=r/255}}}return s},HSL:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(arguments.length<3||arguments.length>4)throw new Error("3 or 4 arguments required");var s=arguments[0],i=arguments[1],r=arguments[2];if("string"==typeof s&&NaN==(s=parseFloat(s)))throw new Error("Bad format for hue");if(s<0||s>360)throw new Error("Hue out of range (0..360)");if(((""+s).indexOf(".")>-1&&s>1||-1==(""+s).indexOf("."))&&(s/=360),"string"==typeof i&&i.indexOf("%")>-1){if(NaN==(i=parseInt(i)))throw new Error("Bad format for saturation");if(i<0||i>100)throw new Error("Bad format for saturation");i/=100}else if(i<0||i>1)throw new Error("Bad format for saturation");if("string"==typeof r&&r.indexOf("%")>-1){if(NaN==(r=parseInt(r)))throw new Error("Bad format for lightness");if(r<0||r>100)throw new Error("Bad format for lightness");r/=100}else if(r<0||r>1)throw new Error("Bad format for lightness");return[s,i,r]}},t.Validator={checkHEX:function(t){if(6!=t.length&&3!=t.length)throw new Error("Hexa color: bad length ("+t.length+"),"+t);t=t.toLowerCase();for(var e=0;e<t.length;e++){var s=t.charCodeAt(e);if(!(s>=48&&s<=57||s>=97&&s<=102))throw new Error('Hexa color: out of range for "'+t+'" at position '+e+".")}}},t.Converter={RGBToHSL:function(t){var e=t.r,s=t.g,i=t.b,r=Math.max(e,s,i),n=Math.min(e,s,i);if(t.l=(r+n)/2,r==n)t.h=t.s=0;else{var a=r-n;switch(t.s=t.l>.5?a/(2-r-n):a/(r+n),r){case e:t.h=(s-i)/a+(s<i?6:0);break;case s:t.h=(i-e)/a+2;break;case i:t.h=(e-s)/a+4}t.h/=6}},HSLToRGB:function(e){var s=e.h,i=e.s,r=e.l;if(0==i)e.r=e.g=e.b=r;else{var n=r<.5?r*(1+i):r+i-r*i,a=2*r-n;e.r=t.Converter.hue2rgb(a,n,s+1/3),e.g=t.Converter.hue2rgb(a,n,s),e.b=t.Converter.hue2rgb(a,n,s-1/3)}},hue2rgb:function(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t}},t}();e.Color=s},655:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FileDrop=void 0;var s=function(){function t(t){var e=this;this.handleDropEvent=function(t){if(t.preventDefault(),t.stopPropagation(),e.element.style.opacity="1.0",t.dataTransfer&&t.dataTransfer.files&&0!==t.dataTransfer.files.length&&!(t.dataTransfer.files.length>1)&&t.dataTransfer.files[0]){var s=t.dataTransfer.files[0];if(s.type.match(/json.*/)&&null!==e.fileDroppedCallbackJSON)(i=new FileReader).onload=function(t){if(t.target){var s=JSON.parse(t.target.result);e.fileDroppedCallbackJSON&&e.fileDroppedCallbackJSON(s)}else console.warn("Cannot process JSON ProgressEvent data: target is null.")},i.readAsText(s);else if(s.type.match(/text\/plain.*/)&&e.fileDroppedCallbackText){(i=new FileReader).onload=function(t){t.target?e.fileDroppedCallbackText&&e.fileDroppedCallbackText(t.target.result):console.warn("Cannot process Text ProgressEvent data: target is null.")},i.readAsText(s)}else if(e.fileDroppedCallbackBinary){(i=new FileReader).onload=function(t){t.target?e.fileDroppedCallbackBinary&&e.fileDroppedCallbackBinary(new Blob([t.target.result]),s):console.warn("Cannot process Binary ProgressEvent data: target is null.")},i.readAsBinaryString(s)}else if(e.fileDroppedCallbackSVG){var i;(i=new FileReader).onload=function(t){if(t.target){var s=(new DOMParser).parseFromString(t.target.result,"image/svg+xml");e.fileDroppedCallbackSVG&&e.fileDroppedCallbackSVG(s)}else console.warn("Cannot process SVG ProgressEvent data: target is null.")},i.readAsText(s)}}},this.handleDragOverEvent=function(t){t.preventDefault(),t.stopPropagation(),e.element.style.opacity="0.5"},this.handleDragLeaveEvent=function(t){t.preventDefault(),t.stopPropagation(),e.element.style.opacity="1.0"},this.element=t,t.addEventListener("drop",this.handleDropEvent.bind(this)),t.addEventListener("dragover",this.handleDragOverEvent.bind(this)),t.addEventListener("dragleave",this.handleDragLeaveEvent.bind(this))}return t.prototype.onFileJSONDropped=function(t){this.fileDroppedCallbackJSON=t},t.prototype.onFileTextDropped=function(t){this.fileDroppedCallbackText=t},t.prototype.onFileSVGDropped=function(t){this.fileDroppedCallbackSVG=t},t.prototype.destroy=function(){this.element.removeEventListener("drop",this.handleDropEvent),this.element.removeEventListener("dragover",this.handleDragOverEvent),this.element.removeEventListener("dragleave",this.handleDragLeaveEvent)},t}();e.FileDrop=s},999:(t,e,s)=>{s.r(e),s.d(e,{BezierPath:()=>d,Bounds:()=>h,Circle:()=>g,CircleSector:()=>p,CubicBezierCurve:()=>u,Grid:()=>P,KeyHandler:()=>S,Line:()=>f,MouseHandler:()=>E,PBImage:()=>N,PBText:()=>_,PlotBoilerplate:()=>B,Polygon:()=>o,Triangle:()=>w,UIDGenerator:()=>i,VEllipse:()=>I,VEllipseSector:()=>k,Vector:()=>c,VertTuple:()=>l,Vertex:()=>a,VertexAttr:()=>r,VertexListeners:()=>n,XMouseEvent:()=>A,XWheelEvent:()=>T,drawutils:()=>m,drawutilsgl:()=>x,drawutilssvg:()=>v,geomutils:()=>C});class i{static next(){return""+i.current++}}i.current=0;class r{constructor(){for(var t in this.draggable=!0,this.selectable=!0,this.isSelected=!1,this.visible=!0,r.model)this[t]=r.model[t]}}r.model={draggable:!0,selectable:!0,isSelected:!1,visible:!0};class n{constructor(t){this.click=[],this.drag=[],this.dragStart=[],this.dragEnd=[],this.vertex=t}addClickListener(t){return n._addListener(this.click,t),this}removeClickListener(t){return this.click=n._removeListener(this.click,t),this}addDragListener(t){return n._addListener(this.drag,t),this}removeDragListener(t){return this.drag=n._removeListener(this.drag,t),this}addDragStartListener(t){return n._addListener(this.dragStart,t),this}removeDragStartListener(t){return this.dragStart=n._removeListener(this.dragStart,t),this}addDragEndListener(t){return n._addListener(this.dragEnd,t),this}removeDragEndListener(t){return this.dragEnd=n._removeListener(this.dragEnd,t),this}fireClickEvent(t){n._fireEvent(this,this.click,t)}fireDragEvent(t){n._fireEvent(this,this.drag,t)}fireDragStartEvent(t){n._fireEvent(this,this.dragStart,t)}fireDragEndEvent(t){n._fireEvent(this,this.dragEnd,t)}removeAllListeners(){this.click=[],this.drag=[],this.dragStart=[],this.dragEnd=[]}static _fireEvent(t,e,s){const i=s;for(var r in void 0===i.params?i.params={vertex:t.vertex}:i.params.vertex=t.vertex,e)e[r](i)}static _addListener(t,e){for(var s in t)if(t[s]==e)return!1;return t.push(e),!0}static _removeListener(t,e){for(var s=0;s<t.length;s++)if(t[s]==e)return t.splice(s,1);return t}}class a{constructor(t,e){if(this.className="Vertex",this.uid=i.next(),void 0===t)this.x=0,this.y=0;else if("number"==typeof t&&"number"==typeof e)this.x=t,this.y=e;else{const s=t;"number"==typeof s.x&&"number"==typeof s.y?(this.x=s.x,this.y=s.y):(this.x="number"==typeof t?t:void 0===t?0:NaN,this.y="number"==typeof e?e:void 0===e?0:NaN)}this.attr=new r,this.listeners=new n(this)}set(t,e){if("number"==typeof t&&"number"==typeof e)this.x=t,this.y=e;else{const s=t;"number"==typeof s.x&&"number"==typeof s.y?(this.x=s.x,this.y=s.y):(this.x="number"==typeof t?t:void 0===t?0:NaN,this.y="number"==typeof e?e:void 0===e?0:NaN)}return this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}invX(){return this.x=-this.x,this}invY(){return this.y=-this.y,this}add(t,e){if("number"==typeof t&&"number"==typeof e)this.x+=t,this.y+=e;else{const s=t;if("number"==typeof s.x&&"number"==typeof s.y)this.x+=s.x,this.y+=s.y;else{if("number"!=typeof t)throw`Cannot add ${typeof t} to numeric x component!`;if(this.x+=t,"number"!=typeof e)throw`Cannot add ${typeof e} to numeric y component!`;this.y+=e}}return this}addXY(t,e){return this.x+=t,this.y+=e,this}addX(t){return this.x+=t,this}addY(t){return this.y+=t,this}sub(t,e){if("number"==typeof t&&"number"==typeof e)this.x-=t,this.y-=e;else{const s=t;if("number"==typeof s.x&&"number"==typeof s.y)this.x-=s.x,this.y-=s.y;else{if("number"!=typeof t)throw`Cannot add ${typeof t} to numeric x component!`;if(this.x-=t,"number"!=typeof e)throw`Cannot add ${typeof e} to numeric y component!`;this.y-=e}}return this}subXY(t,e){return this.x-=t,this.y-=e,this}subX(t){return this.x-=t,this}subY(t){return this.y-=t,this}equals(t){var e=Math.abs(this.x-t.x)<a.EPSILON,s=Math.abs(this.y-t.y)<a.EPSILON;return e&&s}clone(){return new a(this.x,this.y)}distance(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}angle(t){const e=void 0===t?Math.PI/2-Math.atan2(this.x,this.y):Math.PI/2-Math.atan2(t.x-this.x,t.y-this.y);return e<0?2*Math.PI+e:e}difference(t){return new a(t.x-this.x,t.y-this.y)}scale(t,e){return this.scaleXY({x:t,y:t},e)}lerp(t,e){var s=this.difference(t);return this.x+=s.x*e,this.y+=s.y*e,this}lerpAbs(t,e){var s=this.distance(t),i=this.difference(t),r=i.x/s,n=i.y/s;return this.x+=r*e,this.y+=n*e,this}scaleXY(t,e){return e&&void 0!==e||(e={x:0,y:0}),this.x=e.x+(this.x-e.x)*t.x,this.y=e.y+(this.y-e.y)*t.y,this}rotate(t,e){e&&void 0!==e||(e={x:0,y:0}),this.sub(e),t+=Math.atan2(this.y,this.x);let s=this.distance(a.ZERO);return this.x=s*Math.cos(t),this.y=s*Math.sin(t),this.add(e),this}multiplyScalar(t){return this.x*=t,this.y*=t,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}inv(){return this.x=-this.x,this.y=-this.y,this}toString(){return"("+this.x+","+this.y+")"}destroy(){this.listeners.removeAllListeners(),this.isDestroyed=!0}static randomVertex(t){return new a(t.min.x+Math.random()*(t.max.x-t.min.x),t.min.y+Math.random()*(t.max.y-t.min.y))}}a.ZERO=new a(0,0),a.EPSILON=1e-6,a.utils={buildArrowHead:(t,e,s,i,r)=>{var n=Math.atan2((e.y-t.y)*r,(e.x-t.x)*i),o=[];return o.push(new a(e.x*i-s*Math.cos(n),e.y*r-s*Math.sin(n))),o.push(new a(e.x*i-1.35*s*Math.cos(n-Math.PI/8),e.y*r-1.35*s*Math.sin(n-Math.PI/8))),o.push(new a(e.x*i,e.y*r)),o.push(new a(e.x*i-1.35*s*Math.cos(n+Math.PI/8),e.y*r-1.35*s*Math.sin(n+Math.PI/8))),o},arrayToJSON:(t,e)=>JSON.stringify(t.map((function(t){return void 0===typeof e?{x:t.x,y:t.y}:{x:Number(t.x.toFixed(e)),y:Number(t.y.toFixed(e))}})))};class o{constructor(t,e){this.className="Polygon",this.uid=i.next(),void 0===t&&(t=[]),this.vertices=t,this.isOpen=e||!1}addVertex(t){this.vertices.push(t)}getVertexAt(t){return t<0?this.vertices[this.vertices.length-Math.abs(t)%this.vertices.length]:this.vertices[t%this.vertices.length]}move(t){for(var e in this.vertices)this.vertices[e].add(t);return this}containsVert(t){for(var e=!1,s=0,i=this.vertices.length-1;s<this.vertices.length;i=s++){let r=this.vertices[s].x,n=this.vertices[s].y,a=this.vertices[i].x,o=this.vertices[i].y;n>t.y!=o>t.y&&t.x<(a-r)*(t.y-n)/(o-n)+r&&(e=!e)}return e}area(){return o.utils.area(this.vertices)}signedArea(){return o.utils.signedArea(this.vertices)}isClockwise(){return o.utils.signedArea(this.vertices)<0}perimeter(){let t=0;for(var e=1;e<this.vertices.length;e++)t+=this.vertices[e-1].distance(this.vertices[e]);return!this.isOpen&&this.vertices.length>1&&(t+=this.vertices[0].distance(this.vertices[this.vertices.length-1])),t}scale(t,e){for(var s in this.vertices)"function"==typeof this.vertices[s].scale?this.vertices[s].scale(t,e):console.log("There seems to be a null vertex!",this.vertices[s]);return this}rotate(t,e){for(var s in this.vertices)this.vertices[s].rotate(t,e);return this}getEvenDistributionPolygon(t){if(t<=0)throw new Error("pointCount must be larger than zero; is "+t+".");const e=new o([],this.isOpen);if(0===this.vertices.length)return e;let s=new a(this.vertices[0]);if(e.vertices.push(s),1===this.vertices.length)return e;const i=this.perimeter()/t,r=this.vertices.length;let n=1,h=new a(this.vertices[1]),l=s.distance(h),c=this.isOpen?r:r+1,u=i;for(var d=1;d<t&&n<c;)if(u<l){let t=s.clone().lerpAbs(h,u);e.vertices.push(t),u+=i,d++}else n++,s=h,h=new a(this.vertices[n%r]),u-=l,l=s.distance(h);return e}getBounds(){return h.computeFromVertices(this.vertices)}clone(){return new o(this.vertices.map((t=>t.clone())),this.isOpen)}toQuadraticBezierData(){if(this.vertices.length<3)return[];var t=[],e=this.vertices[0],s=this.vertices[1],i=new a(e.x+(s.x-e.x)/2,e.y+(s.y-e.y)/2);t.push(i);for(var r=this.isOpen?this.vertices.length:this.vertices.length+1,n=1;n<r;n++){e=this.vertices[n%this.vertices.length],s=this.vertices[(n+1)%this.vertices.length];i=new a(e.x+(s.x-e.x)/2,e.y+(s.y-e.y)/2);t.push(e),t.push(i),e=s}return t}toQuadraticBezierSVGString(){var t=this.toQuadraticBezierData();if(0==t.length)return"";for(var e=["M "+t[0].x+" "+t[0].y],s=1;s<t.length;s+=2)e.push("Q "+t[s].x+" "+t[s].y+", "+t[s+1].x+" "+t[s+1].y);return e.join(" ")}toCubicBezierData(t){if(void 0===t&&(t=1),this.vertices.length<3)return[];var e=[],s=this.vertices[0],i=this.vertices[1],r=new a(s.x+(i.x-s.x)/2,s.y+(i.y-s.y)/2);e.push(r);for(var n=this.isOpen?this.vertices.length-1:this.vertices.length,o=0;o<n;o++){s=this.vertices[o%this.vertices.length],i=this.vertices[(o+1)%this.vertices.length];var h=this.vertices[(o+2)%this.vertices.length],l=new a(s.x+(i.x-s.x)/2,s.y+(i.y-s.y)/2),c=new a(i.x+(h.x-i.x)/2,i.y+(h.y-i.y)/2),u=new a(l.x+(i.x-l.x)*t,l.y+(i.y-l.y)*t),d=new a(c.x+(i.x-c.x)*t,c.y+(i.y-c.y)*t);e.push(u),e.push(d),e.push(c)}return e}toCubicBezierSVGString(t){var e=this.toCubicBezierData(t);if(0==e.length)return"";for(var s=["M "+e[0].x+" "+e[0].y],i=1;i<e.length;i+=3)s.push("C "+e[i].x+" "+e[i].y+", "+e[i+1].x+" "+e[i+1].y+", "+e[i+2].x+" "+e[i+2].y);return s.join(" ")}toCubicBezierPath(t){for(var e=this.toCubicBezierData(t),s=[],i=0;i+3<e.length;i+=3)s.push([e[i],e[i+3],e[i+1],e[i+2]]);return d.fromArray(s)}destroy(){for(var t=0;t<this.vertices.length;t++)this.vertices[t].destroy();this.isDestroyed=!0}}o.utils={area(t){let e=0;for(var s=0,i=t.length;s<i;s++){e+=t[s].x*t[(s+1)%i].y*.5,e-=t[(s+1)%i].x*t[s].y*.5}return Math.abs(e)},signedArea(t){let e=0;const s=t.length;for(var i=0;i<s;i++){const r=(i+1)%s;e+=(t[r].x-t[i].x)*(t[i].y+t[r].y)}return e}};class h{constructor(t,e){this.min=t,this.max=e,this.width=e.x-t.x,this.height=e.y-t.y}toPolygon(){return new o([new a(this.min),new a(this.max.x,this.min.y),new a(this.max),new a(this.min.x,this.max.y)],!1)}getCenter(){return new a(this.min.x+(this.max.x-this.min.x)/2,this.min.y+(this.max.y-this.min.y)/2)}toString(){return`{ min: ${this.min.toString()}, max : ${this.max.toString()}, width: ${this.width}, height : ${this.height} }`}clone(){return new h({x:this.min.x,y:this.min.y},{x:this.max.x,y:this.max.y})}static computeFromVertices(t){if(0==t.length)return new h(new a(0,0),new a(0,0));let e,s=t[0].x,i=t[0].x,r=t[0].y,n=t[0].y;for(var o in t)e=t[o],s=Math.min(s,e.x),i=Math.max(i,e.x),r=Math.min(r,e.y),n=Math.max(n,e.y);return new h(new a(s,r),new a(i,n))}static fromDimension(t,e,s){return new h(null!=s?s:{x:0,y:0},{x:(s?s.x:0)+t,y:(s?s.y:0)+e})}}class l{constructor(t,e,s){this.uid=i.next(),this.a=t,this.b=e,this.factory=s}length(){return Math.sqrt(Math.pow(this.b.x-this.a.x,2)+Math.pow(this.b.y-this.a.y,2))}setLength(t){return this.scale(t/this.length())}sub(t){return this.a.sub(t),this.b.sub(t),this}add(t){return this.a.add(t),this.b.add(t),this}normalize(){return this.b.set(this.a.x+(this.b.x-this.a.x)/this.length(),this.a.y+(this.b.y-this.a.y)/this.length()),this}scale(t){return this.b.set(this.a.x+(this.b.x-this.a.x)*t,this.a.y+(this.b.y-this.a.y)*t),this}moveTo(t){let e=this.a.difference(t);return this.a.add(e),this.b.add(e),this}angle(t){null!=t&&void 0!==t||(t=this.factory(new a(0,0),new a(100,0)));const e=this.b.clone().sub(this.a),s=t.b.clone().sub(t.a);return Math.atan2(s.x,s.y)-Math.atan2(e.x,e.y)}vertAt(t){return new a(this.a.x+(this.b.x-this.a.x)*t,this.a.y+(this.b.y-this.a.y)*t)}denominator(t){return(t.b.y-t.a.y)*(this.b.x-this.a.x)-(t.b.x-t.a.x)*(this.b.y-this.a.y)}colinear(t){return Math.abs(this.denominator(t))<a.EPSILON}getClosestT(t){var e=l.vtutils.dist2(this.a,this.b);return 0===e?0:((t.x-this.a.x)*(this.b.x-this.a.x)+(t.y-this.a.y)*(this.b.y-this.a.y))/e}hasPoint(t,e){const s=this.getClosestT(t);if(void 0!==e&&e){return Math.sqrt(l.vtutils.dist2(t,this.vertAt(s)))<a.EPSILON&&s>=0&&s<=1}return s>=0&&s<=1}getClosestPoint(t){var e=this.getClosestT(t);return this.vertAt(e)}pointDistance(t){return Math.sqrt(l.vtutils.dist2(t,this.vertAt(this.getClosestT(t))))}clone(){return this.factory(this.a.clone(),this.b.clone())}toString(){return"{ a : "+this.a.toString()+", b : "+this.b.toString()+" }"}destroy(){this.a.destroy(),this.b.destroy(),this.isDestroyed=!0}}l.vtutils={dist2:(t,e)=>(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)};class c extends l{constructor(t,e){super(t,e,((t,e)=>new c(t,e))),this.className="Vector"}perp(){var t=this.clone();return t.sub(this.a),(t=new c(new a,new a(-t.b.y,t.b.x))).a.add(this.a),t.b.add(this.a),t}inverse(){var t=this.a;return this.a=this.b,this.b=t,this}inv(){return this.b.x=this.a.x-(this.b.x-this.a.x),this.b.y=this.a.y-(this.b.y-this.a.y),this}intersection(t){var e=this.denominator(t);if(0==e)return null;var s=this.a.y-t.a.y,i=this.a.x-t.a.x,r=(t.b.x-t.a.x)*s-(t.b.y-t.a.y)*i,n=(this.b.x-this.a.x)*s-(this.b.y-this.a.y)*i;return s=r/e,i=n/e,new a(this.a.x+s*(this.b.x-this.a.x),this.a.y+s*(this.b.y-this.a.y))}getOrthogonal(){const t=this.a.clone(),e=this.b.clone().sub(this.a),s=e.x;return e.x=-e.y,e.y=s,new c(t,e.add(this.a))}}c.utils={buildArrowHead:(t,e,s,i,r)=>{const n=Math.atan2((e.y-t.y)*r,(e.x-t.x)*i),o=[];return o.push(new a(e.x*i-s*Math.cos(n),e.y*r-s*Math.sin(n))),o.push(new a(e.x*i-1.35*s*Math.cos(n-Math.PI/8),e.y*r-1.35*s*Math.sin(n-Math.PI/8))),o.push(new a(e.x*i,e.y*r)),o.push(new a(e.x*i-1.35*s*Math.cos(n+Math.PI/8),e.y*r-1.35*s*Math.sin(n+Math.PI/8))),o}};class u{constructor(t,e,s,r){this.START_POINT=u.START_POINT,this.START_CONTROL_POINT=u.START_CONTROL_POINT,this.END_CONTROL_POINT=u.END_CONTROL_POINT,this.END_POINT=u.END_POINT,this.uid=i.next(),this.startPoint=t,this.startControlPoint=s,this.endPoint=e,this.endControlPoint=r,this.curveIntervals=30,this.segmentCache=[],this.segmentLengths=[],this.updateArcLengths()}moveCurvePoint(t,e,s,i){t==this.START_POINT?(this.getStartPoint().add(e),s&&this.getStartControlPoint().add(e)):t==this.START_CONTROL_POINT?this.getStartControlPoint().add(e):t==this.END_CONTROL_POINT?this.getEndControlPoint().add(e):t==this.END_POINT?(this.getEndPoint().add(e),s&&this.getEndControlPoint().add(e)):console.log(`[CubicBezierCurve.moveCurvePoint] pointID '${t}' invalid.`),i&&this.updateArcLengths()}translate(t){return this.startPoint.add(t),this.startControlPoint.add(t),this.endControlPoint.add(t),this.endPoint.add(t),this}reverse(){let t=this.startPoint;return this.startPoint=this.endPoint,this.endPoint=t,t=this.startControlPoint,this.startControlPoint=this.endControlPoint,this.endControlPoint=t,this}getLength(){return this.arcLength}updateArcLengths(){let t=this.startPoint.clone(),e=new a(0,0),s=1/this.curveIntervals;this.segmentCache=[],this.segmentCache.push(this.startPoint),this.segmentLengths=[];let i=0;var r=0;let n;for(;r<=1;)e=this.getPointAt(r),this.segmentCache.push(e),n=t.distance(e),this.segmentLengths.push(n),i+=n,t=e,r+=s;this.arcLength=i}getClosestT(t){var e={t:0,tPrev:0,tNext:1},s=0;do{e=this.locateIntervalByDistance(t,e.tPrev,e.tNext,this.curveIntervals),s++}while(s<4&&this.getPointAt(e.tPrev).distance(this.getPointAt(e.tNext))>1);return e.t}locateIntervalByDistance(t,e,s,i){var r=-1,n=0,a=0;const o=s-e;for(var h=0;h<=i;h++){a=e+o*(h/i);var l=this.getPointAt(a).distance(t);(-1==r||l<n)&&(r=h,n=l)}return{t:e+o*(r/i),tPrev:e+o*(Math.max(0,r-1)/i),tNext:e+o*(Math.min(i,r+1)/i)}}getBounds(){var t=new a(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),e=new a(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);let s;for(var i=0;i<this.segmentCache.length;i++)s=this.segmentCache[i],t.x=Math.min(t.x,s.x),t.y=Math.min(t.y,s.y),e.x=Math.max(e.x,s.x),e.y=Math.max(e.y,s.y);return new h(t,e)}getStartPoint(){return this.startPoint}getEndPoint(){return this.endPoint}getStartControlPoint(){return this.startControlPoint}getEndControlPoint(){return this.endControlPoint}getPointByID(t){if(t==this.START_POINT)return this.startPoint;if(t==this.END_POINT)return this.endPoint;if(t==this.START_CONTROL_POINT)return this.startControlPoint;if(t==this.END_CONTROL_POINT)return this.endControlPoint;throw new Error(`Invalid point ID '${t}'.`)}getPointAt(t){const e=this.startPoint.x*Math.pow(1-t,3)+3*this.startControlPoint.x*t*Math.pow(1-t,2)+3*this.endControlPoint.x*Math.pow(t,2)*(1-t)+this.endPoint.x*Math.pow(t,3),s=this.startPoint.y*Math.pow(1-t,3)+3*this.startControlPoint.y*t*Math.pow(1-t,2)+3*this.endControlPoint.y*Math.pow(t,2)*(1-t)+this.endPoint.y*Math.pow(t,3);return new a(e,s)}getPoint(t){return this.getPointAt(t/this.arcLength)}getTangentAt(t){const e=this.getStartPoint(),s=this.getStartControlPoint(),i=this.getEndControlPoint(),r=this.getEndPoint(),n=t*t,o=1-2*t+n,h=-3*e.x*o+s.x*(3*o-6*(t-n))+i.x*(6*(t-n)-3*n)+3*r.x*n,l=-3*e.y*o+s.y*(3*o-6*(t-n))+i.y*(6*(t-n)-3*n)+3*r.y*n;return new a(h,l)}getSubCurveAt(t,e){const s=new c(this.getPointAt(t),this.getTangentAt(t)),i=new c(this.getPointAt(e),this.getTangentAt(e).inv());return s.b.add(s.a),i.b.add(i.a),s.scale(.33333333*(e-t)),i.scale(.33333333*(e-t)),new u(s.a,i.a,s.b,i.b)}convertU2T(t){return Math.max(0,Math.min(1,t/this.arcLength))}getTangent(t){return this.getTangentAt(this.convertU2T(t))}getPerpendicular(t){return this.getPerpendicularAt(this.convertU2T(t))}getPerpendicularAt(t){const e=this.getTangentAt(t);return new a(e.y,-e.x)}clone(){return new u(this.getStartPoint().clone(),this.getEndPoint().clone(),this.getStartControlPoint().clone(),this.getEndControlPoint().clone())}getStartTangent(){return this.startControlPoint}getEndTangent(){return this.endControlPoint}equals(t){return!!t&&(!!(t.startPoint&&t.endPoint&&t.startControlPoint&&t.endControlPoint)&&(this.startPoint.equals(t.startPoint)&&this.endPoint.equals(t.endPoint)&&this.startControlPoint.equals(t.startControlPoint)&&this.endControlPoint.equals(t.endControlPoint)))}destroy(){this.startPoint.destroy(),this.endPoint.destroy(),this.startControlPoint.destroy(),this.endControlPoint.destroy(),this.isDestroyed=!0}static isInstance(t){return t instanceof u}toJSON(t){return"{ "+(t?"\n\t":"")+'"startPoint" : ['+this.getStartPoint().x+","+this.getStartPoint().y+"], "+(t?"\n\t":"")+'"endPoint" : ['+this.getEndPoint().x+","+this.getEndPoint().y+"], "+(t?"\n\t":"")+'"startControlPoint": ['+this.getStartControlPoint().x+","+this.getStartControlPoint().y+"], "+(t?"\n\t":"")+'"endControlPoint" : ['+this.getEndControlPoint().x+","+this.getEndControlPoint().y+"]"+(t?"\n\t":"")+" }"}static fromJSON(t){var e=JSON.parse(t);return u.fromObject(e)}static fromObject(t){if("object"!=typeof t)throw"Can only build from object.";if(!t.startPoint)throw'Object member "startPoint" missing.';if(!t.endPoint)throw'Object member "endPoint" missing.';if(!t.startControlPoint)throw'Object member "startControlPoint" missing.';if(!t.endControlPoint)throw'Object member "endControlPoint" missing.';return new u(new a(t.startPoint[0],t.startPoint[1]),new a(t.endPoint[0],t.endPoint[1]),new a(t.startControlPoint[0],t.startControlPoint[1]),new a(t.endControlPoint[0],t.endControlPoint[1]))}static fromArray(t){if(!Array.isArray(t))throw"Can only build from object.";if(4!=t.length)throw"Can only build from array with four elements.";return new u(t[0],t[1],t[2],t[3])}}u.START_POINT=0,u.START_CONTROL_POINT=1,u.END_CONTROL_POINT=2,u.END_POINT=3;class d{constructor(t){this.className="BezierPath",this.START_POINT=0,this.START_CONTROL_POINT=1,this.END_CONTROL_POINT=2,this.END_POINT=3,this.uid=i.next(),t||(t=[]),this.totalArcLength=0,this.adjustCircular=!1,this.bezierCurves=[]}addCurve(t){if(null==t||void 0===t)throw"Cannot add null curve to bézier path.";this.bezierCurves.push(t),this.bezierCurves.length>1?(t.startPoint=this.bezierCurves[this.bezierCurves.length-2].endPoint,this.adjustSuccessorControlPoint(this.bezierCurves.length-2,!0,!0)):this.totalArcLength+=t.getLength()}locateCurveByStartPoint(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].startPoint.equals(t))return e;return-1}locateCurveByEndPoint(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].endPoint.equals(t))return e;return-1}locateCurveByStartControlPoint(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].startControlPoint.equals(t))return e;return-1}locateCurveByEndControlPoint(t){for(var e=0;e<this.bezierCurves.length;e++)if(this.bezierCurves[e].endControlPoint.equals(t))return e;return-1}getLength(){return this.totalArcLength}updateArcLengths(){this.totalArcLength=0;for(var t=0;t<this.bezierCurves.length;t++)this.bezierCurves[t].updateArcLengths(),this.totalArcLength+=this.bezierCurves[t].getLength()}getCurveCount(){return this.bezierCurves.length}getCurveAt(t){return this.bezierCurves[t]}translate(t){for(var e=0;e<this.bezierCurves.length;e++){(s=this.bezierCurves[e]).getStartPoint().add(t),s.getStartControlPoint().add(t),s.getEndControlPoint().add(t)}var s;return(s=this.bezierCurves[this.bezierCurves.length-1]).getEndPoint().add(t),this.updateArcLengths(),this}scale(t,e){return this.scaleXY({x:e,y:e},t)}scaleXY(t,e){for(var s=0;s<this.bezierCurves.length;s++){var i=this.bezierCurves[s];i.getStartPoint().scaleXY(t,e),i.getStartControlPoint().scaleXY(t,e),i.getEndControlPoint().scaleXY(t,e)}return this.bezierCurves.length>0&&!this.adjustCircular&&this.bezierCurves[this.bezierCurves.length-1].getEndPoint().scaleXY(t,e),this.updateArcLengths(),this}rotate(t,e){for(var s=0;s<this.bezierCurves.length;s++){var i=this.bezierCurves[s];i.getStartPoint().rotate(t,e),i.getStartControlPoint().rotate(t,e),i.getEndControlPoint().rotate(t,e)}this.bezierCurves.length>0&&!this.adjustCircular&&this.bezierCurves[this.bezierCurves.length-1].getEndPoint().rotate(t,e)}getClosestT(t){for(var e=-1,s=0,i=0,r=0,n=0,a=0,o=0;o<this.bezierCurves.length;o++)r=this.bezierCurves[o].getClosestT(t),i=this.bezierCurves[o].getPointAt(r).distance(t),(-1==e||i<s)&&(e=o,s=i,n=a+r*this.bezierCurves[o].getLength()),a+=this.bezierCurves[o].getLength();return Math.max(0,Math.min(1,n/this.totalArcLength))}getPoint(t){(t<0||t>this.totalArcLength)&&(console.warn("[BezierPath.getPoint(u)] u is out of bounds: "+t+"."),t=Math.min(this.totalArcLength,Math.max(t,0)));for(var e=0,s=0;e<this.bezierCurves.length&&s+this.bezierCurves[e].getLength()<t;)s+=this.bezierCurves[e].getLength(),e++;if(e>=this.bezierCurves.length)return this.bezierCurves[this.bezierCurves.length-1].getEndPoint().clone();var i=t-s;return this.bezierCurves[e].getPoint(i)}getPointAt(t){return this.getPoint(t*this.totalArcLength)}getTangentAt(t){return this.getTangent(t*this.totalArcLength)}getTangent(t){(t<0||t>this.totalArcLength)&&(console.warn("[BezierPath.getTangent(u)] u is out of bounds: "+t+"."),t=Math.min(this.totalArcLength,Math.max(0,t)));for(var e=0,s=0;e<this.bezierCurves.length&&s+this.bezierCurves[e].getLength()<t;)s+=this.bezierCurves[e].getLength(),e++;var i=t-s;return this.bezierCurves[e].getTangent(i)}getPerpendicularAt(t){return this.getPerpendicular(t*this.totalArcLength)}getPerpendicular(t){(t<0||t>this.totalArcLength)&&(console.log("[BezierPath.getPerpendicular(u)] u is out of bounds: "+t+"."),t=Math.min(this.totalArcLength,Math.max(0,t)));var e=d._locateUIndex(this,t),s=this.bezierCurves[e.i],i=t-e.uPart;return s.getPerpendicular(i)}static _locateUIndex(t,e){for(var s=0,i=0,r=0;s<t.bezierCurves.length&&i+t.bezierCurves[s].getLength()<e;)i+=t.bezierCurves[s].getLength(),s+1<t.bezierCurves.length&&(r+=t.bezierCurves[s].getLength()),s++;return{i:s,uPart:i,uBefore:r}}getSubPathAt(t,e){t=Math.max(0,t),e=Math.min(1,e);let s=t*this.totalArcLength,i=e*this.totalArcLength;var r=d._locateUIndex(this,s),n=d._locateUIndex(this,i),a=(s-r.uBefore)/this.bezierCurves[r.i].getLength();if(r.i==n.i){var o=(i-n.uBefore)/this.bezierCurves[n.i].getLength(),h=this.bezierCurves[r.i].getSubCurveAt(a,o);return d.fromArray([h])}var l=[];if(r.i>n.i){h=this.bezierCurves[r.i].getSubCurveAt(a,0);l.push(h);for(var c=r.i-1;c>n.i;c--)l.push(this.bezierCurves[c].clone().reverse());o=(i-n.uBefore)/this.bezierCurves[n.i].getLength();l.push(this.bezierCurves[n.i].getSubCurveAt(1,o))}else{h=this.bezierCurves[r.i].getSubCurveAt(a,1);l.push(h);for(c=r.i+1;c<n.i&&c<this.bezierCurves.length;c++)l.push(this.bezierCurves[c].clone());o=(i-n.uBefore)/this.bezierCurves[n.i].getLength();l.push(this.bezierCurves[n.i].getSubCurveAt(0,o))}return d.fromArray(l)}moveCurvePoint(t,e,s){if(this.getCurveAt(t).moveCurvePoint(e,s,!0,!0),e==this.START_POINT&&(t>0||this.adjustCircular))this.getCurveAt(t-1<0?this.bezierCurves.length+(t-1):t-1).moveCurvePoint(this.END_CONTROL_POINT,s,!0,!1);else if(e==this.END_POINT&&(t+1<this.bezierCurves.length||this.adjustCircular)){this.getCurveAt((t+1)%this.bezierCurves.length).moveCurvePoint(this.START_CONTROL_POINT,s,!0,!1)}else e==this.START_CONTROL_POINT&&t>0?this.adjustPredecessorControlPoint(t,!0,!1):e==this.END_CONTROL_POINT&&t+1<this.getCurveCount()&&this.adjustSuccessorControlPoint(t,!0,!1);this.updateArcLengths()}adjustPredecessorControlPoint(t,e,s){if(this.adjustCircular||!(t<=0)){var i=this.getCurveAt(t),r=this.getCurveAt(t-1<0?this.getCurveCount()+(t-1):t-1);d.adjustNeighbourControlPoint(i,r,i.getStartPoint(),i.getStartControlPoint(),r.getEndPoint(),r.getEndControlPoint(),e,s)}}adjustSuccessorControlPoint(t,e,s){if(this.adjustCircular||!(t+1>this.getCurveCount())){var i=this.getCurveAt(t),r=this.getCurveAt((t+1)%this.getCurveCount());d.adjustNeighbourControlPoint(i,r,i.getEndPoint(),i.getEndControlPoint(),r.getStartPoint(),r.getStartControlPoint(),e,s)}}static adjustNeighbourControlPoint(t,e,s,i,r,n,o,h){var l=new a(i.x-s.x,i.y-s.y),c=new a(n.x-r.x,n.y-r.y),u=Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2)),d=Math.sqrt(Math.pow(c.x,2)+Math.pow(c.y,2));u<=.1||(o?n.set(r.x-l.x*(d/u),r.y-l.y*(d/u)):n.set(r.x-l.x,r.y-l.y),e.updateArcLengths())}getBounds(){const t=new a(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),e=new a(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var s,i=0;i<this.bezierCurves.length;i++)s=this.bezierCurves[i].getBounds(),t.x=Math.min(t.x,s.min.x),t.y=Math.min(t.y,s.min.y),e.x=Math.max(e.x,s.max.x),e.y=Math.max(e.y,s.max.y);return new h(t,e)}getEvenDistributionVertices(t){if(t<2)throw new Error("pointCount must be larger than one; is "+t+".");const e=[];if(0===this.bezierCurves.length)return e;var s=new a(this.bezierCurves[0].startPoint);e.push(s);const i=this.totalArcLength/(t-1),r=this.bezierCurves.length;let n=0,o=this.bezierCurves[0].arcLength,h=i,l=1;for(;l<t&&n<r;)if(h<o){var c=this.bezierCurves[n].getPoint(h);e.push(c),h+=i,l++}else n++,h-=o,o=n<r?this.bezierCurves[n].arcLength:0;return e.push(new a(this.bezierCurves[r-1].endPoint)),e}clone(){for(var t=new d(void 0),e=0;e<this.bezierCurves.length;e++)t.bezierCurves.push(this.bezierCurves[e].clone()),e>0&&(t.bezierCurves[e-1].endPoint=t.bezierCurves[e].startPoint);return t.updateArcLengths(),t.adjustCircular=this.adjustCircular,t}equals(t){if(!t)return!1;if(!t.bezierCurves)return!1;if(void 0===t.bezierCurves.length)return!1;if(t.bezierCurves.length!=this.bezierCurves.length)return!1;for(var e=0;e<this.bezierCurves.length;e++)if(!this.bezierCurves[e].equals(t.bezierCurves[e]))return!1;return!0}destroy(){for(var t=0;t<this.bezierCurves.length;t++)this.bezierCurves[t].destroy();this.isDestroyed=!0}toJSON(t){var e=[];e.push("[");for(var s=0;s<this.bezierCurves.length;s++)s>0&&e.push(","),t?e.push("\n\t"):e.push(" "),e.push(this.bezierCurves[s].toJSON(t));return 0!=this.bezierCurves.length&&e.push(" "),e.push("]"),e.join("")}static fromJSON(t){var e=JSON.parse(t);return d.fromArray(e)}static fromArray(t){if(!Array.isArray(t))throw"[BezierPath.fromArray] Passed object must be an array.";const e=t;if(e.length<1)throw"[BezierPath.fromArray] Passed array must contain at least one bezier curve (has "+e.length+").";for(var s=new d(void 0),i=null,r=0;r<e.length;r++){var n;if(u.isInstance(e[r]))n=e[r].clone();else if(0 in e[r]&&1 in e[r]&&2 in e[r]&&3 in e[r]){if(!(e[r][0]&&e[r][1]&&e[r][2]&&e[r][3]))throw"Cannot convert path data to BezierPath instance. At least one element is undefined (index="+r+"): "+e[r];n=u.fromArray(e[r])}else n=u.fromObject(e[r]);i&&(n.startPoint=i.endPoint),s.bezierCurves.push(n),i=n}return s.updateArcLengths(),s}toReducedListRepresentation(t){void 0===t&&(t=1);var e=[];e.push("[");for(var s=0;s<this.bezierCurves.length;s++){var i=this.bezierCurves[s];e.push(i.getStartPoint().x.toFixed(t)),e.push(","),e.push(i.getStartPoint().y.toFixed(t)),e.push(","),e.push(i.getStartControlPoint().x.toFixed(t)),e.push(","),e.push(i.getStartControlPoint().y.toFixed(t)),e.push(","),e.push(i.getEndControlPoint().x.toFixed(t)),e.push(","),e.push(i.getEndControlPoint().y.toFixed(t)),e.push(",")}if(0!=this.bezierCurves.length){i=this.bezierCurves[this.bezierCurves.length-1];e.push(i.getEndPoint().x.toFixed(t)),e.push(","),e.push(i.getEndPoint().y.toFixed(t))}return e.push("]"),e.join("")}static fromReducedListRepresentation(t,e){var s=JSON.parse(t);if(!s.length)throw console.log("Cannot parse bezier path from non-array object nor from empty point list."),"Cannot parse bezier path from non-array object nor from empty point list.";if(s.length<8)throw console.log("Cannot build bezier path. The passed array must contain at least 8 elements (numbers)."),"Cannot build bezier path. The passed array must contain at least 8 elements (numbers).";return d.fromReducedList(s,e)}static fromReducedList(t,e){var s,i,r,n=new d(null),o=new a,h=0;do{0==h&&(o=new a(t[h],t[h+1])),s=new a(t[h+2],t[h+3]),i=new a(t[h+4],t[h+5]),r=new a(t[h+6],t[h+7]);var l=new u(o,r,s,i);n.bezierCurves.push(l),o=r,h+=6}while(h+2<t.length);return n.adjustCircular=null!=e&&e,e&&(n.bezierCurves[n.bezierCurves.length-1].endPoint=n.bezierCurves[0].startPoint),n.updateArcLengths(),n}}d.START_POINT=0,d.START_CONTROL_POINT=1,d.END_CONTROL_POINT=2,d.END_POINT=3;class f extends l{constructor(t,e){super(t,e,((t,e)=>new f(t,e))),this.className="Line"}intersection(t){const e=this.denominator(t);if(0==e)return null;let s=this.a.y-t.a.y,i=this.a.x-t.a.x;const r=(t.b.x-t.a.x)*s-(t.b.y-t.a.y)*i,n=(this.b.x-this.a.x)*s-(this.b.y-this.a.y)*i;s=r/e,i=n/e;const o=this.a.x+s*(this.b.x-this.a.x),h=this.a.y+s*(this.b.y-this.a.y);return isNaN(s)||isNaN(o)||isNaN(h)?null:new a(o,h)}getStartPoint(){return this.a}getEndPoint(){return this.b}getStartTangent(){return this.b}getEndTangent(){return this.a}reverse(){var t=this.a;return this.a=this.b,this.b=t,this}}class g{constructor(t,e){this.className="Circle",this.uid=i.next(),this.center=t,this.radius=e}containsPoint(t){return this.center.distance(t)<this.radius}containsCircle(t){return this.center.distance(t.center)+t.radius<this.radius}lineDistance(t){return t.getClosestPoint(this.center).distance(this.center)-this.radius}vertAt(t){return g.circleUtils.vertAt(t,this.radius).add(this.center)}tangentAt(t){const e=g.circleUtils.vertAt(t,this.radius);return new c(e,new a(0,0)).add(this.center).perp()}circleIntersection(t){if(this.center.distance(t.center)>this.radius+t.radius)return null;if(this.center.distance(t.center)<Math.abs(this.radius-t.radius))return null;var e=this.center,s=t.center,i=e.distance(s),r=(this.radius*this.radius-t.radius*t.radius+i*i)/(2*i),n=Math.sqrt(this.radius*this.radius-r*r),o=s.clone().scale(r/i,e),h=o.x+n*(s.y-e.y)/i,l=o.y-n*(s.x-e.x)/i,c=o.x-n*(s.y-e.y)/i,u=o.y+n*(s.x-e.x)/i;return new f(new a(h,l),new a(c,u))}lineIntersection(t,e){const s=new a,i=new a,r=new a(t).sub(this.center),n=new a(e).sub(this.center),o=r.difference(n);0===Math.abs(o.y)&&(o.y=1e-6);const h=r.distance(n),l=r.x*n.y-r.y*n.x,c=h*h;if(this.radius*this.radius*c-l*l<0)return null;const u=this.radius*this.radius*h*h-l*l,d=Math.sqrt(u);return s.x=(l*o.y+Math.sign(o.y)*o.x*d)/c,i.x=(l*o.y-Math.sign(o.y)*o.x*d)/c,s.y=(-l*o.x+Math.abs(o.y)*d)/c,i.y=(-l*o.x-Math.abs(o.y)*d)/c,new f(s.add(this.center),i.add(this.center))}closestPoint(t){const e=this.lineIntersection(this.center,t);return e?e.a.distance(t)<e.b.distance(t)?e.a:e.b:new a}destroy(){this.center.destroy(),this.isDestroyed=!0}}g.circleUtils={vertAt:(t,e)=>new a(Math.cos(t)*e,Math.sin(t)*e)};class p{constructor(t,e,s){this.className="CircleSector",this.uid=i.next(),this.circle=t,this.startAngle=e,this.endAngle=s}destroy(){this.circle.destroy(),this.isDestroyed=!0}}p.circleSectorUtils={polarToCartesian:(t,e,s,i)=>({x:t+s*Math.cos(i),y:e+s*Math.sin(i)}),describeSVGArc:(t,e,s,i,r,n)=>{void 0===n&&(n={moveToStart:!0});const a=p.circleSectorUtils.polarToCartesian(t,e,s,r),o=p.circleSectorUtils.polarToCartesian(t,e,s,i);if(2*Math.PI-Math.abs(i-r)<.001){const a=p.circleSectorUtils.describeSVGArc(t,e,s,i,i+(r-i)/2,n),o=p.circleSectorUtils.describeSVGArc(t,e,s,i+(r-i)/2,r,n);return a.concat(o)}const h=r-i;var l,c;h<0?(l=Math.abs(h)<Math.PI?1:0,c=1):(l=Math.abs(h)>Math.PI?1:0,c=1);const u=[];return n.moveToStart&&u.push("M",o.x,o.y),u.push("A",s,s,0,l,c,a.x,a.y),u}};const y=180/Math.PI;class v{constructor(t,e,s,i,r,n,o,h,l,c,u){this.svgNode=t,this.offset=new a(0,0).set(e),this.scale=new a(1,1).set(s),this.fillShapes=r,this.isSecondary=Boolean(o),this.drawlibConfiguration={},this.cache=new Map,this.setSize(i),o?(this.gNode=h,this.bufferGNode=l,this.nodeDefs=c,this.bufferedNodeDefs=u):(this.addStyleDefs(n),this.addDefsNode(),this.gNode=this.createSVGNode("g"),this.bufferGNode=this.createSVGNode("g"),this.svgNode.appendChild(this.gNode))}addStyleDefs(t){this.nodeStyle=this.createSVGNode("style"),this.svgNode.appendChild(this.nodeStyle);const e={bezierPath:"BezierPath",polygon:"Polygon",triangle:"Triangle",ellipse:"Ellipse",ellipseSector:"EllipseSector",circle:"Circle",circleSector:"CircleSector",vertex:"Vertex",line:"Line",vector:"Vector",image:"Image",text:"Text"},s=[];for(var i in e){const r=e[i],n=t[i];n?s.push(`.${r} { fill : none; stroke: ${n.color}; stroke-width: ${n.lineWidth}px }`):console.warn(`Warning: your draw config is missing the key '${i}' which is required.`)}this.nodeStyle.innerHTML=s.join("\n")}addDefsNode(){this.nodeDefs=this.createSVGNode("defs"),this.bufferedNodeDefs=this.createSVGNode("defs"),this.svgNode.appendChild(this.nodeDefs)}addCustomStyleDefs(t){const e=[];t.forEach(((t,s)=>{e.push(s+" { "+t+" }")})),this.nodeStyle.innerHTML+="\n/* Custom styles */\n"+e.join("\n")}findElement(t,e){if(!t)return null;var s=this.cache.get(t);return s&&s.nodeName.toUpperCase()===e.toUpperCase()?(this.cache.delete(t),s):null}createSVGNode(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}makeNode(t){var e=this.findElement(this.curId,t);return e||(e=this.createSVGNode(t)),this.drawlibConfiguration.blendMode&&(e.style["mix-blend-mode"]=this.drawlibConfiguration.blendMode),e}_bindFillDraw(t,e,s,i){return this.curClassName?t.setAttribute("class",`${e} ${this.curClassName}`):t.setAttribute("class",e),t.setAttribute("fill",this.fillShapes&&s?s:"none"),t.setAttribute("stroke",this.fillShapes?"none":s||"none"),t.setAttribute("stroke-width",`${i||1}`),this.curId&&t.setAttribute("id",`${this.curId}`),t.parentNode||this.bufferGNode.appendChild(t),t}setSize(t){this.canvasSize=t,this.svgNode.setAttribute("viewBox",`0 0 ${this.canvasSize.width} ${this.canvasSize.height}`),this.svgNode.setAttribute("width",`${this.canvasSize.width}`),this.svgNode.setAttribute("height",`${this.canvasSize.height}`)}copyInstance(t){return new v(this.svgNode,this.offset,this.scale,this.canvasSize,t,null,!0,this.gNode,this.bufferGNode,this.nodeDefs,this.bufferedNodeDefs)}setConfiguration(t){this.drawlibConfiguration=t}setCurrentId(t){this.curId=t}setCurrentClassName(t){this.curClassName=t}beginDrawCycle(t){this.cache.clear();for(var e=0;e<this.bufferGNode.childNodes.length;e++){var s=this.bufferGNode.childNodes[e];this.cache.set(s.getAttribute("id"),s)}this.removeAllChildNodes()}endDrawCycle(t){this.isSecondary||(this.svgNode.replaceChild(this.bufferedNodeDefs,this.nodeDefs),this.svgNode.replaceChild(this.bufferGNode,this.gNode));const e=this.gNode;this.gNode=this.bufferGNode,this.bufferGNode=e;const s=this.nodeDefs;this.nodeDefs=this.bufferedNodeDefs,this.bufferedNodeDefs=s}_x(t){return this.offset.x+this.scale.x*t}_y(t){return this.offset.y+this.scale.y*t}line(t,e,s,i){const r=this.makeNode("line");return r.setAttribute("x1",`${this._x(t.x)}`),r.setAttribute("y1",`${this._y(t.y)}`),r.setAttribute("x2",`${this._x(e.x)}`),r.setAttribute("y2",`${this._y(e.y)}`),this._bindFillDraw(r,"line",s,i||1)}arrow(t,e,s,i){const r=this.makeNode("path");var n=a.utils.buildArrowHead(t,e,8,this.scale.x,this.scale.y);const o=["M",this._x(t.x),this._y(t.y)];for(var h=0;h<=n.length;h++)o.push("L"),o.push(this.offset.x+n[h%n.length].x),o.push(this.offset.y+n[h%n.length].y);return r.setAttribute("d",o.join(" ")),this._bindFillDraw(r,"arrow",s,i||1)}image(t,e,s,i=1){const r=this.makeNode("image"),n=t=>{if(t.naturalWidth){const n=s.x/t.naturalWidth,a=s.y/t.naturalHeight;r.setAttribute("width",""+t.naturalWidth*this.scale.x),r.setAttribute("height",""+t.naturalHeight*this.scale.y),r.setAttribute("display",null),r.setAttribute("opacity",`${i}`),r.setAttribute("transform",`translate(${this._x(e.x)} ${this._y(e.y)}) scale(${n} ${a})`)}};return t.addEventListener("load",(e=>{n(t)})),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("display","none"),n(t),r.setAttribute("href",t.src),this._bindFillDraw(r,"image",null,null)}texturedPoly(t,e,s,r,n){s.getBounds();const o=new a(e.min).clone().rotate(n,r),h=(r.clone().add(o.difference(e.min).inv()),this.makeNode("clipPath")),l=`clippath_${i.next()}`;h.setAttribute("id",l);const c=this.makeNode("g"),u=this.makeNode("image");u.setAttribute("x",`${this._x(o.x)}`),u.setAttribute("y",`${this._y(o.y)}`),u.setAttribute("width",`${e.width}`),u.setAttribute("height",`${e.height}`),u.setAttribute("href",t.src),u.setAttribute("transform",`rotate(${n*y}, ${this._x(o.x)}, ${this._y(o.y)})`);const d=this.makeNode("path"),f=[];if(s.vertices.length>0){f.push("M",`${this._x(s.vertices[0].x)}`,`${this._y(s.vertices[0].y)}`);for(var g=1;g<s.vertices.length;g++)f.push("L",`${this._x(s.vertices[g].x)}`,`${this._y(s.vertices[g].y)}`)}d.setAttribute("d",f.join(" ")),h.appendChild(d),this.bufferedNodeDefs.appendChild(h),c.appendChild(u),c.setAttribute("transform-origin",`${this._x(o.x)} ${this._y(o.y)}`),c.setAttribute("transform",`scale(${this.scale.x}, ${this.scale.y})`);const p=this.makeNode("g");return p.appendChild(c),p.setAttribute("clip-path",`url(#${l})`),this._bindFillDraw(p,"image",null,null),p}cubicBezier(t,e,s,i,r,n){if(t instanceof u)return this.cubicBezier(t.startPoint,t.endPoint,t.startControlPoint,t.endControlPoint,r,n);const a=this.makeNode("path"),o=["M",this._x(t.x),this._y(t.y),"C",this._x(s.x),this._y(s.y),this._x(i.x),this._y(i.y),this._x(e.x),this._y(e.y)];return a.setAttribute("d",o.join(" ")),this._bindFillDraw(a,"cubicBezier",r,n)}cubicBezierPath(t,e,s){const i=this.makeNode("path");if(!t||0==t.length)return i;const r=["M",this._x(t[0].x),this._y(t[0].y)];for(var n,a,o,h=1;h<t.length;h+=3)a=t[h],o=t[h+1],n=t[h+2],r.push("C",this._x(a.x),this._y(a.y),this._x(o.x),this._y(o.y),this._x(n.x),this._y(n.y));return i.setAttribute("d",r.join(" ")),this._bindFillDraw(i,"cubicBezierPath",e,s||1)}handle(t,e){this.point(t,"rgb(0,32,192)"),this.square(e,5,"rgba(0,128,192,0.5)")}handleLine(t,e){this.line(t,e,"rgb(192,192,192)")}dot(t,e){const s=this.makeNode("line");return this._bindFillDraw(s,"dot",e,1)}point(t,e){const s=this.makeNode("circle");return s.setAttribute("cx",`${this._x(t.x)}`),s.setAttribute("cy",`${this._y(t.y)}`),s.setAttribute("r","3"),this._bindFillDraw(s,"point",e,1)}circle(t,e,s,i){const r=this.makeNode("circle");return r.setAttribute("cx",`${this._x(t.x)}`),r.setAttribute("cy",`${this._y(t.y)}`),r.setAttribute("r",""+e*this.scale.x),this._bindFillDraw(r,"circle",s,i||1)}circleArc(t,e,s,i,r,n){const a=this.makeNode("path"),o=p.circleSectorUtils.describeSVGArc(this._x(t.x),this._y(t.y),e*this.scale.x,s,i);return a.setAttribute("d",o.join(" ")),this._bindFillDraw(a,"circleArc",r,n||1)}ellipse(t,e,s,i,r,n){void 0===n&&(n=0);const a=this.makeNode("ellipse");return a.setAttribute("cx",`${this._x(t.x)}`),a.setAttribute("cy",`${this._y(t.y)}`),a.setAttribute("rx",""+e*this.scale.x),a.setAttribute("ry",""+s*this.scale.y),a.setAttribute("transform",`rotate(${180*n/Math.PI} ${this._x(t.x)} ${this._y(t.y)})`),this._bindFillDraw(a,"ellipse",i,r||1)}square(t,e,s,i){const r=this.makeNode("rectangle");return r.setAttribute("x",`${this._x(t.x-e/2)}`),r.setAttribute("y",`${this._y(t.y-e/2)}`),r.setAttribute("width",""+e*this.scale.x),r.setAttribute("height",""+e*this.scale.y),this._bindFillDraw(r,"square",s,i||1)}rect(t,e,s,i,r){const n=this.makeNode("rect");return n.setAttribute("x",`${this._x(t.x)}`),n.setAttribute("y",`${this._y(t.y)}`),n.setAttribute("width",""+e*this.scale.x),n.setAttribute("height",""+s*this.scale.y),this._bindFillDraw(n,"rect",i,r||1)}grid(t,e,s,i,r,n){const a=this.makeNode("path"),o=[];for(var h=-Math.ceil(.5*s/r)*r,l=s/2,c=-Math.ceil(.5*e/i)*i;c<e/2;c+=i)o.push("M",this._x(t.x+c),this._y(t.y+h)),o.push("L",this._x(t.x+c),this._y(t.y+l));for(var u=-Math.ceil(.5*e/i)*i,d=e/2,f=-Math.ceil(.5*s/r)*r;f<s/2;f+=r)o.push("M",this._x(t.x+u),this._y(t.y+f)),o.push("L",this._x(t.x+d),this._y(t.y+f));return a.setAttribute("d",o.join(" ")),this._bindFillDraw(a,"grid",n,1)}raster(t,e,s,i,r,n){const a=this.makeNode("path"),o=[];for(var h=-Math.ceil(.5*e/i)*i;h<e/2;h+=i)for(var l=-Math.ceil(.5*s/r)*r;l<s/2;l+=r)o.push("M",this._x(t.x+h)-4,this._y(t.y+l)),o.push("L",this._x(t.x+h)+4,this._y(t.y+l)),o.push("M",this._x(t.x+h),this._y(t.y+l)-4),o.push("L",this._x(t.x+h),this._y(t.y+l)+4);return a.setAttribute("d",o.join(" ")),this._bindFillDraw(a,"raster",n,1)}diamondHandle(t,e,s){const i=this.makeNode("path"),r=["M",this._x(t.x)-e/2,this._y(t.y),"L",this._x(t.x),this._y(t.y)-e/2,"L",this._x(t.x)+e/2,this._y(t.y),"L",this._x(t.x),this._y(t.y)+e/2,"Z"];return i.setAttribute("d",r.join(" ")),this._bindFillDraw(i,"diamondHandle",s,1)}squareHandle(t,e,s){const i=this.makeNode("rect");return i.setAttribute("x",""+(this._x(t.x)-e/2)),i.setAttribute("y",""+(this._y(t.y)-e/2)),i.setAttribute("width",`${e}`),i.setAttribute("height",`${e}`),this._bindFillDraw(i,"squareHandle",s,1)}circleHandle(t,e,s){e=e||3;const i=this.makeNode("circle");return i.setAttribute("cx",`${this._x(t.x)}`),i.setAttribute("cy",`${this._y(t.y)}`),i.setAttribute("r",`${e}`),this._bindFillDraw(i,"circleHandle",s,1)}crosshair(t,e,s,i){const r=this.makeNode("path"),n=["M",this._x(t.x)-e,this._y(t.y),"L",this._x(t.x)+e,this._y(t.y),"M",this._x(t.x),this._y(t.y)-e,"L",this._x(t.x),this._y(t.y)+e];return r.setAttribute("d",n.join(" ")),this._bindFillDraw(r,"crosshair",s,i||.5)}cross(t,e,s,i){const r=this.makeNode("path"),n=["M",this._x(t.x)-e,this._y(t.y)-e,"L",this._x(t.x)+e,this._y(t.y)+e,"M",this._x(t.x)-e,this._y(t.y)+e,"L",this._x(t.x)+e,this._y(t.y)-e];return r.setAttribute("d",n.join(" ")),this._bindFillDraw(r,"cross",s,i||1)}polygon(t,e,s){return this.polyline(t.vertices,t.isOpen,e,s)}polyline(t,e,s,i){const r=this.makeNode("path");if(0==t.length)return r;const n=["M",this._x(t[0].x),this._y(t[0].y)];for(var a=t.length,o=1;o<a;o++)n.push("L",this._x(t[o].x),this._y(t[o].y));return e||n.push("Z"),r.setAttribute("d",n.join(" ")),this._bindFillDraw(r,"polygon",s,i||1)}text(t,e,s,i){var r,n,a;const o=(i=i||{}).color||"black",h=(null!==(n=null!==(r=i.lineHeight)&&void 0!==r?r:i.fontSize)&&void 0!==n?n:0)*this.scale.x,l="left"===i.textAlign||"start"===i.textAlign?"start":"center"===i.textAlign?"middle":"right"===i.textAlign||"end"===i.textAlign?"end":"start",c=`${this._x(e)}px ${this._y(s)}px`,u=`translate(${this._x(e)} ${this._y(s)+h/2})`,d=i.rotation?`rotate(${i.rotation*y} 0 0)`:"",f=this.makeNode("g"),g=this.curId;this.curId=g+"_text";const p=this.makeNode("text");return f.appendChild(p),p.setAttribute("font-family",null!==(a=i.fontFamily)&&void 0!==a?a:""),p.setAttribute("font-size",i.fontSize?""+i.fontSize*this.scale.x:""),p.setAttribute("font-style",i.fontStyle?`${i.fontStyle}`:""),p.setAttribute("font-weight",i.fontWeight?`${i.fontWeight}`:""),p.setAttribute("text-anchor",l),p.setAttribute("transform-origin","0 0"),p.setAttribute("transform",d),f.setAttribute("transform-origin",c),f.setAttribute("transform",u),p.innerHTML=t,this.curId=g,this._bindFillDraw(f,"text",o,1)}label(t,e,s,i,r){const n=this.makeNode("text");return n.setAttribute("transform",`translate(${e},${s}), rotate(${(i||0)/Math.PI*180})`),n.setAttribute("font-family","Arial"),n.setAttribute("font-size","9pt"),n.setAttribute("font-style","normal"),n.setAttribute("font-weight","lighter"),n.innerHTML=t,this._bindFillDraw(n,"label",r||"black",null)}path(t,e,s,i){const r=this.makeNode("path"),n=i&&i.inplace?t:v.copyPathData(t);return v.transformPathData(n,this.offset,this.scale),r.setAttribute("d",n.join(" ")),this._bindFillDraw(r,"path",e,s)}clear(t){if(this.isSecondary)return;this.curId="background",this.curClassName=void 0;const e=this.makeNode("rect");e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("width",`${this.canvasSize.width}`),e.setAttribute("height",`${this.canvasSize.height}`),this._bindFillDraw(e,this.curId,null,null),e.setAttribute("fill",void 0===t?"none":t),this.curId=void 0}removeAllChildNodes(){for(;this.bufferGNode.lastChild;)this.bufferGNode.removeChild(this.bufferGNode.lastChild);for(;this.bufferedNodeDefs.lastChild;)this.bufferedNodeDefs.removeChild(this.bufferedNodeDefs.lastChild)}static createSvg(){return document.createElementNS("http://www.w3.org/2000/svg","svg")}static copyPathData(t){const e=new Array(t.length);for(var s=0,i=t.length;s<i;s++)e[s]=t[s];return e}static transformPathData(t,e,s){const i=i=>{t[i]=e.x+s.x*Number(t[i])},r=i=>{t[i]=e.y+s.y*Number(t[i])},n=e=>{t[e]=s.x*Number(t[e])},a=e=>{t[e]=s.y*Number(t[e])};for(var o=0,h={x:NaN,y:NaN},l=e=>{h.x=Number(t[e]),h.y=Number(t[e+1])};o<t.length;){switch(t[o]){case"M":case"L":case"T":i(o+1),r(o+2),l(o+1),o+=3;break;case"m":case"l":case"t":n(o+1),a(o+2),l(o+1),o+=3;break;case"H":i(o+1),h.x=Number(t[o+1]),o+=2;break;case"h":n(o+1),h.x=Number(t[o+1]),o+=2;break;case"V":r(o+1),h.y=Number(t[o+1]),o+=2;break;case"v":a(o+1),h.y=Number(t[o+1]),o+=2;break;case"C":i(o+1),r(o+2),i(o+3),r(o+4),i(o+5),r(o+6),l(o+5),o+=7;break;case"c":n(o+1),a(o+2),n(o+3),a(o+4),n(o+5),a(o+6),l(o+5),o+=7;break;case"S":case"Q":i(o+1),r(o+2),i(o+3),r(o+4),l(o+3),o+=5;break;case"s":case"q":n(o+1),a(o+2),n(o+3),a(o+4),l(o+3),o+=5;break;case"A":n(o+1),a(o+2),i(o+6),r(o+7),l(o+6),(s.x<0&&s.y>=0||s.x>=0&&s.y<0)&&(t[o+5]=t[o+5]?0:1),o+=8;break;case"a":n(o+1),a(o+2),n(o+6),a(o+7),l(o+6),o+=8;break;default:o++}}}}v.HEAD_XML=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" ','         "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">',""].join("\n");class m{constructor(t,e){this.ctx=t,this.offset=new a(0,0),this.scale=new a(1,1),this.fillShapes=e}beginDrawCycle(t){}endDrawCycle(t){}setConfiguration(t){this.ctx.globalCompositeOperation=t.blendMode||"source-over"}setCurrentId(t){}setCurrentClassName(t){}line(t,e,s,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.strokeStyle=s,this.ctx.lineWidth=i||1,this.ctx.stroke(),this.ctx.restore()}arrow(t,e,s,i){this.ctx.save(),this.ctx.beginPath();var r=a.utils.buildArrowHead(t,e,8,this.scale.x,this.scale.y);this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y);for(var n=0;n<r.length;n++)this.ctx.lineTo(this.offset.x+r[n].x,this.offset.y+r[n].y);this.ctx.lineTo(this.offset.x+r[0].x,this.offset.y+r[0].y),this.ctx.lineWidth=i||1,this._fillOrDraw(s),this.ctx.restore()}image(t,e,s,i=1){t.complete&&t.naturalWidth&&(this.ctx.save(),this.ctx.globalAlpha=i,this.ctx.drawImage(t,0,0,t.naturalWidth-1,t.naturalHeight-1,this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,s.x*this.scale.x,s.y*this.scale.y),this.ctx.restore())}texturedPoly(t,e,s,i,r){var n=s.getBounds(),o=i.clone().difference(n.getCenter()),h=(n.getCenter().sub(o),new a(e.width,e.height)),l=new a(e.min.x,e.min.y).sub(i);this.ctx.save(),this.ctx.translate(this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y),m.helpers.clipPoly(this.ctx,{x:-i.x*this.scale.x,y:-i.y*this.scale.y},this.scale,s.vertices),this.ctx.scale(this.scale.x,this.scale.y),this.ctx.rotate(r),this.ctx.drawImage(t,0,0,t.naturalWidth-1,t.naturalHeight-1,l.x,l.y,h.x,h.y),this.ctx.restore()}_texturedPoly(t,e,s,i,r,n={x:0,y:0}){var o=s.getBounds(),h=i.clone().difference(o.getCenter()),l=n?i.difference(n):{x:0,y:0},c=o.getCenter().sub(h),u=new a(e.width,e.height),d=new a(-e.width/2,-e.height/2).sub(h);this.ctx.save(),this.ctx.translate(this.offset.x+(c.x-0*l.x+0*d.x)*this.scale.x,this.offset.y+(c.y-0*l.y+0*d.y)*this.scale.y),this.ctx.rotate(r),m.helpers.clipPoly(this.ctx,{x:(1*-h.x-c.x-l.x)*this.scale.x,y:(1*-h.y-c.y-l.y)*this.scale.y},this.scale,s.vertices),this.ctx.drawImage(t,0,0,t.naturalWidth-1,t.naturalHeight-1,(-i.x+1*d.x-1*l.x)*this.scale.x,(-i.y+1*d.y-1*l.y)*this.scale.y,u.x*this.scale.x,u.y*this.scale.y),this.ctx.restore()}rect(t,e,s,i,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+e)*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+e)*this.scale.x,this.offset.y+(t.y+s)*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+(t.y+s)*this.scale.y),this.ctx.closePath(),this.ctx.lineWidth=r||1,this._fillOrDraw(i),this.ctx.restore()}_fillOrDraw(t){this.fillShapes?(this.ctx.fillStyle=t,this.ctx.fill()):(this.ctx.strokeStyle=t,this.ctx.stroke())}cubicBezier(t,e,s,i,r,n){t instanceof u?this.cubicBezier(t.startPoint,t.endPoint,t.startControlPoint,t.endControlPoint,r,n):(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.bezierCurveTo(this.offset.x+s.x*this.scale.x,this.offset.y+s.y*this.scale.y,this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y,this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.lineWidth=n||2,this._fillOrDraw(r),this.ctx.restore())}quadraticBezier(t,e,s,i,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.quadraticCurveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,this.offset.x+s.x*this.scale.x,this.offset.y+s.y*this.scale.y),this.ctx.lineWidth=r||2,this._fillOrDraw(i),this.ctx.restore()}cubicBezierPath(t,e,s){if(t&&0!=t.length){var i,r,n;this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t[0].x*this.scale.x,this.offset.y+t[0].y*this.scale.y);for(var a=1;a<t.length;a+=3)r=t[a],n=t[a+1],i=t[a+2],this.ctx.bezierCurveTo(this.offset.x+r.x*this.scale.x,this.offset.y+r.y*this.scale.y,this.offset.x+n.x*this.scale.x,this.offset.y+n.y*this.scale.y,this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y);this.ctx.closePath(),this.ctx.lineWidth=s||1,this._fillOrDraw(e),this.ctx.restore()}}handle(t,e){this.point(t,"rgb(0,32,192)"),this.square(e,5,"rgba(0,128,192,0.5)")}handleLine(t,e){this.line(t,e,"rgb(192,192,192)")}dot(t,e){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(Math.round(this.offset.x+this.scale.x*t.x),Math.round(this.offset.y+this.scale.y*t.y)),this.ctx.lineTo(Math.round(this.offset.x+this.scale.x*t.x+1),Math.round(this.offset.y+this.scale.y*t.y+1)),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(e),this.ctx.restore()}point(t,e){this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,3,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(e)}circle(t,e,s,i){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,e*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this.ctx.lineWidth=i||1,this._fillOrDraw(s)}circleArc(t,e,s,i,r,n,a){a&&a.asSegment||this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,e*this.scale.y,0,s,i,!1),a&&a.asSegment||(this.ctx.lineWidth=n||1,this._fillOrDraw(r||"#000000"))}ellipse(t,e,s,i,r,n){void 0===n&&(n=0),this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e*this.scale.x,s*this.scale.y,n,0,2*Math.PI),this.ctx.closePath(),this.ctx.lineWidth=r||1,this._fillOrDraw(i)}square(t,e,s,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+(t.x-e/2)*this.scale.x,this.offset.y+(t.y-e/2)*this.scale.y,e*this.scale.x,e*this.scale.y),this.ctx.closePath(),this.ctx.lineWidth=i||1,this._fillOrDraw(s)}grid(t,e,s,i,r,n){this.ctx.beginPath();for(var a=-Math.ceil(.5*s/r)*r,o=s/2,h=-Math.ceil(.5*e/i)*i;h<e/2;h+=i)this.ctx.moveTo(this.offset.x+(t.x+h)*this.scale.x,this.offset.y+(t.y+a)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+h)*this.scale.x,this.offset.y+(t.y+o)*this.scale.y);for(var l=-Math.ceil(.5*e/i)*i,c=e/2,u=-Math.ceil(.5*s/r)*r;u<s/2;u+=r)this.ctx.moveTo(this.offset.x+(t.x+l)*this.scale.x-4,this.offset.y+(t.y+u)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+c)*this.scale.x+4,this.offset.y+(t.y+u)*this.scale.y);this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.closePath()}raster(t,e,s,i,r,n){this.ctx.save(),this.ctx.beginPath();for(var a=-Math.ceil(.5*e/i)*i;a<e/2;a+=i)for(var o=-Math.ceil(.5*s/r)*r;o<s/2;o+=r)this.ctx.moveTo(this.offset.x+(t.x+a)*this.scale.x-4,this.offset.y+(t.y+o)*this.scale.y),this.ctx.lineTo(this.offset.x+(t.x+a)*this.scale.x+4,this.offset.y+(t.y+o)*this.scale.y),this.ctx.moveTo(this.offset.x+(t.x+a)*this.scale.x,this.offset.y+(t.y+o)*this.scale.y-4),this.ctx.lineTo(this.offset.x+(t.x+a)*this.scale.x,this.offset.y+(t.y+o)*this.scale.y+4);this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}diamondHandle(t,e,s){this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e/2),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e/2,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e/2),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(s)}squareHandle(t,e,s){this.ctx.beginPath(),this.ctx.rect(this.offset.x+t.x*this.scale.x-e/2,this.offset.y+t.y*this.scale.y-e/2,e,e),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(s)}circleHandle(t,e,s){e=e||3,this.ctx.beginPath(),this.ctx.arc(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,e,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(s)}crosshair(t,e,s,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e,this.offset.y+t.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e,this.offset.y+t.y*this.scale.y),this.ctx.moveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y-e),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y+e),this.ctx.strokeStyle=s,this.ctx.lineWidth=i||.5,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}cross(t,e,s,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e,this.offset.y+t.y*this.scale.y-e),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e,this.offset.y+t.y*this.scale.y+e),this.ctx.moveTo(this.offset.x+t.x*this.scale.x-e,this.offset.y+t.y*this.scale.y+e),this.ctx.lineTo(this.offset.x+t.x*this.scale.x+e,this.offset.y+t.y*this.scale.y-e),this.ctx.strokeStyle=s,this.ctx.lineWidth=i||1,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}polygon(t,e,s){this.polyline(t.vertices,t.isOpen,e,s)}polyline(t,e,s,i){if(!(t.length<=1)){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=(i||1)*this.scale.x,this.ctx.moveTo(this.offset.x+t[0].x*this.scale.x,this.offset.y+t[0].y*this.scale.y);for(var r=0;r<t.length;r++)this.ctx.lineTo(this.offset.x+t[r].x*this.scale.x,this.offset.y+t[r].y*this.scale.y);e||this.ctx.closePath(),this._fillOrDraw(s),this.ctx.closePath(),this.ctx.setLineDash([]),this.ctx.restore()}}text(t,e,s,i){var r,n,a;i=i||{},this.ctx.save();let o=this.offset.x+e*this.scale.x,h=this.offset.y+s*this.scale.y;const l=i.color||"black";(i.fontSize||i.fontFamily)&&(this.ctx.font=(i.fontWeight?i.fontWeight+" ":"")+(i.fontStyle?i.fontStyle+" ":"")+(i.fontSize?i.fontSize*this.scale.x+"px ":" ")+(i.fontFamily?-1===i.fontFamily.indexOf(" ")?i.fontFamily:`"${i.fontFamily}"`:"Arial")),i.textAlign&&(this.ctx.textAlign=i.textAlign);const c=null!==(r=i.rotation)&&void 0!==r?r:0,u=(null!==(a=null!==(n=i.lineHeight)&&void 0!==n?n:i.fontSize)&&void 0!==a?a:0)*this.scale.x;this.ctx.translate(o,h),this.ctx.rotate(c),this.fillShapes?(this.ctx.fillStyle=l,this.ctx.fillText(t,0,u/2)):(this.ctx.strokeStyle=l,this.ctx.strokeText(t,0,u/2)),this.ctx.restore()}label(t,e,s,i,r){this.ctx.save(),this.ctx.font="lighter 9pt Arial",this.ctx.translate(e,s),void 0!==i&&this.ctx.rotate(i),this.ctx.fillStyle=r||"black",this.fillShapes?this.ctx.fillText(t,0,0):this.ctx.strokeText(t,0,0),this.ctx.restore()}path(t,e,s,i){const r=i&&i.inplace?t:v.copyPathData(t);v.transformPathData(r,this.offset,this.scale),e&&(this.ctx.strokeStyle=e),this.ctx.lineWidth=s||1,this.fillShapes?(e&&(this.ctx.fillStyle=e),this.ctx.fill(new Path2D(r.join(" ")))):(e&&(this.ctx.strokeStyle=e),this.ctx.stroke(new Path2D(r.join(" "))))}clear(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}}m.helpers={clipPoly:(t,e,s,i)=>{t.beginPath(),t.moveTo(e.x+i[0].x*s.x,e.y+i[0].y*s.y);for(var r=1;r<i.length;r++){const n=i[r];t.lineTo(e.x+n.x*s.x,e.y+n.y*s.y)}t.closePath(),t.clip()}};class x{constructor(t,e){this.gl=t,this.offset=new a(0,0),this.scale=new a(1,1),this.fillShapes=e,this._zindex=0,null!=t&&void 0!==t&&(this.glutils=new b(t),this._vertShader=this.glutils.compileShader(x.vertCode,this.gl.VERTEX_SHADER),this._fragShader=this.glutils.compileShader(x.fragCode,this.gl.FRAGMENT_SHADER),this._program=this.glutils.makeProgram(this._vertShader,this._fragShader),this.vertex_buffer=this.gl.createBuffer(),console.log("gl initialized"))}_x2rel(t){return(this.scale.x*t+this.offset.x)/this.gl.canvas.width*2-1}_y2rel(t){return(this.offset.y-this.scale.y*t)/this.gl.canvas.height*2-1}copyInstance(t){var e=new x(null,t);return e.gl=this.gl,e.glutils=this.glutils,e._vertShader=this._vertShader,e._fragShader=this._fragShader,e._program=this._program,e}beginDrawCycle(t){this._zindex=0,this.renderTime=t}endDrawCycle(t){}setConfiguration(t){}setCurrentId(t){this.curId=t}setCurrentClassName(t){}line(t,e,s){const i=new Float32Array(6);i[0]=this._x2rel(t.x),i[1]=this._y2rel(t.y),i[2]=this._zindex,i[3]=this._x2rel(e.x),i[4]=this._y2rel(e.y),i[5]=this._zindex,this._zindex+=.001,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW);var r=this.gl.getAttribLocation(this._program,"position");this.gl.vertexAttribPointer(r,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(r),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);let n=this.gl.getUniformLocation(this._program,"uRotationVector");this.gl.uniform2fv(n,[0,1]),this.gl.lineWidth(5),this.gl.drawArrays(this.gl.LINES,0,i.length/3)}arrow(t,e,s){}image(t,e,s,i=0){}texturedPoly(t,e,s,i,r){}_fillOrDraw(t){}cubicBezier(t,e,s,i,r,n){}cubicBezierPath(t,e,s){}handle(t,e){}handleLine(t,e){}dot(t,e){}point(t,e){}circle(t,e,s,i){}circleArc(t,e,s,i,r,n){}ellipse(t,e,s,i,r,n){}square(t,e,s,i){}rect(t,e,s,i,r){}grid(t,e,s,i,r,n){}raster(t,e,s,i,r,n){}diamondHandle(t,e,s){}squareHandle(t,e,s){}circleHandle(t,e,s){}crosshair(t,e,s,i){}cross(t,e,s,i){}polygon(t,e,s){const i=new Float32Array(3*t.vertices.length);for(var r=0;r<t.vertices.length;r++)i[3*r+0]=this._x2rel(t.vertices[r].x),i[3*r+1]=this._y2rel(t.vertices[r].y),i[3*r+2]=this._zindex;this._zindex+=.001,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW);var n=this.gl.getAttribLocation(this._program,"position");this.gl.vertexAttribPointer(n,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(n),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);let a=this.gl.getUniformLocation(this._program,"uRotationVector");this.gl.uniform2fv(a,[0,1]),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,i.length/3)}polyline(t,e,s,i){}text(t,e,s,i){}label(t,e,s,i,r){}path(t,e,s,i){}clear(t){this.gl.clearColor(1,1,1,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}}x.vertCode="\n    precision mediump float;\n\n    attribute vec3 position;\n\n    uniform vec2 uRotationVector;\n\n    void main(void) {\n\tvec2 rotatedPosition = vec2(\n\t    position.x * uRotationVector.y +\n\t\tposition.y * uRotationVector.x,\n\t    position.y * uRotationVector.y -\n\t\tposition.x * uRotationVector.x\n\t);\n\n\tgl_Position = vec4(rotatedPosition, position.z, 1.0);\n    }",x.fragCode="\n    precision highp float;\n\n    void main(void) {\n\tgl_FragColor = vec4(0.0,0.75,1.0,1.0);\n    }";class b{constructor(t){this.gl=t}bufferData(t){var e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e}compileShader(t,e){var s=this.gl.createShader(e);this.gl.shaderSource(s,t),this.gl.compileShader(s);return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(console.warn("Error in shader:"+this.gl.getShaderInfoLog(s)),this.gl.deleteShader(s),null)}makeProgram(t,e){var s=this.gl.createProgram();return this.gl.attachShader(s,t),this.gl.attachShader(s,e),this.gl.linkProgram(s),this.gl.useProgram(s),this.gl.detachShader(s,t),this.gl.detachShader(s,e),this.gl.deleteShader(t),this.gl.deleteShader(e),s}}class w{constructor(t,e,s){this.className="Triangle",this.uid=i.next(),this.a=t,this.b=e,this.c=s,this.calcCircumcircle()}static fromArray(t){if(t.length<3)throw`Cannot create triangle from array with less than three vertices (${t.length})`;return new w(t[0],t[1],t[2])}getArea(){return Math.abs(w.utils.signedArea(this.a.x,this.a.y,this.b.x,this.b.y,this.c.x,this.c.y))}getCentroid(){return new a((this.a.x+this.b.x+this.c.x)/3,(this.a.y+this.b.y+this.c.y)/3)}scaleToCentroid(t){let e=this.getCentroid();return this.a.scale(t,e),this.b.scale(t,e),this.c.scale(t,e),this}getCircumcircle(){return this.calcCircumcircle(),new g(this.center.clone(),this.radius)}isAdjacent(t){var e=this.a.equals(t.a)||this.a.equals(t.b)||this.a.equals(t.c),s=this.b.equals(t.a)||this.b.equals(t.b)||this.b.equals(t.c),i=this.c.equals(t.a)||this.c.equals(t.b)||this.c.equals(t.c);return e&&s||e&&i||s&&i}getThirdVertex(t,e){return this.a.equals(t)&&this.b.equals(e)||this.a.equals(e)&&this.b.equals(t)?this.c:this.b.equals(t)&&this.c.equals(e)||this.b.equals(e)&&this.c.equals(t)?this.a:this.b}calcCircumcircle(){const t=this.b.x-this.a.x,e=this.b.y-this.a.y,s=this.c.x-this.a.x,i=this.c.y-this.a.y,r=t*(this.a.x+this.b.x)+e*(this.a.y+this.b.y),n=s*(this.a.x+this.c.x)+i*(this.a.y+this.c.y),o=2*(t*(this.c.y-this.b.y)-e*(this.c.x-this.b.x));let h,l;if(Math.abs(o)<w.EPSILON){const t=this.bounds();this.center=new a((t.min.x+t.max.x)/2,(t.min.y+t.max.y)/2),h=this.center.x-t.min.x,l=this.center.y-t.min.y}else{const c=(i*r-e*n)/o,u=(t*n-s*r)/o;this.center=new a(c,u),h=this.center.x-this.a.x,l=this.center.y-this.a.y}this.radius_squared=h*h+l*l,this.radius=Math.sqrt(this.radius_squared)}inCircumcircle(t){const e=this.center.x-t.x,s=this.center.y-t.y;return e*e+s*s<=this.radius_squared}bounds(){return new h(new a(w.utils.min3(this.a.x,this.b.x,this.c.x),w.utils.min3(this.a.y,this.b.y,this.c.y)),new a(w.utils.max3(this.a.x,this.b.x,this.c.x),w.utils.max3(this.a.y,this.b.y,this.c.y)))}toPolygon(){return new o([this.a,this.b,this.c])}determinant(){return(this.b.y-this.a.y)*(this.c.x-this.b.x)-(this.c.y-this.b.y)*(this.b.x-this.a.x)}containsPoint(t){return w.utils.pointIsInTriangle(t.x,t.y,this.a.x,this.a.y,this.b.x,this.b.y,this.c.x,this.c.y)}getIncircularTriangle(){const t=new f(this.a,this.b),e=new f(this.b,this.c),s=new f(this.c,this.a),i=C.nsectAngle(this.b,this.a,this.c,2)[0],r=C.nsectAngle(this.c,this.b,this.a,2)[0],n=i.intersection(r),a=t.getClosestPoint(n),o=e.getClosestPoint(n),h=s.getClosestPoint(n);return new w(a,o,h)}getIncircle(){return this.getIncircularTriangle().getCircumcircle()}getIncenter(){return this.center&&this.radius||this.calcCircumcircle(),this.center.clone()}toString(){return"{ a : "+this.a.toString()+", b : "+this.b.toString()+", c : "+this.c.toString()+"}"}destroy(){this.a.destroy(),this.b.destroy(),this.c.destroy(),this.isDestroyed=!0}}w.EPSILON=1e-6,w.utils={max3:(t,e,s)=>t>=e&&t>=s?t:e>=t&&e>=s?e:s,min3:(t,e,s)=>t<=e&&t<=s?t:e<=t&&e<=s?e:s,signedArea:(t,e,s,i,r,n)=>.5*(-i*r+e*(-s+r)+t*(i-n)+s*n),pointIsInTriangle(t,e,s,i,r,n,a,o){var h=w.utils.signedArea(s,i,r,n,a,o),l=1/(2*h)*(i*a-s*o+(o-i)*t+(s-a)*e),c=1/(2*h)*(s*n-i*r+(i-n)*t+(r-s)*e);return l>0&&c>0&&1-l-c>0}};const C={nsectAngle(t,e,s,i){const r=new w(t,e,s),n=new f(t,e),a=new f(t,s);var o=n.angle(a);const h=r.determinant()>0;o<0&&(o=2*Math.PI+o),h||(o=-1*(2*Math.PI-o));const l=Math.max(n.length(),a.length())/n.length();for(var c=[],u=1;u<i;u++)c.push(new f(t,e.clone().rotate(o/i*-u,t)).scale(l));return c},wrapMax:(t,e)=>(e+t%e)%e,wrapMinMax:(t,e,s)=>e+C.wrapMax(t-e,s-e)};class P{constructor(t,e){this.center=t,this.size=e}}P.utils={baseLog:(t,e)=>Math.log(t)/Math.log(e),mapRasterScale:(t,e)=>{var s=1;return e>=1?(s=Math.abs(Math.floor(1/P.utils.baseLog(t,e))),s=1/Math.pow(t,s)):s=Math.abs(Math.floor(P.utils.baseLog(1/t,1/(e+1)))),s}};class S{constructor(t){this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates={},t=t||{},this.element=t.element?t.element:globalThis,this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates=[],this.trackAllKeys=t.trackAll||!1,this.installListeners()}fireEvent(t,e){let s=!1;for(var i in e){var r=e[i];r.keyCode==t.keyCode&&(r.listener(t),s=!0)}return s}fireDownEvent(t,e){(e.fireEvent(t,e.downListeners)||e.trackAllKeys)&&(e.keyStates[t.keyCode]="down")}firePressEvent(t,e){e.fireEvent(t,e.pressListeners)}fireUpEvent(t,e){(e.fireEvent(t,e.upListeners)||e.trackAllKeys)&&delete e.keyStates[t.keyCode]}static key2code(t){if("number"==typeof t)return t;if("string"!=typeof t)throw"Unknown key name or key type (should be a string or integer): "+t;if(S.KEY_CODES[t])return S.KEY_CODES[t];throw"Unknown key (cannot resolve key code): "+t}installListeners(){var t=this;this.element.addEventListener("keydown",this._keyDownListener=e=>{t.fireDownEvent(e,t)}),this.element.addEventListener("keypress",this._keyPressListener=e=>{t.firePressEvent(e,t)}),this.element.addEventListener("keyup",this._keyUpListener=e=>{t.fireUpEvent(e,t)})}releaseListeners(){this.element.removeEventListener("keydown",this._keyDownListener),this.element.removeEventListener("keypress",this._keyPressListener),this.element.removeEventListener("keyup",this._keyUpListener)}down(t,e){return this.downListeners.push({key:t,keyCode:S.key2code(t),listener:e}),this}press(t,e){return this.pressListeners.push({key:t,keyCode:S.key2code(t),listener:e}),this}up(t,e){return this.upListeners.push({key:t,keyCode:S.key2code(t),listener:e}),this}isDown(t){return"number"==typeof t?!!this.keyStates[t]:!!this.keyStates[S.key2code(t)]}destroy(){this.releaseListeners()}}S.KEY_CODES={break:3,backspace:8,tab:9,clear:12,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,hangul:21,hanja:25,escape:27,conversion:28,"non-conversion":29,spacebar:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,select:41,print:42,execute:43,printscreen:44,insert:45,delete:46,help:47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,"semicolon (firefox)":59,equals:59,"<":60,"equals (firefox)":61,ß:63,"@ (firefox)":64,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windows:91,leftcommand:91,chromebooksearch:91,rightwindowkey:92,windowsmenu:93,rightcommant:93,sleep:95,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,numpadperiod:108,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131,f21:132,f22:133,f23:134,f24:135,numlock:144,scrolllock:145,"^":160,"!":161,"#":163,$:164,ù:165,pagebackward:166,pageforward:167,refresh:168,closingparen:169,"*":170,"~+*":171,minus:173,decreasevolumelevel:174,increasevolumelevel:175,next:176,previous:177,stop:178,"play/pause":179,email:180,mute:181,unmute:181,semicolon:186,ñ:186,equal:187,comma:188,dash:189,period:190,forwardslash:191,ç:191,"grave accent":192,æ:192,ö:192,"?":193,"/":193,"°":193,openbracket:219,backslash:220,closebracket:221,å:221,singlequote:222,ø:222,ä:222,"`":223,altgr:225,"GNOME Compose Key":230,XF86Forward:233,XF86Back:234,alphanumeric:240,hiragana:242,katakana:242,"half-width":243,"full-width":243,kanji:244,unlocktrackpad:251,toggletouchpad:255};class A extends MouseEvent{}class T extends WheelEvent{}class E{constructor(t,e){this.mouseDownPos=void 0,this.mouseDragPos=void 0,this.mouseButton=-1,this.listeners={},this.installed={},this.handlers={},this.name=e,this.element=t,this.mouseDownPos=void 0,this.mouseDragPos=void 0,this.mouseButton=-1,this.listeners={},this.installed={},this.handlers={};const s=this;this.handlers.mousemove=t=>{s.listeners.mousemove&&s.listeners.mousemove(s.mkParams(t,"mousemove")),s.mouseDragPos&&s.listeners.drag&&s.listeners.drag(s.mkParams(t,"drag")),s.mouseDownPos&&(s.mouseDragPos=s.relPos(t))},this.handlers.mouseup=t=>{s.listeners.mouseup&&s.listeners.mouseup(s.mkParams(t,"mouseup")),s.mouseDragPos=void 0,s.mouseDownPos=void 0,s.mouseButton=-1},this.handlers.mousedown=t=>{s.mouseDragPos=s.relPos(t),s.mouseDownPos=s.relPos(t),s.mouseButton=t.button,s.listeners.mousedown&&s.listeners.mousedown(s.mkParams(t,"mousedown"))},this.handlers.click=t=>{s.listeners.click&&s.listeners.click(s.mkParams(t,"click"))},this.handlers.wheel=t=>{s.listeners.wheel&&s.listeners.wheel(s.mkParams(t,"wheel"))},this.element.addEventListener("mousemove",this.handlers.mousemove),this.element.addEventListener("mouseup",this.handlers.mouseup),this.element.addEventListener("mousedown",this.handlers.mousedown),this.element.addEventListener("click",this.handlers.click),this.element.addEventListener("wheel",this.handlers.wheel)}relPos(t){return{x:t.offsetX,y:t.offsetY}}mkParams(t,e){var s,i;const r=this.relPos(t),n=t;return n.params={element:this.element,name:e,isTouchEvent:!1,pos:r,button:t.button,leftButton:0===t.button,middleButton:1===t.button,rightButton:2===t.button,mouseDownPos:null!==(s=this.mouseDownPos)&&void 0!==s?s:{x:NaN,y:NaN},draggedFrom:null!==(i=this.mouseDragPos)&&void 0!==i?i:{x:NaN,y:NaN},wasDragged:null!=this.mouseDownPos&&(this.mouseDownPos.x!=r.x||this.mouseDownPos.y!=r.y),dragAmount:null!=this.mouseDragPos?{x:r.x-this.mouseDragPos.x,y:r.y-this.mouseDragPos.y}:{x:0,y:0}},n}listenFor(t){this.installed[t]||(this.installed[t]=!0)}unlistenFor(t){this.installed[t]&&delete this.installed[t]}drag(t){return this.listeners.drag&&this.throwAlreadyInstalled("drag"),this.listeners.drag=t,this.listenFor("mousedown"),this.listenFor("mousemove"),this.listenFor("mouseup"),this}move(t){return this.listeners.mousemove&&this.throwAlreadyInstalled("mousemove"),this.listenFor("mousemove"),this.listeners.mousemove=t,this}up(t){return this.listeners.mouseup&&this.throwAlreadyInstalled("mouseup"),this.listenFor("mouseup"),this.listeners.mouseup=t,this}down(t){return this.listeners.mousedown&&this.throwAlreadyInstalled("mousedown"),this.listenFor("mousedown"),this.listeners.mousedown=t,this}click(t){return this.listeners.click&&this.throwAlreadyInstalled("click"),this.listenFor("click"),this.listeners.click=t,this}wheel(t){return this.listeners.wheel&&this.throwAlreadyInstalled("wheel"),this.listenFor("wheel"),this.listeners.wheel=t,this}throwAlreadyInstalled(t){throw`This MouseHandler already has a '${t}' callback. To keep the code simple there is only room for one.`}destroy(){this.unlistenFor("mousedown"),this.unlistenFor("mousemove"),this.unlistenFor("moseup"),this.unlistenFor("click"),this.unlistenFor("wheel"),this.element.removeEventListener("mousemove",this.handlers.mousemove),this.element.removeEventListener("mouseup",this.handlers.mousedown),this.element.removeEventListener("mousedown",this.handlers.mousedown),this.element.removeEventListener("click",this.handlers.click),this.element.removeEventListener("wheel",this.handlers.wheel)}}class N{constructor(t,e,s){this.className="PBImage",this.uid=i.next(),this.image=t,this.upperLeft=e,this.lowerRight=s}destroy(){this.upperLeft.destroy(),this.lowerRight.destroy(),this.isDestroyed=!0}}class _{constructor(t,e,s){this.className="PBText",this.uid=i.next(),this.text=t,this.anchor=null!=e?e:new a,this.color=s.color,this.fontFamily=s.fontFamily,this.fontSize=s.fontSize,this.fontStyle=s.fontStyle,this.fontWeight=s.fontWeight,this.lineHeight=s.lineHeight,this.textAlign=s.textAlign,this.rotation=s.rotation}destroy(){this.anchor.destroy(),this.isDestroyed=!0}}const D=t=>Math.sqrt(t.x*t.x+t.y*t.y),L=(t,e)=>{var s=((t,e)=>{const s=D(t)*D(e);if(0===s)return 0;var i=((t,e)=>t.x*e.x+t.y*e.y)(t,e)/s;return i>1&&(i=1),Math.acos(i)})(t,e);return((t,e)=>t.x*e.y-e.x*t.y)(t,e)>0&&(s*=-1),180*s/Math.PI};class z{constructor(t){this.handlers=[],this.el=t}add(t){this.handlers.push(t)}del(t){t||(this.handlers=[]);for(var e=this.handlers.length;e>=0;e--)this.handlers[e]===t&&this.handlers.splice(e,1)}dispatch(...t){for(var e=0,s=this.handlers.length;e<s;e++){const t=this.handlers[e];"function"==typeof t&&t.apply(this.el,arguments)}}}const M=(t,e)=>{const s=new z(t);return s.add(e),s};class O{constructor(t,e){this.element="string"==typeof t?document.querySelector(t):t,this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this),this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1),this.preV={x:null,y:null},this.pinchStartLen=null,this.zoom=1,this.isDoubleTap=!1;const s=()=>{};this.rotate=M(this.element,e.rotate||s),this.touchStart=M(this.element,e.touchStart||s),this.multipointStart=M(this.element,e.multipointStart||s),this.multipointEnd=M(this.element,e.multipointEnd||s),this.pinch=M(this.element,e.pinch||s),this.swipe=M(this.element,e.swipe||s),this.tap=M(this.element,e.tap||s),this.doubleTap=M(this.element,e.doubleTap||s),this.longTap=M(this.element,e.longTap||s),this.singleTap=M(this.element,e.singleTap||s),this.pressMove=M(this.element,e.pressMove||s),this.twoFingerPressMove=M(this.element,e.twoFingerPressMove||s),this.touchMove=M(this.element,e.touchMove||s),this.touchEnd=M(this.element,e.touchEnd||s),this.touchCancel=M(this.element,e.touchCancel||s),this._cancelAllHandler=this.cancelAll.bind(this),globalThis&&"function"==typeof globalThis.addEventListener&&globalThis.addEventListener("scroll",this._cancelAllHandler),this.delta=null,this.last=null,this.now=null,this.tapTimeout=null,this.singleTapTimeout=null,this.longTapTimeout=null,this.swipeTimeout=null,this.x1=this.x2=this.y1=this.y2=null,this.preTapPosition={x:null,y:null}}start(t){if(!t.touches)return;const e=this;this.now=Date.now(),this.x1=t.touches[0].pageX,this.y1=t.touches[0].pageY,this.delta=this.now-(this.last||this.now),this.touchStart.dispatch(t,this.element),null!==this.preTapPosition.x&&(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30,this.isDoubleTap&&clearTimeout(this.singleTapTimeout)),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now;const s=this.preV;if(t.touches.length>1){this._cancelLongTap(),this._cancelSingleTap();const e={x:t.touches[1].pageX-this.x1,y:t.touches[1].pageY-this.y1};s.x=e.x,s.y=e.y,this.pinchStartLen=D(s),this.multipointStart.dispatch(t,this.element)}this._preventTap=!1,this.longTapTimeout=setTimeout((()=>{e.longTap.dispatch(t,e.element),e._preventTap=!0}).bind(e),750)}move(t){if(!t.touches)return;const e=t,s=this.preV,i=t.touches.length,r=t.touches[0].pageX,n=t.touches[0].pageY;if(this.isDoubleTap=!1,i>1){const t=e.touches[1].pageX,i=e.touches[1].pageY,a={x:e.touches[1].pageX-r,y:e.touches[1].pageY-n};null!==s.x&&(this.pinchStartLen>0&&(e.zoom=D(a)/this.pinchStartLen,this.pinch.dispatch(e,this.element)),e.angle=L(a,s),this.rotate.dispatch(e,this.element)),s.x=a.x,s.y=a.y,null!==this.x2&&null!==this.sx2?(e.deltaX=(r-this.x2+t-this.sx2)/2,e.deltaY=(n-this.y2+i-this.sy2)/2):(e.deltaX=0,e.deltaY=0),this.twoFingerPressMove.dispatch(e,this.element),this.sx2=t,this.sy2=i}else{if(null!==this.x2){e.deltaX=r-this.x2,e.deltaY=n-this.y2;const t=Math.abs(this.x1-this.x2),s=Math.abs(this.y1-this.y2);(t>10||s>10)&&(this._preventTap=!0)}else e.deltaX=0,e.deltaY=0;this.pressMove.dispatch(e,this.element)}this.touchMove.dispatch(e,this.element),this._cancelLongTap(),this.x2=r,this.y2=n,i>1&&t.preventDefault()}end(t){if(!t.changedTouches)return;const e=t;this._cancelLongTap();const s=this;e.touches.length<2&&(this.multipointEnd.dispatch(e,this.element),this.sx2=this.sy2=null),this.x2&&Math.abs(this.x1-this.x2)>30||this.y2&&Math.abs(this.y1-this.y2)>30?(e.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout((function(){s.swipe.dispatch(e,s.element)}),0)):(this.tapTimeout=setTimeout((function(){s._preventTap||s.tap.dispatch(e,s.element),s.isDoubleTap&&(s.doubleTap.dispatch(e,s.element),s.isDoubleTap=!1)}),0),s.isDoubleTap||(s.singleTapTimeout=setTimeout((function(){s.singleTap.dispatch(e,s.element)}),250))),this.touchEnd.dispatch(e,this.element),this.preV.x=0,this.preV.y=0,this.zoom=1,this.pinchStartLen=null,this.x1=this.x2=this.y1=this.y2=null}cancelAll(){this._preventTap=!0,clearTimeout(this.singleTapTimeout),clearTimeout(this.tapTimeout),clearTimeout(this.longTapTimeout),clearTimeout(this.swipeTimeout)}cancel(t){this.cancelAll(),this.touchCancel.dispatch(t,this.element)}_cancelLongTap(){clearTimeout(this.longTapTimeout)}_cancelSingleTap(){clearTimeout(this.singleTapTimeout)}_swipeDirection(t,e,s,i){return Math.abs(t-e)>=Math.abs(s-i)?t-e>0?"Left":"Right":s-i>0?"Up":"Down"}on(t,e){if(this[t]){this[t].add(e)}}off(t,e){if(this[t]){this[t].del(e)}}destroy(){this.singleTapTimeout&&clearTimeout(this.singleTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this.element.removeEventListener("touchstart",this.start),this.element.removeEventListener("touchmove",this.move),this.element.removeEventListener("touchend",this.end),this.element.removeEventListener("touchcancel",this.cancel),this.rotate.del(),this.touchStart.del(),this.multipointStart.del(),this.multipointEnd.del(),this.pinch.del(),this.swipe.del(),this.tap.del(),this.doubleTap.del(),this.longTap.del(),this.singleTap.del(),this.pressMove.del(),this.twoFingerPressMove.del(),this.touchMove.del(),this.touchEnd.del(),this.touchCancel.del(),this.preV=this.pinchStartLen=this.zoom=this.isDoubleTap=this.delta=this.last=this.now=this.tapTimeout=this.singleTapTimeout=this.longTapTimeout=this.swipeTimeout=this.x1=this.x2=this.y1=this.y2=this.preTapPosition=this.rotate=this.touchStart=this.multipointStart=this.multipointEnd=this.pinch=this.swipe=this.tap=this.doubleTap=this.longTap=this.singleTap=this.pressMove=this.touchMove=this.touchEnd=this.touchCancel=this.twoFingerPressMove=null,globalThis&&"function"==typeof globalThis.removeEventListener&&globalThis.removeEventListener("scroll",this._cancelAllHandler)}}const R=O;class I{constructor(t,e,s){this.className="VEllipse",this.uid=i.next(),this.center=t,this.axis=e,this.rotation=s||0}clone(){return new I(this.center.clone(),this.axis.clone(),this.rotation)}radiusH(){return Math.abs(this.signedRadiusH())}signedRadiusH(){return new a(this.axis).rotate(-this.rotation,this.center).x-this.center.x}radiusV(){return Math.abs(this.signedRadiusV())}signedRadiusV(){return new a(this.axis).rotate(-this.rotation,this.center).y-this.center.y}scale(t){return this.axis.scale(t,this.center),this}rotate(t){return this.axis.rotate(t,this.center),this.rotation+=t,this}vertAt(t){const e=this.radiusH(),s=this.radiusV();return new a(I.utils.polarToCartesian(this.center.x,this.center.y,e,s,t)).rotate(this.rotation,this.center)}normalAt(t,e){const s=this.vertAt(t),i=this.getFoci(),r=new f(s,i[0]).angle(),n=r+(new f(s,i[1]).angle()-r)/2,a=s.clone().addX(50).clone().rotate(n,s),o=s.clone().addX(50).clone().rotate(Math.PI+n,s);return this.center.distance(a)<this.center.distance(o)?new c(s,o):new c(s,a)}tangentAt(t,e){const s=this.normalAt(t,e);return s.b.rotate(Math.PI/2,s.a),s}perimeter(){const t=this.radiusH(),e=this.radiusV();return Math.PI*(3*(t+e)-Math.sqrt((3*t+e)*(t+3*e)))}getFoci(){const t=this.radiusH(),e=this.radiusV(),s=t*t-e*e,i=Math.sqrt(Math.abs(s));return s<0?[this.center.clone().addY(i).rotate(this.rotation,this.center),this.center.clone().addY(-i).rotate(this.rotation,this.center)]:[this.center.clone().addX(i).rotate(this.rotation,this.center),this.center.clone().addX(-i).rotate(this.rotation,this.center)]}getEquidistantVertices(t){const e=I.utils.equidistantVertAngles(this.radiusH(),this.radiusV(),t),s=[];for(var i=0;i<e.length;i++)s.push(this.vertAt(e[i]));return s}toCubicBezier(t,e){const s=4*Math.max(1,t||3);e=void 0===e?.666666:e;const i=this.radiusH(),r=this.radiusV(),n=[],a=I.utils.equidistantVertAngles(i,r,s);let o=a[0],h=this.vertAt(o);for(var l=0;l<a.length;l++){let t=a[(l+1)%a.length],s=this.vertAt(t);if(Math.abs(r)<1e-4||Math.abs(i)<1e-4){let t=h.difference(s),e=new u(h.clone(),s.clone(),h.clone().addXY(.333*t.x,.333*t.y),s.clone().addXY(.333*-t.x,.333*-t.y));n.push(e)}else{let i=this.tangentAt(o),r=this.tangentAt(t),a=i.intersection(r),l=h.difference(a),c=s.difference(a),d=new u(h.clone(),s.clone(),h.clone().add(l.scale(e)),s.clone().add(c.scale(e)));n.push(d)}h=s,o=t}return n}destroy(){this.center.destroy(),this.axis.destroy(),this.isDestroyed=!0}}I.utils={polarToCartesian:(t,e,s,i,r)=>{var n=Math.sin(Math.PI/2-r),a=Math.cos(Math.PI/2-r);return{x:t+s*i*n/Math.sqrt(Math.pow(s*a,2)+Math.pow(i*n,2)),y:e+s*i*a/Math.sqrt(Math.pow(s*a,2)+Math.pow(i*n,2))}},phiToTheta:(t,e,s)=>{var i=Math.tan(s),r=i*i;return-Math.PI/2+s+Math.atan((t-e)*i/(e+t*r))},equidistantVertAngles:(t,e,s)=>{const i=[];for(var r=0;r<s;r++){var n=Math.PI/2+2*Math.PI/s*r;let a=I.utils.phiToTheta(t,e,n);i[r]=a}return i}};class k{constructor(t,e,s){this.className="VEllipseSector",this.uid=i.next(),this.ellipse=t,this.startAngle=C.wrapMinMax(e,0,2*Math.PI),this.endAngle=C.wrapMinMax(s,0,2*Math.PI)}toCubicBezier(t,e){const s=4*Math.max(1,t||3);e=void 0===e?.666666:e;const i=this.ellipse.radiusH(),r=this.ellipse.radiusV();var n=k.ellipseSectorUtils.normalizeAngle(this.startAngle),a=k.ellipseSectorUtils.normalizeAngle(this.endAngle),o=k.ellipseSectorUtils.equidistantVertAngles(i,r,n,a,s);const h=[];let l=(o=[n].concat(o).concat([a]))[0],c=this.ellipse.vertAt(l);for(var d=0;d+1<o.length;d++){let t=o[(d+1)%o.length],s=this.ellipse.vertAt(t),n=this.ellipse.tangentAt(l),a=this.ellipse.tangentAt(t);if(Math.abs(r)<1e-4||Math.abs(i)<1e-4){let t=c.difference(s),e=new u(c.clone(),s.clone(),c.clone().addXY(.333*t.x,.333*t.y),s.clone().addXY(.333*-t.x,.333*-t.y));h.push(e)}else{let t=n.intersection(a);if(t){let i=c.difference(t),r=s.difference(t),n=new u(c.clone(),s.clone(),c.clone().add(i.scale(e)),s.clone().add(r.scale(e)));h.push(n)}}c=s,l=t}return h}destroy(){this.ellipse.destroy(),this.isDestroyed=!0}}var F;k.ellipseSectorUtils={describeSVGArc:(t,e,s,i,r,n,o,h)=>{void 0===h&&(h={moveToStart:!0}),void 0===o&&(o=0),r=C.wrapMax(r,2*Math.PI),n=C.wrapMax(n,2*Math.PI);var l=new a(I.utils.polarToCartesian(t,e,s,i,n)),c=new a(I.utils.polarToCartesian(t,e,s,i,r));l.rotate(o,{x:t,y:e}),c.rotate(o,{x:t,y:e});var u,d=n-r;u=d<0?Math.abs(d)<Math.PI?1:0:Math.abs(d)>Math.PI?1:0;const f=[];h.moveToStart&&f.push("M",c.x,c.y);const g=180/Math.PI;return f.push("A",s,i,o*g,u,1,l.x,l.y),f},equidistantVertAngles:(t,e,s,i,r)=>{for(var n=(n=(n=I.utils.equidistantVertAngles(t,e,r)).map((t=>k.ellipseSectorUtils.normalizeAngle(t)))).filter((t=>s<i?t>=s&&t<=i:t>=s||t<=i&&t>=0)),a=k.ellipseSectorUtils.findClosestToStartAngle(s,i,n),o=[],h=0;h<n.length;h++)o.push(n[(a+h)%n.length]);return o},findClosestToStartAngle:(t,e,s)=>{if(t>e){const r=s.length;for(var i=0;i<r;i++){const r=C.wrapMinMax(s[i],0,2*Math.PI);if(r>=t&&r>=e)return i}}return 0},normalizeAngle:t=>t<0?2*Math.PI+t:t,endpointToCenterParameters(t,e,s,i,r,n,o,h,l){const c=Math.abs,u=Math.sin,d=Math.cos,g=Math.sqrt,p=t=>t*t,y=u(r),v=d(r),m=v*(t-h)/2+y*(e-l)/2,x=-y*(t-h)/2+v*(e-l)/2,b=p(m),w=p(x),C=p(s),P=p(i),S=b/C+w/P;S>1?(s=g(S)*c(s),i=g(S)*c(i)):(s=c(s),i=c(i));const A=n===o?-1:1,T=g(Math.abs((C*P-C*w-P*b)/(C*w+P*b)))*A,E=T*(s*x)/i,N=T*(-i*m)/s,_=new a(v*E-y*N+(t+h)/2,y*E+v*N+(e+l)/2),D=_.clone().addXY(s,i),L=new I(_,D,0);L.rotate(r);const z=new f(L.center,new a(t,e)).angle(),M=new f(L.center,new a(h,l)).angle();return new k(L,z-r,M-r)}};class B{constructor(t){var e,s;if(this.renderTime=0,r.model={bezierAutoAdjust:!1,renderTime:0,selectable:!0,isSelected:!1,draggable:!0,visible:!0},void 0===t.canvas)throw"No canvas specified.";const i=B.utils.fetch;this.config={canvas:t.canvas,fullSize:i.val(t,"fullSize",!0),fitToParent:i.bool(t,"fitToParent",!0),scaleX:i.num(t,"scaleX",1),scaleY:i.num(t,"scaleY",1),offsetX:i.num(t,"offsetX",0),offsetY:i.num(t,"offsetY",0),rasterGrid:i.bool(t,"rasterGrid",!0),drawRaster:i.bool(t,"drawRaster",!0),rasterScaleX:i.num(t,"rasterScaleX",1),rasterScaleY:i.num(t,"rasterScaleY",1),rasterAdjustFactor:i.num(t,"rasterAdjustdFactror",2),drawOrigin:i.bool(t,"drawOrigin",!1),autoAdjustOffset:i.val(t,"autoAdjustOffset",!0),offsetAdjustXPercent:i.num(t,"offsetAdjustXPercent",50),offsetAdjustYPercent:i.num(t,"offsetAdjustYPercent",50),backgroundColor:t.backgroundColor||"#ffffff",redrawOnResize:i.bool(t,"redrawOnResize",!0),defaultCanvasWidth:i.num(t,"defaultCanvasWidth",B.DEFAULT_CANVAS_WIDTH),defaultCanvasHeight:i.num(t,"defaultCanvasHeight",B.DEFAULT_CANVAS_HEIGHT),canvasWidthFactor:i.num(t,"canvasWidthFactor",1),canvasHeightFactor:i.num(t,"canvasHeightFactor",1),cssScaleX:i.num(t,"cssScaleX",1),cssScaleY:i.num(t,"cssScaleY",1),cssUniformScale:i.bool(t,"cssUniformScale",!0),saveFile:()=>{o.hooks.saveFile(o)},setToRetina:()=>{o._setToRetina()},autoDetectRetina:i.bool(t,"autoDetectRetina",!0),enableSVGExport:i.bool(t,"enableSVGExport",!0),preClear:i.func(t,"preClear",null),preDraw:i.func(t,"preDraw",null),postDraw:i.func(t,"postDraw",null),enableMouse:i.bool(t,"enableMouse",!0),enableTouch:i.bool(t,"enableTouch",!0),enableKeys:i.bool(t,"enableKeys",!0),enableMouseWheel:i.bool(t,"enableMouseWheel",!0),enableZoom:i.bool(t,"enableZoom",!0),enablePan:i.bool(t,"enablePan",!0),enableGL:i.bool(t,"enableGL",!1)},this.drawConfig={drawVertices:!0,drawBezierHandleLines:i.bool(t,"drawBezierHandleLines",!0),drawBezierHandlePoints:i.bool(t,"drawBezierHandlePoints",!0),drawHandleLines:i.bool(t,"drawHandleLines",!0),drawHandlePoints:i.bool(t,"drawHandlePoints",!0),drawGrid:i.bool(t,"drawGrid",!0),drawRaster:i.bool(t,"drawRaster",!0),bezier:{color:"#00a822",lineWidth:2,handleLine:{color:"rgba(180,180,180,0.5)",lineWidth:1},pathVertex:{color:"#B400FF",lineWidth:1,fill:!0},controlVertex:{color:"#B8D438",lineWidth:1,fill:!0}},polygon:{color:"#0022a8",lineWidth:1},triangle:{color:"#6600ff",lineWidth:1},ellipse:{color:"#2222a8",lineWidth:1},ellipseSector:{color:"#a822a8",lineWidth:2},circle:{color:"#22a8a8",lineWidth:2},circleSector:{color:"#2280a8",lineWidth:1},vertex:{color:"#a8a8a8",lineWidth:1},selectedVertex:{color:"#c08000",lineWidth:2},line:{color:"#a844a8",lineWidth:1},vector:{color:"#ff44a8",lineWidth:1},image:{color:"#a8a8a8",lineWidth:1},text:{color:"rgba(192,0,128,0.5)",lineWidth:1,fill:!0,anchor:!0},origin:{color:"#000000"}},this.grid=new P(new a(0,0),new a(50,50)),this.canvasSize={width:B.DEFAULT_CANVAS_WIDTH,height:B.DEFAULT_CANVAS_HEIGHT};const n="string"==typeof t.canvas?document.querySelector(t.canvas):t.canvas;if("canvas"===n.tagName.toLowerCase())if(this.canvas=n,this.eventCatcher=this.canvas,this.config.enableGL&&void 0===x&&(console.warn("Cannot use webgl. Package was compiled without experimental gl support. Please use plotboilerplate-glsupport.min.js instead."),console.warn("Disabling GL and falling back to Canvas2D."),this.config.enableGL=!1),this.config.enableGL){const t=this.canvas.getContext("webgl");this.draw=new x(t,!1),this.fill=this.draw.copyInstance(!0),console.warn("Initialized with experimental mode enableGL=true. Note that this is not yet fully implemented.")}else{const t=this.canvas.getContext("2d");this.draw=new m(t,!1),this.fill=new m(t,!0)}else{if("svg"!==n.tagName.toLowerCase())throw"Element is neither a canvas nor an svg element.";if(void 0===v)throw"The svg draw library is not yet integrated part of PlotBoilerplate. Please include ./src/js/utils/helpers/drawutils.svg into your document.";this.canvas=n,this.draw=new v(this.canvas,new a,new a,this.canvasSize,!1,this.drawConfig,!1),this.fill=this.draw.copyInstance(!0),this.canvas.parentElement?(this.eventCatcher=document.createElement("div"),this.eventCatcher.style.position="absolute",this.eventCatcher.style.left="0",this.eventCatcher.style.top="0",this.eventCatcher.style.cursor="pointer",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(this.eventCatcher)):this.eventCatcher=document.body}t.title&&this.eventCatcher.setAttribute("title",t.title),this.draw.scale.set(null!==(e=this.config.scaleX)&&void 0!==e?e:1,this.config.scaleY),this.fill.scale.set(null!==(s=this.config.scaleX)&&void 0!==s?s:1,this.config.scaleY),this.vertices=[],this.selectPolygon=null,this.draggedElements=[],this.drawables=[],this.console=console,this.hooks={saveFile:B._saveFile};var o=this;globalThis.addEventListener("resize",(()=>o.resizeCanvas())),this.resizeCanvas(),t.autoDetectRetina&&this._setToRetina(),this.installInputListeners(),this.updateCSSscale(),this.redraw(),this.canvas.focus()}static _saveFile(t){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");var s=new v(e,t.draw.offset,t.draw.scale,t.canvasSize,!1,t.drawConfig),i=s.copyInstance(!0);s.beginDrawCycle(0),i.beginDrawCycle(0),t.config.preClear&&t.config.preClear(),s.clear(t.config.backgroundColor||"white"),t.config.preDraw&&t.config.preDraw(s,i),t.drawAll(0,s,i),t.drawVertices(0,s),t.config.postDraw&&t.config.postDraw(s,i),s.endDrawCycle(0),i.endDrawCycle(0);var r=(new XMLSerializer).serializeToString(e),n=new Blob(['<?xml version="1.0" encoding="utf-8"?>\n'+r],{type:"image/svg;charset=utf-8"});if("function"!=typeof globalThis.saveAs)throw"Cannot save file; did you load the ./utils/savefile helper function and the eligrey/SaveFile library?";(0,globalThis.saveAs)(n,"plotboilerplate.svg")}_setToRetina(){this.config.autoDetectRetina=!0;const t=globalThis.devicePixelRatio||1;this.config.cssScaleX=this.config.cssScaleY=1/t,this.config.canvasWidthFactor=this.config.canvasHeightFactor=t,this.resizeCanvas(),this.updateCSSscale()}fitToView(t){const e=new a(this.canvasSize.width/2,this.canvasSize.height/2),s=this.canvasSize.width/this.canvasSize.height,i=t.width/t.height,r=new a(t.max.x-t.width/2,t.max.y-t.height/2).inv().addXY(this.canvasSize.width/2,this.canvasSize.height/2);if(this.setOffset(r),s<i){const s=this.canvasSize.width/t.width;this.setZoom(s,s,e)}else{const s=this.canvasSize.height/t.height;this.setZoom(s,s,e)}this.redraw()}setConsole(t){this.console=t}updateCSSscale(){var t,e,s,i;this.config.cssUniformScale?B.utils.setCSSscale(this.canvas,null!==(t=this.config.cssScaleX)&&void 0!==t?t:1,null!==(e=this.config.cssScaleX)&&void 0!==e?e:1):B.utils.setCSSscale(this.canvas,null!==(s=this.config.cssScaleX)&&void 0!==s?s:1,null!==(i=this.config.cssScaleY)&&void 0!==i?i:1)}add(t,e){if(Array.isArray(t)){const e=t;for(var s=0;s<e.length;s++)this.add(e[s],!1)}else if(t instanceof a)this.drawables.push(t),this.vertices.push(t);else if(t instanceof f)this.drawables.push(t),this.vertices.push(t.a),this.vertices.push(t.b);else if(t instanceof c)this.drawables.push(t),this.vertices.push(t.a),this.vertices.push(t.b);else if(t instanceof I)this.vertices.push(t.center),this.vertices.push(t.axis),this.drawables.push(t),t.center.listeners.addDragListener((e=>{t.axis.add(e.params.dragAmount)}));else if(t instanceof k)this.vertices.push(t.ellipse.center),this.vertices.push(t.ellipse.axis),this.drawables.push(t),t.ellipse.center.listeners.addDragListener((e=>{t.ellipse.axis.add(e.params.dragAmount)}));else if(t instanceof g)this.vertices.push(t.center),this.drawables.push(t);else if(t instanceof p)this.vertices.push(t.circle.center),this.drawables.push(t);else if(t instanceof o){this.drawables.push(t);for(s=0;s<t.vertices.length;s++)this.vertices.push(t.vertices[s])}else if(t instanceof w)this.drawables.push(t),this.vertices.push(t.a),this.vertices.push(t.b),this.vertices.push(t.c);else if(t instanceof d){this.drawables.push(t);const e=t;for(s=0;s<e.bezierCurves.length;s++)t.adjustCircular||0!=s||this.vertices.push(e.bezierCurves[s].startPoint),this.vertices.push(e.bezierCurves[s].endPoint),this.vertices.push(e.bezierCurves[s].startControlPoint),this.vertices.push(e.bezierCurves[s].endControlPoint),e.bezierCurves[s].startControlPoint.attr.selectable=!1,e.bezierCurves[s].endControlPoint.attr.selectable=!1;B.utils.enableBezierPathAutoAdjust(t)}else if(t instanceof N)this.vertices.push(t.upperLeft),this.vertices.push(t.lowerRight),this.drawables.push(t),t.upperLeft.listeners.addDragListener((e=>{t.lowerRight.add(e.params.dragAmount)})),t.lowerRight.attr.selectable=!1;else{if(!(t instanceof _))throw"Cannot add drawable of unrecognized type: "+typeof t+".";this.vertices.push(t.anchor),this.drawables.push(t),t.anchor.attr.selectable=!1}(e||void 0===e)&&this.redraw()}remove(t,e,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)this.remove(t[i],!1,s);e&&this.redraw()}else{t instanceof a&&(this.removeVertex(t,!1),e&&this.redraw());for(i=0;i<this.drawables.length;i++)if(this.drawables[i]===t||this.drawables[i].uid===t.uid){if(this.drawables.splice(i,1),s)if(t instanceof f)this.removeVertex(t.a,!1),this.removeVertex(t.b,!1);else if(t instanceof c)this.removeVertex(t.a,!1),this.removeVertex(t.b,!1);else if(t instanceof I)this.removeVertex(t.center,!1),this.removeVertex(t.axis,!1);else if(t instanceof k)this.removeVertex(t.ellipse.center),this.removeVertex(t.ellipse.axis);else if(t instanceof g)this.removeVertex(t.center,!1);else if(t instanceof p)this.removeVertex(t.circle.center,!1);else if(t instanceof o)for(i=0;i<t.vertices.length;i++)this.removeVertex(t.vertices[i],!1);else if(t instanceof w)this.removeVertex(t.a,!1),this.removeVertex(t.b,!1),this.removeVertex(t.c,!1);else if(t instanceof d)for(i=0;i<t.bezierCurves.length;i++)this.removeVertex(t.bezierCurves[i].startPoint,!1),this.removeVertex(t.bezierCurves[i].startControlPoint,!1),this.removeVertex(t.bezierCurves[i].endControlPoint,!1),i+1==t.bezierCurves.length&&this.removeVertex(t.bezierCurves[i].endPoint,!1);else t instanceof N?(this.removeVertex(t.upperLeft,!1),this.removeVertex(t.lowerRight,!1)):t instanceof _&&this.removeVertex(t.anchor,!1);e&&this.redraw()}}}removeVertex(t,e){for(var s=0;s<this.vertices.length;s++)if(this.vertices[s]===t)return this.vertices.splice(s,1),void(e&&this.redraw())}removeAll(t){this.drawables=[],Boolean(t)||(this.vertices=[]),this.redraw()}getVertexNear(t,e){var s,i;const r=this.locatePointNear(this.transformMousePosition(t.x,t.y),e/Math.min(null!==(s=this.config.cssScaleX)&&void 0!==s?s:1,null!==(i=this.config.cssScaleY)&&void 0!==i?i:1));if(r&&"vertex"==r.typeName)return this.vertices[r.vindex]}drawGrid(t){void 0===t&&(t=this.draw);const e=P.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.x)*this.config.rasterScaleX/this.config.cssScaleX,s=P.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.y)*this.config.rasterScaleY/this.config.cssScaleY;var i={width:this.grid.size.x*e,height:this.grid.size.y*s},r=this.canvasSize.width/2,n=this.canvasSize.height/2,a=this.draw.offset.clone().inv();a.x=Math.round(a.x+r)/Math.round(i.width)*i.width/this.draw.scale.x+(this.draw.offset.x-r)/this.draw.scale.x%i.width,a.y=Math.round(a.y+n)/Math.round(i.height)*i.height/this.draw.scale.y+(this.draw.offset.y-n)/this.draw.scale.x%i.height,this.drawConfig.drawGrid&&(t.setCurrentClassName(null),this.config.rasterGrid?(t.setCurrentId("raster"),t.raster(a,this.canvasSize.width/this.draw.scale.x,this.canvasSize.height/this.draw.scale.y,i.width,i.height,"rgba(0,128,255,0.125)")):(t.setCurrentId("grid"),t.grid(a,this.canvasSize.width/this.draw.scale.x,this.canvasSize.height/this.draw.scale.y,i.width,i.height,"rgba(0,128,255,0.095)")))}drawOrigin(t){t.setCurrentId("origin"),t.crosshair({x:0,y:0},10,this.drawConfig.origin.color)}_handleColor(t,e){return t.attr.isSelected?this.drawConfig.selectedVertex.color:t.attr.draggable?e:"rgba(128,128,128,0.5)"}drawDrawables(t,e,s){for(var i in this.drawables){var r=this.drawables[i];this.draw.setCurrentId(r.uid),this.fill.setCurrentId(r.uid),this.draw.setCurrentClassName(r.className),this.fill.setCurrentClassName(r.className),this.drawDrawable(r,t,e,s)}}drawDrawable(t,e,s,i){if(t instanceof d){var r=0;for(var n in t.bezierCurves){if(this.draw.setCurrentId(`${t.uid}-${r}`),this.fill.setCurrentId(`${t.uid}-${r}`),this.draw.setCurrentClassName(t.className),this.fill.setCurrentClassName(t.className),s.cubicBezier(t.bezierCurves[n].startPoint,t.bezierCurves[n].endPoint,t.bezierCurves[n].startControlPoint,t.bezierCurves[n].endControlPoint,this.drawConfig.bezier.color,this.drawConfig.bezier.lineWidth),this.drawConfig.drawBezierHandlePoints&&this.drawConfig.drawHandlePoints){if(t.bezierCurves[n].startPoint.attr.visible){const e=this.drawConfig.bezier.pathVertex.fill?i:s;e.setCurrentId(`${t.uid}_h0`),e.setCurrentClassName(`${t.className}-start-handle`),t.bezierCurves[n].startPoint.attr.bezierAutoAdjust?e.squareHandle(t.bezierCurves[n].startPoint,5,this._handleColor(t.bezierCurves[n].startPoint,this.drawConfig.bezier.pathVertex.color)):e.diamondHandle(t.bezierCurves[n].startPoint,7,this._handleColor(t.bezierCurves[n].startPoint,this.drawConfig.bezier.pathVertex.color))}if(t.bezierCurves[n].startPoint.attr.renderTime=e,t.bezierCurves[n].endPoint.attr.visible){const e=this.drawConfig.bezier.pathVertex.fill?i:s;e.setCurrentId(`${t.uid}_h0`),e.setCurrentClassName(`${t.className}-start-handle`),t.bezierCurves[n].endPoint.attr.bezierAutoAdjust?e.squareHandle(t.bezierCurves[n].endPoint,5,this._handleColor(t.bezierCurves[n].endPoint,this.drawConfig.bezier.pathVertex.color)):e.diamondHandle(t.bezierCurves[n].endPoint,7,this._handleColor(t.bezierCurves[n].endPoint,this.drawConfig.bezier.pathVertex.color))}if(t.bezierCurves[n].startControlPoint.attr.visible){const e=this.drawConfig.bezier.controlVertex.fill?i:s;e.setCurrentId(`${t.uid}_h2`),e.setCurrentClassName(`${t.className}-start-control-handle`),e.circleHandle(t.bezierCurves[n].startControlPoint,3,this._handleColor(t.bezierCurves[n].startControlPoint,this.drawConfig.bezier.controlVertex.color))}if(t.bezierCurves[n].endControlPoint.attr.visible){const e=this.drawConfig.bezier.controlVertex.fill?i:s;e.setCurrentId(`${t.uid}_h3`),e.setCurrentClassName(`${t.className}-end-control-handle`),e.circleHandle(t.bezierCurves[n].endControlPoint,3,this._handleColor(t.bezierCurves[n].endControlPoint,this.drawConfig.bezier.controlVertex.color))}t.bezierCurves[n].startPoint.attr.renderTime=e,t.bezierCurves[n].endPoint.attr.renderTime=e,t.bezierCurves[n].startControlPoint.attr.renderTime=e,t.bezierCurves[n].endControlPoint.attr.renderTime=e}else t.bezierCurves[n].startPoint.attr.renderTime=e,t.bezierCurves[n].endPoint.attr.renderTime=e,t.bezierCurves[n].startControlPoint.attr.renderTime=e,t.bezierCurves[n].endControlPoint.attr.renderTime=e;this.drawConfig.drawBezierHandleLines&&this.drawConfig.drawHandleLines&&(s.setCurrentId(`${t.uid}_l0`),s.setCurrentClassName(`${t.className}-start-line`),s.line(t.bezierCurves[n].startPoint,t.bezierCurves[n].startControlPoint,this.drawConfig.bezier.handleLine.color,this.drawConfig.bezier.handleLine.lineWidth),s.setCurrentId(`${t.uid}_l1`),s.setCurrentClassName(`${t.className}-end-line`),s.line(t.bezierCurves[n].endPoint,t.bezierCurves[n].endControlPoint,this.drawConfig.bezier.handleLine.color,this.drawConfig.bezier.handleLine.lineWidth)),r++}}else if(t instanceof o){if(s.polygon(t,this.drawConfig.polygon.color,this.drawConfig.polygon.lineWidth),!this.drawConfig.drawHandlePoints)for(var h in t.vertices)t.vertices[h].attr.renderTime=e}else if(t instanceof w)s.polyline([t.a,t.b,t.c],!1,this.drawConfig.triangle.color,this.drawConfig.triangle.lineWidth),this.drawConfig.drawHandlePoints||(t.a.attr.renderTime=t.b.attr.renderTime=t.c.attr.renderTime=e);else if(t instanceof I)this.drawConfig.drawHandleLines&&(s.setCurrentId(`${t.uid}_e0`),s.setCurrentClassName(`${t.className}-v-line`),s.line(t.center.clone().add(0,t.signedRadiusV()).rotate(t.rotation,t.center),t.axis,"#c8c8c8"),s.setCurrentId(`${t.uid}_e1`),s.setCurrentClassName(`${t.className}-h-line`),s.line(t.center.clone().add(t.signedRadiusH(),0).rotate(t.rotation,t.center),t.axis,"#c8c8c8")),s.setCurrentId(t.uid),s.setCurrentClassName(`${t.className}`),s.ellipse(t.center,t.radiusH(),t.radiusV(),this.drawConfig.ellipse.color,this.drawConfig.ellipse.lineWidth,t.rotation),this.drawConfig.drawHandlePoints||(t.center.attr.renderTime=e,t.axis.attr.renderTime=e);else if(t instanceof k){s.setCurrentId(t.uid),s.setCurrentClassName(`${t.className}`);const e=k.ellipseSectorUtils.describeSVGArc(t.ellipse.center.x,t.ellipse.center.y,t.ellipse.radiusH(),t.ellipse.radiusV(),t.startAngle,t.endAngle,t.ellipse.rotation,{moveToStart:!0});s.path(e,this.drawConfig.ellipseSector.color,this.drawConfig.ellipseSector.lineWidth)}else t instanceof g?s.circle(t.center,t.radius,this.drawConfig.circle.color,this.drawConfig.circle.lineWidth):t instanceof p?s.circleArc(t.circle.center,t.circle.radius,t.startAngle,t.endAngle,this.drawConfig.circleSector.color,this.drawConfig.circleSector.lineWidth):t instanceof a?!this.drawConfig.drawVertices||t.attr.selectable&&t.attr.draggable||!t.attr.visible||(s.circleHandle(t,7,this.drawConfig.vertex.color),t.attr.renderTime=e):t instanceof f?(s.line(t.a,t.b,this.drawConfig.line.color,this.drawConfig.line.lineWidth),this.drawConfig.drawHandlePoints&&t.a.attr.selectable||(t.a.attr.renderTime=e),this.drawConfig.drawHandlePoints&&t.b.attr.selectable||(t.b.attr.renderTime=e)):t instanceof c?(s.arrow(t.a,t.b,this.drawConfig.vector.color),this.drawConfig.drawHandlePoints&&t.b.attr.selectable&&t.b.attr.visible?(s.setCurrentId(`${t.uid}_h0`),s.setCurrentClassName(`${t.className}-handle`),s.circleHandle(t.b,3,"#a8a8a8")):t.b.attr.renderTime=e,this.drawConfig.drawHandlePoints&&t.a.attr.selectable||(t.a.attr.renderTime=e),this.drawConfig.drawHandlePoints&&t.b.attr.selectable||(t.b.attr.renderTime=e)):t instanceof N?(this.drawConfig.drawHandleLines&&(s.setCurrentId(`${t.uid}_l0`),s.setCurrentClassName(`${t.className}-line`),s.line(t.upperLeft,t.lowerRight,this.drawConfig.image.color,this.drawConfig.image.lineWidth)),i.setCurrentId(t.uid),i.image(t.image,t.upperLeft,t.lowerRight.clone().sub(t.upperLeft)),this.drawConfig.drawHandlePoints&&(s.setCurrentId(`${t.uid}_h0`),s.setCurrentClassName(`${t.className}-lower-right`),s.circleHandle(t.lowerRight,3,this.drawConfig.image.color),t.lowerRight.attr.renderTime=e)):t instanceof _?(i.setCurrentId(t.uid),i.text(t.text,t.anchor.x,t.anchor.y,t),this.drawConfig.text.anchor&&(s.setCurrentId(`${t.uid}_a0`),s.setCurrentClassName(`${t.className}-anchor`),(this.drawConfig.text.fill?i:s).point(t.anchor,this.drawConfig.text.color)),t.anchor.attr.renderTime=e):console.error("Cannot draw object. Unknown class.");s.setCurrentClassName(null),s.setCurrentId(null),i.setCurrentClassName(null),i.setCurrentId(null)}drawSelectPolygon(t){null!=this.selectPolygon&&this.selectPolygon.vertices.length>0&&(t.setCurrentId(this.selectPolygon.uid),t.polygon(this.selectPolygon,"#888888"),t.crosshair(this.selectPolygon.vertices[0],3,"#008888"))}drawVertices(t,e){for(var s in this.vertices)this.drawConfig.drawVertices&&this.vertices[s].attr.renderTime!=t&&this.vertices[s].attr.visible&&(e.setCurrentId(this.vertices[s].uid),e.squareHandle(this.vertices[s],5,this._handleColor(this.vertices[s],"rgb(0,128,192)")),this.vertices[s].attr.renderTime=t)}redraw(){const t=this.renderTime++;this.draw.beginDrawCycle(t),this.fill.beginDrawCycle(t),this.config.preClear&&this.config.preClear(),this.clear(),this.config.preDraw&&this.config.preDraw(this.draw,this.fill),this.drawAll(t,this.draw,this.fill),this.config.postDraw&&this.config.postDraw(this.draw,this.fill),this.draw.endDrawCycle(t),this.fill.endDrawCycle(t)}drawAll(t,e,s){this.config.drawRaster&&this.drawGrid(e),this.config.drawOrigin&&this.drawOrigin(e),this.drawDrawables(t,e,s),this.drawVertices(t,e),this.drawSelectPolygon(e),e.setCurrentId(null),e.setCurrentClassName(null)}clear(){this.draw.clear(this.config.backgroundColor||"white")}clearSelection(t){for(var e in this.vertices)this.vertices[e].attr.isSelected=!1;return t&&this.redraw(),this}viewport(){var t,e;return new h(this.transformMousePosition(0,0),this.transformMousePosition(this.canvasSize.width*(null!==(t=this.config.cssScaleX)&&void 0!==t?t:1),this.canvasSize.height*(null!==(e=this.config.cssScaleY)&&void 0!==e?e:1)))}saveFile(){this.hooks.saveFile(this)}getFProp(t,e){return parseFloat(globalThis.getComputedStyle(t,null).getPropertyValue(e))}getAvailableContainerSpace(){const t=this,e=t.canvas.parentNode;t.canvas.style.display="none";var s=this.getFProp(e,"padding")||0,i=this.getFProp(t.canvas,"border-width")||0,r=this.getFProp(e,"padding-left")||s,n=this.getFProp(e,"padding-right")||s,a=this.getFProp(e,"padding-top")||s,o=this.getFProp(e,"padding-bottom")||s,h=this.getFProp(t.canvas,"border-left-width")||i,l=this.getFProp(t.canvas,"border-right-width")||i,c=this.getFProp(t.canvas,"border-top-width")||i,u=this.getFProp(t.canvas,"border-bottom-width")||i,d=e.clientWidth,f=e.clientHeight;return t.canvas.style.display="block",{width:d-r-n-h-l,height:f-a-o-c-u}}resizeCanvas(){var t,e,s,i,r,n;const a=this,o=(t,e)=>{var s,i;t*=null!==(s=a.config.canvasWidthFactor)&&void 0!==s?s:1,e*=null!==(i=a.config.canvasHeightFactor)&&void 0!==i?i:1,a.canvasSize.width=t,a.canvasSize.height=e,a.canvas instanceof HTMLCanvasElement?(a.canvas.width=t,a.canvas.height=e):a.canvas instanceof SVGElement?(this.canvas.setAttribute("viewBox",`0 0 ${t} ${e}`),this.canvas.setAttribute("width",`${t}`),this.canvas.setAttribute("height",`${e}`),this.draw.setSize(a.canvasSize),this.eventCatcher.style.width=`${t}px`,this.eventCatcher.style.height=`${e}px`):console.error("Error: cannot resize canvas element because it seems neither be a HTMLCanvasElement nor an SVGElement."),a.config.autoAdjustOffset&&a.adjustOffset(!1)};if(a.config.fullSize&&!a.config.fitToParent){var h=globalThis.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=globalThis.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;a.canvas.style.position="absolute",a.canvas.style.width=(null!==(t=a.config.canvasWidthFactor)&&void 0!==t?t:1)*h+"px",a.canvas.style.height=(null!==(e=a.config.canvasWidthFactor)&&void 0!==e?e:1)*l+"px",a.canvas.style.top="0px",a.canvas.style.left="0px",o(h,l)}else if(a.config.fitToParent){a.canvas.style.position="static";const t=this.getAvailableContainerSpace();a.canvas.style.width=(null!==(s=a.config.canvasWidthFactor)&&void 0!==s?s:1)*t.width+"px",a.canvas.style.height=(null!==(i=a.config.canvasHeightFactor)&&void 0!==i?i:1)*t.height+"px",a.canvas.style.top="",a.canvas.style.left="",o(t.width,t.height)}else a.canvas.style.width="",a.canvas.style.height="",o(null!==(r=a.config.defaultCanvasWidth)&&void 0!==r?r:1024,null!==(n=a.config.defaultCanvasHeight)&&void 0!==n?n:768);a.config.redrawOnResize&&a.redraw()}selectVerticesInPolygon(t){for(var e in this.vertices)this.vertices[e].attr.selectable&&t.containsVert(this.vertices[e])&&(this.vertices[e].attr.isSelected=!0)}locatePointNear(t,e){const s=this;void 0===e&&(e=7),e/=s.draw.scale.x;for(var i=0;i<s.vertices.length;i++){var r=s.vertices[i];if((r.attr.draggable||r.attr.selectable)&&r.distance(t)<e)return new B.Draggable(r,B.Draggable.VERTEX).setVIndex(i)}return null}handleClick(t){const e=this;var s=this.locatePointNear(e.transformMousePosition(t.params.pos.x,t.params.pos.y),B.DEFAULT_CLICK_TOLERANCE/Math.min(e.config.cssScaleX||1,e.config.cssScaleY||1));if(s)if(e.vertices[s.vindex].listeners.fireClickEvent(t),this.keyHandler&&this.keyHandler.isDown("shift")){if("bpath"==s.typeName){let t=e.paths[s.pindex].bezierCurves[s.cindex].getPointByID(s.pid);t.attr.selectable&&(t.attr.isSelected=!t.attr.isSelected)}else if("vertex"==s.typeName){let t=e.vertices[s.vindex];t.attr.selectable&&(t.attr.isSelected=!t.attr.isSelected)}e.redraw()}else this.keyHandler&&this.keyHandler.isDown("y")&&(e.vertices[s.vindex].attr.bezierAutoAdjust=!e.vertices[s.vindex].attr.bezierAutoAdjust,e.redraw());else if(null!=e.selectPolygon){const s=e.transformMousePosition(t.params.pos.x,t.params.pos.y);e.selectPolygon.vertices.push(new a(s.x,s.y)),e.redraw()}}transformMousePosition(t,e){return{x:(t/this.config.cssScaleX-this.config.offsetX)/this.config.scaleX,y:(e/this.config.cssScaleY-this.config.offsetY)/this.config.scaleY}}revertMousePosition(t,e){return{x:t/this.config.cssScaleX+this.config.offsetX,y:e/this.config.cssScaleY+this.config.offsetY}}getDraggedElementCount(){return this.draggedElements.length}mouseDownHandler(t){const e=this;if(0==t.button){var s=e.locatePointNear(e.transformMousePosition(t.params.pos.x,t.params.pos.y),B.DEFAULT_CLICK_TOLERANCE/Math.min(e.config.cssScaleX,e.config.cssScaleY));if(s){if("vertex"==s.typeName&&e.vertices[s.vindex].attr.isSelected)for(var i=0;i<e.vertices.length;i++)e.vertices[i].attr.isSelected&&(e.draggedElements.push(new B.Draggable(e.vertices[i],B.Draggable.VERTEX).setVIndex(i)),e.vertices[i].listeners.fireDragStartEvent(t));else{if(!e.vertices[s.vindex].attr.draggable)return;e.draggedElements.push(s),"bpath"==s.typeName?e.paths[s.pindex].bezierCurves[s.cindex].getPointByID(s.pid).listeners.fireDragStartEvent(t):"vertex"==s.typeName&&e.vertices[s.vindex].listeners.fireDragStartEvent(t)}e.redraw()}}}mouseDragHandler(t){const e=this,s={x:t.params.dragAmount.x,y:t.params.dragAmount.y};if(t.params.dragAmount.x/=e.config.cssScaleX,t.params.dragAmount.y/=e.config.cssScaleY,this.keyHandler&&(this.keyHandler.isDown("alt")||this.keyHandler.isDown("spacebar"))){if(!this.config.enablePan)return;e.setOffset(e.draw.offset.clone().add(t.params.dragAmount)),e.redraw()}else for(var i in t.params.dragAmount.x/=e.draw.scale.x,t.params.dragAmount.y/=e.draw.scale.y,e.draggedElements){var r=e.draggedElements[i];if("bpath"==r.typeName)e.paths[r.pindex].moveCurvePoint(r.cindex,r.pid,new a(t.params.dragAmount.x,t.params.dragAmount.y)),e.paths[r.pindex].bezierCurves[r.cindex].getPointByID(r.pid).listeners.fireDragEvent(t);else if("vertex"==r.typeName){if(!e.vertices[r.vindex].attr.draggable)continue;e.vertices[r.vindex].add(t.params.dragAmount),e.vertices[r.vindex].listeners.fireDragEvent(t)}}t.params.dragAmount.x=s.x,t.params.dragAmount.y=s.y,e.redraw()}mouseUpHandler(t){const e=this;if(0==t.button){for(var s in t.params.wasDragged||e.handleClick(t),e.draggedElements){var i=e.draggedElements[s];"bpath"==i.typeName?e.paths[i.pindex].bezierCurves[i.cindex].getPointByID(i.pid).listeners.fireDragEndEvent(t):"vertex"==i.typeName&&e.vertices[i.vindex].listeners.fireDragEndEvent(t)}e.draggedElements=[],e.redraw()}}mouseWheelHandler(t){if(!this.config.enableZoom)return;var e=1.25;const s=this,i=t;i.deltaY<0?s.setZoom(s.config.scaleX*e,s.config.scaleY*e,new a(t.params.pos.x,t.params.pos.y)):i.deltaY>0&&s.setZoom(s.config.scaleX/e,s.config.scaleY/e,new a(t.params.pos.x,t.params.pos.y)),t.preventDefault(),s.redraw()}adjustOffset(t){this.draw.offset.x=this.fill.offset.x=this.config.offsetX=this.canvasSize.width*(this.config.offsetAdjustXPercent/100),this.draw.offset.y=this.fill.offset.y=this.config.offsetY=this.canvasSize.height*(this.config.offsetAdjustYPercent/100),t&&this.redraw()}setOffset(t){this.draw.offset.set(t),this.fill.offset.set(t),this.config.offsetX=t.x,this.config.offsetY=t.y}setZoom(t,e,s){let i=this.transformMousePosition(s.x,s.y);this.draw.scale.x=this.fill.scale.x=this.config.scaleX=Math.max(t,.01),this.draw.scale.y=this.fill.scale.y=this.config.scaleY=Math.max(e,.01);let r=this.transformMousePosition(s.x,s.y),n=this.draw.offset.x+(r.x-i.x)*this.draw.scale.x,a=this.draw.offset.y+(r.y-i.y)*this.draw.scale.y;this.setOffset({x:n,y:a})}installInputListeners(){var t=this;if(this.config.enableMouse?new E(this.eventCatcher?this.eventCatcher:this.canvas).down((e=>{t.mouseDownHandler(e)})).drag((e=>{t.mouseDragHandler(e)})).up((e=>{t.mouseUpHandler(e)})):t.console.log("Mouse interaction disabled."),this.config.enableMouseWheel?new E(this.eventCatcher?this.eventCatcher:this.canvas).wheel((e=>{t.mouseWheelHandler(e)})):t.console.log("Mouse wheel interaction disabled."),this.config.enableTouch){const n=e=>{const s=t.canvas.getBoundingClientRect();return{x:e.x-s.left,y:e.y-s.top}};if("function"==typeof globalThis.AlloyFinger||"function"==typeof globalThis.createAlloyFinger)try{var e=null,s=null,i=null,r=null;const o=()=>{e=null,s=null,i=null,r=null,t.draggedElements=[]},h={touchStart:r=>{if(1==r.touches.length&&(e=new a(n({x:r.touches[0].clientX,y:r.touches[0].clientY})),s=new a(n({x:r.touches[0].clientX,y:r.touches[0].clientY})),(i=t.locatePointNear(t.transformMousePosition(e.x,e.y),B.DEFAULT_TOUCH_TOLERANCE/Math.min(t.config.cssScaleX,t.config.cssScaleY)))&&"vertex"==i.typeName)){var o=t.vertices[i.vindex],h={params:{isTouchEvent:!0,dragAmount:{x:0,y:0},wasDragged:!1,mouseDownPos:s.clone(),mouseDragPos:s.clone(),vertex:o}};t.draggedElements=[i],o.listeners.fireDragStartEvent(h)}},touchMove:r=>{if(1==r.touches.length&&i){if(r.preventDefault(),r.stopPropagation(),!s||!e)return;var o=n({x:r.touches[0].clientX,y:r.touches[0].clientY}),h=t.transformMousePosition(o.x,o.y),l=new a(t.transformMousePosition(e.x,e.y)).difference(h);if("vertex"==i.typeName){if(!t.vertices[i.vindex].attr.draggable)return;t.vertices[i.vindex].add(l);var c=t.vertices[i.vindex],u={isTouchEvent:!0,params:{dragAmount:l.clone(),wasDragged:!0,mouseDownPos:s.clone(),mouseDragPos:s.clone().add(l),vertex:c}};c.listeners.fireDragEvent(u),t.redraw()}e=new a(o)}else if(2==r.touches.length){if(!this.config.enablePan)return;r.preventDefault(),r.stopPropagation(),t.setOffset(t.draw.offset.clone().addXY(r.deltaX,r.deltaY)),t.redraw()}},touchEnd:r=>{if(i&&"vertex"==i.typeName){if(!s)return;var n=t.vertices[i.vindex],a={isTouchEvent:!0,params:{dragAmount:{x:0,y:0},wasDragged:!1,mouseDownPos:s.clone(),mouseDragPos:s.clone(),vertex:n}};e&&s&&s.distance(e)<.001?n.listeners.fireClickEvent(a):n.listeners.fireDragEndEvent(a)}o()},touchCancel:t=>{o()},multipointStart:e=>{r=t.draw.scale.clone()},multipointEnd:t=>{r=null},pinch:e=>{if(!this.config.enableZoom)return;const s=e.touches.item(0),i=e.touches.item(1);if(!(e.touches&&r&&s&&i))return;const n=new a(s.clientX,s.clientY),o=new a(i.clientX,i.clientY),h=new f(n,o).vertAt(.5);t.setZoom(r.x*e.zoom,r.y*e.zoom,h),t.redraw()}};window.createAlloyFinger?window.createAlloyFinger(this.eventCatcher?this.eventCatcher:this.canvas,h):new R(this.eventCatcher?this.eventCatcher:this.canvas,h)}catch(t){console.error("Failed to initialize AlloyFinger!"),console.error(t)}else globalThis.Touchy&&"function"==typeof globalThis.Touchy?console.error("[Deprecation] Found Touchy which is not supported any more. Please use AlloyFinger instead."):console.warn("Cannot initialize the touch handler. AlloyFinger is missig. Did you include it?")}else t.console.log("Touch interaction disabled.");this.config.enableKeys?this.keyHandler=new S({trackAll:!0}).down("escape",(function(){t.clearSelection(!0)})).down("shift",(function(){t.selectPolygon=new o,t.redraw()})).up("shift",(function(){null!=t.selectPolygon&&(t.selectVerticesInPolygon(t.selectPolygon),t.selectPolygon=null,t.redraw())})):t.console.log("Keyboard interaction disabled.")}createGUI(t){if(globalThis.utils&&"function"==typeof globalThis.utils.createGUI)return globalThis.utils.createGUI(this,t);throw"Cannot create dat.GUI instance; did you load the ./utils/creategui helper function an the dat.GUI library?"}}B.DEFAULT_CANVAS_WIDTH=1024,B.DEFAULT_CANVAS_HEIGHT=768,B.DEFAULT_CLICK_TOLERANCE=8,B.DEFAULT_TOUCH_TOLERANCE=32,B.Draggable=((F=class{constructor(t,e){this.item=t,this.typeName=e}isVertex(){return this.typeName==B.Draggable.VERTEX}setVIndex(t){return this.vindex=t,this}}).VERTEX="vertex",F),B.utils={safeMergeByKeys:(t,e)=>{for(var s in e)if(e.hasOwnProperty(s))if(t.hasOwnProperty(s)){var i=typeof t[s];try{"boolean"==i?t[s]=!!JSON.parse(e[s]):"number"==i?t[s]=1*JSON.parse(e[s]):("function"==i&&e[s],t[s]=e[s])}catch(t){console.error("error in key ",s,e[s],t)}}else t[s]=e[s];return t},setCSSscale:(t,e,s)=>{t.style["transform-origin"]="0 0",1==e&&1==s?t.style.removeProperty("transform"):t.style.transform="scale("+e+","+s+")"},fetch:{val:(t,e,s)=>t.hasOwnProperty(e)?void 0===t[e]?s:t[e]:s,num:(t,e,s)=>{if(!t.hasOwnProperty(e))return s;if("number"==typeof t[e])return t[e];try{return 1*JSON.parse(t[e])}catch(t){return s}},bool:(t,e,s)=>{if(!t.hasOwnProperty(e))return s;if("boolean"==typeof t[e])return t[e];try{return!!JSON.parse(t[e])}catch(t){return s}},func:(t,e,s)=>t.hasOwnProperty(e)?"function"!=typeof t[e]?s:t[e]:s},enableBezierPathAutoAdjust:t=>{for(var e=0;e<t.bezierCurves.length;e++)t.bezierCurves[e].startPoint.listeners.addDragListener((function(e){var s=t.locateCurveByStartPoint(e.params.vertex);t.bezierCurves[s].startPoint.addXY(-e.params.dragAmount.x,-e.params.dragAmount.y),t.moveCurvePoint(1*s,t.START_POINT,e.params.dragAmount),t.updateArcLengths()})),t.bezierCurves[e].startControlPoint.listeners.addDragListener((function(e){var s=t.locateCurveByStartControlPoint(e.params.vertex);t.bezierCurves[s].startPoint.attr.bezierAutoAdjust&&(t.adjustPredecessorControlPoint(1*s,!0,!1),t.updateArcLengths())})),t.bezierCurves[e].endControlPoint.listeners.addDragListener((function(e){var s=t.locateCurveByEndControlPoint(e.params.vertex);t.bezierCurves[s%t.bezierCurves.length].endPoint.attr.bezierAutoAdjust&&(t.adjustSuccessorControlPoint(1*s,!0,!1),t.updateArcLengths())})),e+1==t.bezierCurves.length&&t.bezierCurves[t.bezierCurves.length-1].endPoint.listeners.addDragListener((function(e){if(!t.adjustCircular){var s=t.locateCurveByEndPoint(e.params.vertex);t.moveCurvePoint(1*s,t.END_CONTROL_POINT,new a({x:e.params.dragAmount.x,y:e.params.dragAmount.y}))}t.updateArcLengths()}))}}},218:(t,e,s)=>{function i(t,e){return function(){return t.apply(e,arguments)}}const{toString:r}=Object.prototype,{getPrototypeOf:n}=Object,a=(o=Object.create(null),t=>{const e=r.call(t);return o[e]||(o[e]=e.slice(8,-1).toLowerCase())});var o;const h=t=>(t=t.toLowerCase(),e=>a(e)===t),l=t=>e=>typeof e===t,{isArray:c}=Array,u=l("undefined");const d=h("ArrayBuffer");const f=l("string"),g=l("function"),p=l("number"),y=t=>null!==t&&"object"==typeof t,v=t=>{if("object"!==a(t))return!1;const e=n(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)},m=h("Date"),x=h("File"),b=h("Blob"),w=h("FileList"),C=h("URLSearchParams");function P(t,e,{allOwnKeys:s=!1}={}){if(null==t)return;let i,r;if("object"!=typeof t&&(t=[t]),c(t))for(i=0,r=t.length;i<r;i++)e.call(null,t[i],i,t);else{const r=s?Object.getOwnPropertyNames(t):Object.keys(t),n=r.length;let a;for(i=0;i<n;i++)a=r[i],e.call(null,t[a],a,t)}}function S(t,e){e=e.toLowerCase();const s=Object.keys(t);let i,r=s.length;for(;r-- >0;)if(i=s[r],e===i.toLowerCase())return i;return null}const A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:s.g,T=t=>!u(t)&&t!==A;const E=(N="undefined"!=typeof Uint8Array&&n(Uint8Array),t=>N&&t instanceof N);var N;const _=h("HTMLFormElement"),D=(({hasOwnProperty:t})=>(e,s)=>t.call(e,s))(Object.prototype),L=h("RegExp"),z=(t,e)=>{const s=Object.getOwnPropertyDescriptors(t),i={};P(s,((s,r)=>{!1!==e(s,r,t)&&(i[r]=s)})),Object.defineProperties(t,i)},M="abcdefghijklmnopqrstuvwxyz",O="0123456789",R={DIGIT:O,ALPHA:M,ALPHA_DIGIT:M+M.toUpperCase()+O};const I=h("AsyncFunction");var k={isArray:c,isArrayBuffer:d,isBuffer:function(t){return null!==t&&!u(t)&&null!==t.constructor&&!u(t.constructor)&&g(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&("function"==typeof FormData&&t instanceof FormData||g(t.append)&&("formdata"===(e=a(t))||"object"===e&&g(t.toString)&&"[object FormData]"===t.toString()))},isArrayBufferView:function(t){let e;return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&d(t.buffer),e},isString:f,isNumber:p,isBoolean:t=>!0===t||!1===t,isObject:y,isPlainObject:v,isUndefined:u,isDate:m,isFile:x,isBlob:b,isRegExp:L,isFunction:g,isStream:t=>y(t)&&g(t.pipe),isURLSearchParams:C,isTypedArray:E,isFileList:w,forEach:P,merge:function t(){const{caseless:e}=T(this)&&this||{},s={},i=(i,r)=>{const n=e&&S(s,r)||r;v(s[n])&&v(i)?s[n]=t(s[n],i):v(i)?s[n]=t({},i):c(i)?s[n]=i.slice():s[n]=i};for(let t=0,e=arguments.length;t<e;t++)arguments[t]&&P(arguments[t],i);return s},extend:(t,e,s,{allOwnKeys:r}={})=>(P(e,((e,r)=>{s&&g(e)?t[r]=i(e,s):t[r]=e}),{allOwnKeys:r}),t),trim:t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(65279===t.charCodeAt(0)&&(t=t.slice(1)),t),inherits:(t,e,s,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,e,s,i)=>{let r,a,o;const h={};if(e=e||{},null==t)return e;do{for(r=Object.getOwnPropertyNames(t),a=r.length;a-- >0;)o=r[a],i&&!i(o,t,e)||h[o]||(e[o]=t[o],h[o]=!0);t=!1!==s&&n(t)}while(t&&(!s||s(t,e))&&t!==Object.prototype);return e},kindOf:a,kindOfTest:h,endsWith:(t,e,s)=>{t=String(t),(void 0===s||s>t.length)&&(s=t.length),s-=e.length;const i=t.indexOf(e,s);return-1!==i&&i===s},toArray:t=>{if(!t)return null;if(c(t))return t;let e=t.length;if(!p(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=t[e];return s},forEachEntry:(t,e)=>{const s=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=s.next())&&!i.done;){const s=i.value;e.call(t,s[0],s[1])}},matchAll:(t,e)=>{let s;const i=[];for(;null!==(s=t.exec(e));)i.push(s);return i},isHTMLForm:_,hasOwnProperty:D,hasOwnProp:D,reduceDescriptors:z,freezeMethods:t=>{z(t,((e,s)=>{if(g(t)&&-1!==["arguments","caller","callee"].indexOf(s))return!1;const i=t[s];g(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))}))},toObjectSet:(t,e)=>{const s={},i=t=>{t.forEach((t=>{s[t]=!0}))};return c(t)?i(t):i(String(t).split(e)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,e,s){return e.toUpperCase()+s})),noop:()=>{},toFiniteNumber:(t,e)=>(t=+t,Number.isFinite(t)?t:e),findKey:S,global:A,isContextDefined:T,ALPHABET:R,generateString:(t=16,e=R.ALPHA_DIGIT)=>{let s="";const{length:i}=e;for(;t--;)s+=e[Math.random()*i|0];return s},isSpecCompliantForm:function(t){return!!(t&&g(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),s=(t,i)=>{if(y(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[i]=t;const r=c(t)?[]:{};return P(t,((t,e)=>{const n=s(t,i+1);!u(n)&&(r[e]=n)})),e[i]=void 0,r}}return t};return s(t,0)},isAsyncFn:I,isThenable:t=>t&&(y(t)||g(t))&&g(t.then)&&g(t.catch)};function F(t,e,s,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),i&&(this.request=i),r&&(this.response=r)}k.inherits(F,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:k.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const B=F.prototype,H={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((t=>{H[t]={value:t}})),Object.defineProperties(F,H),Object.defineProperty(B,"isAxiosError",{value:!0}),F.from=(t,e,s,i,r,n)=>{const a=Object.create(B);return k.toFlatObject(t,a,(function(t){return t!==Error.prototype}),(t=>"isAxiosError"!==t)),F.call(a,t.message,e,s,i,r),a.cause=t,a.name=t.name,n&&Object.assign(a,n),a};function j(t){return k.isPlainObject(t)||k.isArray(t)}function V(t){return k.endsWith(t,"[]")?t.slice(0,-2):t}function U(t,e,s){return t?t.concat(e).map((function(t,e){return t=V(t),!s&&e?"["+t+"]":t})).join(s?".":""):e}const $=k.toFlatObject(k,{},null,(function(t){return/^is[A-Z]/.test(t)}));function q(t,e,s){if(!k.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(s=k.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(t,e){return!k.isUndefined(e[t])}))).metaTokens,r=s.visitor||l,n=s.dots,a=s.indexes,o=(s.Blob||"undefined"!=typeof Blob&&Blob)&&k.isSpecCompliantForm(e);if(!k.isFunction(r))throw new TypeError("visitor must be a function");function h(t){if(null===t)return"";if(k.isDate(t))return t.toISOString();if(!o&&k.isBlob(t))throw new F("Blob is not supported. Use a Buffer instead.");return k.isArrayBuffer(t)||k.isTypedArray(t)?o&&"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}function l(t,s,r){let o=t;if(t&&!r&&"object"==typeof t)if(k.endsWith(s,"{}"))s=i?s:s.slice(0,-2),t=JSON.stringify(t);else if(k.isArray(t)&&function(t){return k.isArray(t)&&!t.some(j)}(t)||(k.isFileList(t)||k.endsWith(s,"[]"))&&(o=k.toArray(t)))return s=V(s),o.forEach((function(t,i){!k.isUndefined(t)&&null!==t&&e.append(!0===a?U([s],i,n):null===a?s:s+"[]",h(t))})),!1;return!!j(t)||(e.append(U(r,s,n),h(t)),!1)}const c=[],u=Object.assign($,{defaultVisitor:l,convertValue:h,isVisitable:j});if(!k.isObject(t))throw new TypeError("data must be an object");return function t(s,i){if(!k.isUndefined(s)){if(-1!==c.indexOf(s))throw Error("Circular reference detected in "+i.join("."));c.push(s),k.forEach(s,(function(s,n){!0===(!(k.isUndefined(s)||null===s)&&r.call(e,s,k.isString(n)?n.trim():n,i,u))&&t(s,i?i.concat(n):[n])})),c.pop()}}(t),e}function W(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(t){return e[t]}))}function G(t,e){this._pairs=[],t&&q(t,this,e)}const X=G.prototype;function Y(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function J(t,e,s){if(!e)return t;const i=s&&s.encode||Y,r=s&&s.serialize;let n;if(n=r?r(e,s):k.isURLSearchParams(e)?e.toString():new G(e,s).toString(i),n){const e=t.indexOf("#");-1!==e&&(t=t.slice(0,e)),t+=(-1===t.indexOf("?")?"?":"&")+n}return t}X.append=function(t,e){this._pairs.push([t,e])},X.toString=function(t){const e=t?function(e){return t.call(this,e,W)}:W;return this._pairs.map((function(t){return e(t[0])+"="+e(t[1])}),"").join("&")};var K=class{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){k.forEach(this.handlers,(function(e){null!==e&&t(e)}))}},Z={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var Q={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:G,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let t;return("undefined"==typeof navigator||"ReactNative"!==(t=navigator.product)&&"NativeScript"!==t&&"NS"!==t)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};function tt(t){function e(t,s,i,r){let n=t[r++];const a=Number.isFinite(+n),o=r>=t.length;if(n=!n&&k.isArray(i)?i.length:n,o)return k.hasOwnProp(i,n)?i[n]=[i[n],s]:i[n]=s,!a;i[n]&&k.isObject(i[n])||(i[n]=[]);return e(t,s,i[n],r)&&k.isArray(i[n])&&(i[n]=function(t){const e={},s=Object.keys(t);let i;const r=s.length;let n;for(i=0;i<r;i++)n=s[i],e[n]=t[n];return e}(i[n])),!a}if(k.isFormData(t)&&k.isFunction(t.entries)){const s={};return k.forEachEntry(t,((t,i)=>{e(function(t){return k.matchAll(/\w+|\[(\w*)]/g,t).map((t=>"[]"===t[0]?"":t[1]||t[0]))}(t),i,s,0)})),s}return null}const et={"Content-Type":void 0};const st={transitional:Z,adapter:["xhr","http"],transformRequest:[function(t,e){const s=e.getContentType()||"",i=s.indexOf("application/json")>-1,r=k.isObject(t);r&&k.isHTMLForm(t)&&(t=new FormData(t));if(k.isFormData(t))return i&&i?JSON.stringify(tt(t)):t;if(k.isArrayBuffer(t)||k.isBuffer(t)||k.isStream(t)||k.isFile(t)||k.isBlob(t))return t;if(k.isArrayBufferView(t))return t.buffer;if(k.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let n;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(t,e){return q(t,new Q.classes.URLSearchParams,Object.assign({visitor:function(t,e,s,i){return Q.isNode&&k.isBuffer(t)?(this.append(e,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}(t,this.formSerializer).toString();if((n=k.isFileList(t))||s.indexOf("multipart/form-data")>-1){const e=this.env&&this.env.FormData;return q(n?{"files[]":t}:t,e&&new e,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(t,e,s){if(k.isString(t))try{return(e||JSON.parse)(t),k.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(s||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){const e=this.transitional||st.transitional,s=e&&e.forcedJSONParsing,i="json"===this.responseType;if(t&&k.isString(t)&&(s&&!this.responseType||i)){const s=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(t){if(s){if("SyntaxError"===t.name)throw F.from(t,F.ERR_BAD_RESPONSE,this,null,this.response);throw t}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Q.classes.FormData,Blob:Q.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};k.forEach(["delete","get","head"],(function(t){st.headers[t]={}})),k.forEach(["post","put","patch"],(function(t){st.headers[t]=k.merge(et)}));var it=st;const rt=k.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const nt=Symbol("internals");function at(t){return t&&String(t).trim().toLowerCase()}function ot(t){return!1===t||null==t?t:k.isArray(t)?t.map(ot):String(t)}function ht(t,e,s,i,r){return k.isFunction(i)?i.call(this,e,s):(r&&(e=s),k.isString(e)?k.isString(i)?-1!==e.indexOf(i):k.isRegExp(i)?i.test(e):void 0:void 0)}class lt{constructor(t){t&&this.set(t)}set(t,e,s){const i=this;function r(t,e,s){const r=at(e);if(!r)throw new Error("header name must be a non-empty string");const n=k.findKey(i,r);(!n||void 0===i[n]||!0===s||void 0===s&&!1!==i[n])&&(i[n||e]=ot(t))}const n=(t,e)=>k.forEach(t,((t,s)=>r(t,s,e)));return k.isPlainObject(t)||t instanceof this.constructor?n(t,e):k.isString(t)&&(t=t.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim())?n((t=>{const e={};let s,i,r;return t&&t.split("\n").forEach((function(t){r=t.indexOf(":"),s=t.substring(0,r).trim().toLowerCase(),i=t.substring(r+1).trim(),!s||e[s]&&rt[s]||("set-cookie"===s?e[s]?e[s].push(i):e[s]=[i]:e[s]=e[s]?e[s]+", "+i:i)})),e})(t),e):null!=t&&r(e,t,s),this}get(t,e){if(t=at(t)){const s=k.findKey(this,t);if(s){const t=this[s];if(!e)return t;if(!0===e)return function(t){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=s.exec(t);)e[i[1]]=i[2];return e}(t);if(k.isFunction(e))return e.call(this,t,s);if(k.isRegExp(e))return e.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=at(t)){const s=k.findKey(this,t);return!(!s||void 0===this[s]||e&&!ht(0,this[s],s,e))}return!1}delete(t,e){const s=this;let i=!1;function r(t){if(t=at(t)){const r=k.findKey(s,t);!r||e&&!ht(0,s[r],r,e)||(delete s[r],i=!0)}}return k.isArray(t)?t.forEach(r):r(t),i}clear(t){const e=Object.keys(this);let s=e.length,i=!1;for(;s--;){const r=e[s];t&&!ht(0,this[r],r,t,!0)||(delete this[r],i=!0)}return i}normalize(t){const e=this,s={};return k.forEach(this,((i,r)=>{const n=k.findKey(s,r);if(n)return e[n]=ot(i),void delete e[r];const a=t?function(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((t,e,s)=>e.toUpperCase()+s))}(r):String(r).trim();a!==r&&delete e[r],e[a]=ot(i),s[a]=!0})),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return k.forEach(this,((s,i)=>{null!=s&&!1!==s&&(e[i]=t&&k.isArray(s)?s.join(", "):s)})),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([t,e])=>t+": "+e)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach((t=>s.set(t))),s}static accessor(t){const e=(this[nt]=this[nt]={accessors:{}}).accessors,s=this.prototype;function i(t){const i=at(t);e[i]||(!function(t,e){const s=k.toCamelCase(" "+e);["get","set","has"].forEach((i=>{Object.defineProperty(t,i+s,{value:function(t,s,r){return this[i].call(this,e,t,s,r)},configurable:!0})}))}(s,t),e[i]=!0)}return k.isArray(t)?t.forEach(i):i(t),this}}lt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),k.freezeMethods(lt.prototype),k.freezeMethods(lt);var ct=lt;function ut(t,e){const s=this||it,i=e||s,r=ct.from(i.headers);let n=i.data;return k.forEach(t,(function(t){n=t.call(s,n,r.normalize(),e?e.status:void 0)})),r.normalize(),n}function dt(t){return!(!t||!t.__CANCEL__)}function ft(t,e,s){F.call(this,null==t?"canceled":t,F.ERR_CANCELED,e,s),this.name="CanceledError"}k.inherits(ft,F,{__CANCEL__:!0});var gt=Q.isStandardBrowserEnv?{write:function(t,e,s,i,r,n){const a=[];a.push(t+"="+encodeURIComponent(e)),k.isNumber(s)&&a.push("expires="+new Date(s).toGMTString()),k.isString(i)&&a.push("path="+i),k.isString(r)&&a.push("domain="+r),!0===n&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function pt(t,e){return t&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)?function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}(t,e):e}var yt=Q.isStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let s;function i(s){let i=s;return t&&(e.setAttribute("href",i),i=e.href),e.setAttribute("href",i),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:"/"===e.pathname.charAt(0)?e.pathname:"/"+e.pathname}}return s=i(window.location.href),function(t){const e=k.isString(t)?i(t):t;return e.protocol===s.protocol&&e.host===s.host}}():function(){return!0};function vt(t,e){let s=0;const i=function(t,e){t=t||10;const s=new Array(t),i=new Array(t);let r,n=0,a=0;return e=void 0!==e?e:1e3,function(o){const h=Date.now(),l=i[a];r||(r=h),s[n]=o,i[n]=h;let c=a,u=0;for(;c!==n;)u+=s[c++],c%=t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),h-r<e)return;const d=l&&h-l;return d?Math.round(1e3*u/d):void 0}}(50,250);return r=>{const n=r.loaded,a=r.lengthComputable?r.total:void 0,o=n-s,h=i(o);s=n;const l={loaded:n,total:a,progress:a?n/a:void 0,bytes:o,rate:h||void 0,estimated:h&&a&&n<=a?(a-n)/h:void 0,event:r};l[e?"download":"upload"]=!0,t(l)}}const mt={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(t){return new Promise((function(e,s){let i=t.data;const r=ct.from(t.headers).normalize(),n=t.responseType;let a;function o(){t.cancelToken&&t.cancelToken.unsubscribe(a),t.signal&&t.signal.removeEventListener("abort",a)}k.isFormData(i)&&(Q.isStandardBrowserEnv||Q.isStandardBrowserWebWorkerEnv?r.setContentType(!1):r.setContentType("multipart/form-data;",!1));let h=new XMLHttpRequest;if(t.auth){const e=t.auth.username||"",s=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";r.set("Authorization","Basic "+btoa(e+":"+s))}const l=pt(t.baseURL,t.url);function c(){if(!h)return;const i=ct.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders());!function(t,e,s){const i=s.config.validateStatus;s.status&&i&&!i(s.status)?e(new F("Request failed with status code "+s.status,[F.ERR_BAD_REQUEST,F.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}((function(t){e(t),o()}),(function(t){s(t),o()}),{data:n&&"text"!==n&&"json"!==n?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:i,config:t,request:h}),h=null}if(h.open(t.method.toUpperCase(),J(l,t.params,t.paramsSerializer),!0),h.timeout=t.timeout,"onloadend"in h?h.onloadend=c:h.onreadystatechange=function(){h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))&&setTimeout(c)},h.onabort=function(){h&&(s(new F("Request aborted",F.ECONNABORTED,t,h)),h=null)},h.onerror=function(){s(new F("Network Error",F.ERR_NETWORK,t,h)),h=null},h.ontimeout=function(){let e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const i=t.transitional||Z;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),s(new F(e,i.clarifyTimeoutError?F.ETIMEDOUT:F.ECONNABORTED,t,h)),h=null},Q.isStandardBrowserEnv){const e=(t.withCredentials||yt(l))&&t.xsrfCookieName&&gt.read(t.xsrfCookieName);e&&r.set(t.xsrfHeaderName,e)}void 0===i&&r.setContentType(null),"setRequestHeader"in h&&k.forEach(r.toJSON(),(function(t,e){h.setRequestHeader(e,t)})),k.isUndefined(t.withCredentials)||(h.withCredentials=!!t.withCredentials),n&&"json"!==n&&(h.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&h.addEventListener("progress",vt(t.onDownloadProgress,!0)),"function"==typeof t.onUploadProgress&&h.upload&&h.upload.addEventListener("progress",vt(t.onUploadProgress)),(t.cancelToken||t.signal)&&(a=e=>{h&&(s(!e||e.type?new ft(null,t,h):e),h.abort(),h=null)},t.cancelToken&&t.cancelToken.subscribe(a),t.signal&&(t.signal.aborted?a():t.signal.addEventListener("abort",a)));const u=function(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}(l);u&&-1===Q.protocols.indexOf(u)?s(new F("Unsupported protocol "+u+":",F.ERR_BAD_REQUEST,t)):h.send(i||null)}))}};k.forEach(mt,((t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch(t){}Object.defineProperty(t,"adapterName",{value:e})}}));var xt=t=>{t=k.isArray(t)?t:[t];const{length:e}=t;let s,i;for(let r=0;r<e&&(s=t[r],!(i=k.isString(s)?mt[s.toLowerCase()]:s));r++);if(!i){if(!1===i)throw new F(`Adapter ${s} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(k.hasOwnProp(mt,s)?`Adapter '${s}' is not available in the build`:`Unknown adapter '${s}'`)}if(!k.isFunction(i))throw new TypeError("adapter is not a function");return i};function bt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ft(null,t)}function wt(t){bt(t),t.headers=ct.from(t.headers),t.data=ut.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1);return xt(t.adapter||it.adapter)(t).then((function(e){return bt(t),e.data=ut.call(t,t.transformResponse,e),e.headers=ct.from(e.headers),e}),(function(e){return dt(e)||(bt(t),e&&e.response&&(e.response.data=ut.call(t,t.transformResponse,e.response),e.response.headers=ct.from(e.response.headers))),Promise.reject(e)}))}const Ct=t=>t instanceof ct?t.toJSON():t;function Pt(t,e){e=e||{};const s={};function i(t,e,s){return k.isPlainObject(t)&&k.isPlainObject(e)?k.merge.call({caseless:s},t,e):k.isPlainObject(e)?k.merge({},e):k.isArray(e)?e.slice():e}function r(t,e,s){return k.isUndefined(e)?k.isUndefined(t)?void 0:i(void 0,t,s):i(t,e,s)}function n(t,e){if(!k.isUndefined(e))return i(void 0,e)}function a(t,e){return k.isUndefined(e)?k.isUndefined(t)?void 0:i(void 0,t):i(void 0,e)}function o(s,r,n){return n in e?i(s,r):n in t?i(void 0,s):void 0}const h={url:n,method:n,data:n,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(t,e)=>r(Ct(t),Ct(e),!0)};return k.forEach(Object.keys(Object.assign({},t,e)),(function(i){const n=h[i]||r,a=n(t[i],e[i],i);k.isUndefined(a)&&n!==o||(s[i]=a)})),s}const St="1.4.0",At={};["object","boolean","number","function","string","symbol"].forEach(((t,e)=>{At[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}}));const Tt={};At.transitional=function(t,e,s){function i(t,e){return"[Axios v1.4.0] Transitional option '"+t+"'"+e+(s?". "+s:"")}return(s,r,n)=>{if(!1===t)throw new F(i(r," has been removed"+(e?" in "+e:"")),F.ERR_DEPRECATED);return e&&!Tt[r]&&(Tt[r]=!0,console.warn(i(r," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(s,r,n)}};var Et={assertOptions:function(t,e,s){if("object"!=typeof t)throw new F("options must be an object",F.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const n=i[r],a=e[n];if(a){const e=t[n],s=void 0===e||a(e,n,t);if(!0!==s)throw new F("option "+n+" must be "+s,F.ERR_BAD_OPTION_VALUE)}else if(!0!==s)throw new F("Unknown option "+n,F.ERR_BAD_OPTION)}},validators:At};const Nt=Et.validators;class _t{constructor(t){this.defaults=t,this.interceptors={request:new K,response:new K}}request(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},e=Pt(this.defaults,e);const{transitional:s,paramsSerializer:i,headers:r}=e;let n;void 0!==s&&Et.assertOptions(s,{silentJSONParsing:Nt.transitional(Nt.boolean),forcedJSONParsing:Nt.transitional(Nt.boolean),clarifyTimeoutError:Nt.transitional(Nt.boolean)},!1),null!=i&&(k.isFunction(i)?e.paramsSerializer={serialize:i}:Et.assertOptions(i,{encode:Nt.function,serialize:Nt.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase(),n=r&&k.merge(r.common,r[e.method]),n&&k.forEach(["delete","get","head","post","put","patch","common"],(t=>{delete r[t]})),e.headers=ct.concat(n,r);const a=[];let o=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(o=o&&t.synchronous,a.unshift(t.fulfilled,t.rejected))}));const h=[];let l;this.interceptors.response.forEach((function(t){h.push(t.fulfilled,t.rejected)}));let c,u=0;if(!o){const t=[wt.bind(this),void 0];for(t.unshift.apply(t,a),t.push.apply(t,h),c=t.length,l=Promise.resolve(e);u<c;)l=l.then(t[u++],t[u++]);return l}c=a.length;let d=e;for(u=0;u<c;){const t=a[u++],e=a[u++];try{d=t(d)}catch(t){e.call(this,t);break}}try{l=wt.call(this,d)}catch(t){return Promise.reject(t)}for(u=0,c=h.length;u<c;)l=l.then(h[u++],h[u++]);return l}getUri(t){return J(pt((t=Pt(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}}k.forEach(["delete","get","head","options"],(function(t){_t.prototype[t]=function(e,s){return this.request(Pt(s||{},{method:t,url:e,data:(s||{}).data}))}})),k.forEach(["post","put","patch"],(function(t){function e(e){return function(s,i,r){return this.request(Pt(r||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:s,data:i}))}}_t.prototype[t]=e(),_t.prototype[t+"Form"]=e(!0)}));var Dt=_t;class Lt{constructor(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");let e;this.promise=new Promise((function(t){e=t}));const s=this;this.promise.then((t=>{if(!s._listeners)return;let e=s._listeners.length;for(;e-- >0;)s._listeners[e](t);s._listeners=null})),this.promise.then=t=>{let e;const i=new Promise((t=>{s.subscribe(t),e=t})).then(t);return i.cancel=function(){s.unsubscribe(e)},i},t((function(t,i,r){s.reason||(s.reason=new ft(t,i,r),e(s.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}static source(){let t;return{token:new Lt((function(e){t=e})),cancel:t}}}var zt=Lt;const Mt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Mt).forEach((([t,e])=>{Mt[e]=t}));var Ot=Mt;const Rt=function t(e){const s=new Dt(e),r=i(Dt.prototype.request,s);return k.extend(r,Dt.prototype,s,{allOwnKeys:!0}),k.extend(r,s,null,{allOwnKeys:!0}),r.create=function(s){return t(Pt(e,s))},r}(it);Rt.Axios=Dt,Rt.CanceledError=ft,Rt.CancelToken=zt,Rt.isCancel=dt,Rt.VERSION=St,Rt.toFormData=q,Rt.AxiosError=F,Rt.Cancel=Rt.CanceledError,Rt.all=function(t){return Promise.all(t)},Rt.spread=function(t){return function(e){return t.apply(null,e)}},Rt.isAxiosError=function(t){return k.isObject(t)&&!0===t.isAxiosError},Rt.mergeConfig=Pt,Rt.AxiosHeaders=ct,Rt.formToJSON=t=>tt(k.isHTMLForm(t)?new FormData(t):t),Rt.HttpStatusCode=Ot,Rt.default=Rt,t.exports=Rt}}]);
//# sourceMappingURL=rpg-dialogue-vendor.min.js.map